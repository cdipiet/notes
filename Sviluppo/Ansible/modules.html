<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-09 13:28:33.673" />
        <title>modules</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../inc/js/hljs/styles/default.css" />
        <script src="../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="modules" tabindex="-1">modules <a class="header-anchor" href="#modules" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-09 13:28:33.673</p>
<nav class="table-of-contents"><ol><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fraw_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/raw_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fset_fact_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fdebug_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffail_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fail_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fassert_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fshell_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fscript_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcommand_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcopy_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffetch_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ftemplate_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsynchronize_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Funarchive_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fget_url_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fgit_module.html%23git-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html#git-module </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Farchive_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fstat_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffind_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/find_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffile_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Freplace_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Flineinfile_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html </a><ol><li><a href="#esempi">Esempi </a></li><li><a href="#verifica-di-presenza-di-una-riga">Verifica di presenza di una riga </a></li><li><a href="#commentare%2Fdecommentare">Commentare/Decommentare </a></li></ol></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fuser_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fservice_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fsystemd_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsysctl_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/sysctl_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fauthorized_key_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fpacman_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html </a><ol><li><a href="#ansible-aur">Ansible-AUR </a></li></ol></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fufw_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html </a></li><li><a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fxml_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/xml_module.html </a></li></ol></nav><h1 id="moduli-ansible-maggiormente-utili" tabindex="-1">Moduli Ansible maggiormente utili <a class="header-anchor" href="#moduli-ansible-maggiormente-utili" aria-hidden="true">ðŸ”—</a></h1>
<ul>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/index_module.html">https://docs.ansible.com/ansible/latest/collections/index_module.html</a></p>
</li>
<li>
<p><a href="https://www.middlewareinventory.com/blog/ansible-playbook-example/">https://www.middlewareinventory.com/blog/ansible-playbook-example/</a></p>
</li>
<li>
<p><a href="file:///home/$USER//workspaces/Python/Ansible/module_examples">file:///home/$USER//workspaces/Python/Ansible/module_examples</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/raw_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/raw_module.html</a> <a href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fraw_module.html">raw</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fail_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fail_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html#git-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html#git-module</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/find_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/find_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/sysctl_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/sysctl_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/collections/community/general/xml_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/xml_module.html</a></p>
</li>
</ul>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fraw_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/raw_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/raw_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fraw_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Executes a low-down and dirty command.<br>
Executes a low-down and dirty SSH command, not going through the module subsystem.<br>
This is useful and should only be done in a few cases. A common case is installing python on a system without python installed by default.<br>
Utilizzato spesso per installare Python sulle macchine managed, non richiede che sia installato Python sui managed node come la maggior parte dei moduli Ansible.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Python</span> <span class="hljs-string">sulla</span> <span class="hljs-string">macchina</span> <span class="hljs-string">managed</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">all</span> <span class="hljs-string">variables/facts</span> <span class="hljs-string">known</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">host</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Safely</span> <span class="hljs-string">use</span> <span class="hljs-string">templated</span> <span class="hljs-string">variables.</span> <span class="hljs-string">Always</span> <span class="hljs-string">use</span> <span class="hljs-string">quote</span> <span class="hljs-string">filter</span> <span class="hljs-string">to</span> <span class="hljs-string">avoid</span> <span class="hljs-string">injection</span> <span class="hljs-string">issues.</span>
      <span class="hljs-attr">raw:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ package_mgr|quote }}</span> <span class="hljs-template-variable">{{ pkg_flags|quote }}</span> install <span class="hljs-template-variable">{{ python|quote }}</span>&quot;</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Python</span> <span class="hljs-string">sulla</span> <span class="hljs-string">macchina</span> <span class="hljs-string">managed</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">all</span> <span class="hljs-string">variables/facts</span> <span class="hljs-string">known</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">host</span>
      <span class="hljs-attr">raw:</span> <span class="hljs-string">&quot;pacman --noconfirm -S python&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fset_fact_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fset_fact_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Set host variable(s) and fact(s).<br>
These variables will be available to subsequent plays during an ansible-playbook run via the host they were set on.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">Guest</span> <span class="hljs-string">Kernel</span> <span class="hljs-string">Version</span>
  <span class="hljs-attr">ansible.builtin.set_fact:</span>
    <span class="hljs-comment"># https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html#searching-strings-with-regular-expressions</span>
    <span class="hljs-attr">kernel_version :</span> <span class="hljs-string">&quot;linux<span class="hljs-template-variable">{{ ansible_kernel | regex_replace(&#x27;^(\\d)\\.(\\d{2}).*$&#x27;, &#x27;\\1\\2&#x27;) }}</span>&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">host</span> <span class="hljs-string">facts</span> <span class="hljs-string">using</span> <span class="hljs-string">key=value</span> <span class="hljs-string">pairs,</span> <span class="hljs-string">this</span> <span class="hljs-string">format</span> <span class="hljs-string">can</span> <span class="hljs-string">only</span> <span class="hljs-string">create</span> <span class="hljs-string">strings</span> <span class="hljs-string">or</span> <span class="hljs-string">booleans</span>
  <span class="hljs-attr">set_fact:</span> <span class="hljs-string">one_fact=&quot;something&quot;</span> <span class="hljs-string">other_fact=&quot;{{</span> <span class="hljs-string">local_var</span> <span class="hljs-string">}}&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">host</span> <span class="hljs-string">facts</span> <span class="hljs-string">using</span> <span class="hljs-string">complex</span> <span class="hljs-string">arguments</span>
  <span class="hljs-attr">set_fact:</span>
    <span class="hljs-attr">one_fact:</span> <span class="hljs-string">something</span>
    <span class="hljs-attr">other_fact:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ local_var * 2 }}</span>&quot;</span>
    <span class="hljs-attr">another_fact:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ some_registered_var.results | map(attribute=&#x27;ansible_facts.some_fact&#x27;) | list }}</span>&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">facts</span> <span class="hljs-string">so</span> <span class="hljs-string">that</span> <span class="hljs-string">they</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">persisted</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">fact</span> <span class="hljs-string">cache</span>
  <span class="hljs-attr">set_fact:</span>
    <span class="hljs-attr">one_fact:</span> <span class="hljs-string">something</span>
    <span class="hljs-attr">other_fact:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ local_var * 2 }}</span>&quot;</span>
    <span class="hljs-attr">cacheable:</span> <span class="hljs-literal">yes</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Creating</span> <span class="hljs-string">list</span> <span class="hljs-string">and</span> <span class="hljs-string">dictionary</span> <span class="hljs-string">variables</span>
  <span class="hljs-attr">set_fact:</span>
    <span class="hljs-attr">one_dict:</span>
        <span class="hljs-attr">something:</span> <span class="hljs-string">here</span>
        <span class="hljs-attr">other:</span> <span class="hljs-string">there</span>
    <span class="hljs-attr">one_list:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">a</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">b</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">c</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Creating</span> <span class="hljs-string">list</span> <span class="hljs-string">and</span> <span class="hljs-string">dictionary</span> <span class="hljs-string">variables</span> <span class="hljs-string">using</span> <span class="hljs-string">&#x27;shorthand&#x27;</span> <span class="hljs-string">YAML</span>
  <span class="hljs-attr">set_fact:</span>
    <span class="hljs-attr">two_dict:</span> {<span class="hljs-attr">&#x27;something&#x27;:</span> <span class="hljs-string">here2</span>, <span class="hljs-attr">&#x27;other&#x27;:</span> <span class="hljs-string">somewhere</span>}
    <span class="hljs-attr">two_list:</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fdebug_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fdebug_module.html" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="https://github.com/ansible/ansible/blob/devel/lib/ansible/modules/debug.py">https://github.com/ansible/ansible/blob/devel/lib/ansible/modules/debug.py</a></li>
</ul>
<p>Print statements during execution.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">all</span> <span class="hljs-string">variables/facts</span> <span class="hljs-string">known</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">host</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">var:</span> <span class="hljs-string">hostvars[inventory_hostname]</span>
          <span class="hljs-attr">verbosity:</span> <span class="hljs-number">4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">the</span> <span class="hljs-string">gateway</span> <span class="hljs-string">for</span> <span class="hljs-string">each</span> <span class="hljs-string">host</span> <span class="hljs-string">when</span> <span class="hljs-string">defined</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">msg:</span> <span class="hljs-string">System</span> {{ <span class="hljs-string">inventory_hostname</span> }} <span class="hljs-string">has</span> <span class="hljs-string">gateway</span> {{ <span class="hljs-string">ansible_default_ipv4.gateway</span> }}
        <span class="hljs-attr">when:</span> <span class="hljs-string">ansible_default_ipv4.gateway</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">uptime</span> <span class="hljs-string">information</span>
        <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">/usr/bin/uptime</span>
        <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">return</span> <span class="hljs-string">information</span> <span class="hljs-string">from</span> <span class="hljs-string">the</span> <span class="hljs-string">previous</span> <span class="hljs-string">task</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">var:</span> <span class="hljs-string">result</span>
          <span class="hljs-attr">verbosity:</span> <span class="hljs-number">2</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">all</span> <span class="hljs-string">variables/facts</span> <span class="hljs-string">known</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">host</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">var:</span> <span class="hljs-string">hostvars[inventory_hostname]</span>
          <span class="hljs-attr">verbosity:</span> <span class="hljs-number">4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Prints</span> <span class="hljs-string">two</span> <span class="hljs-string">lines</span> <span class="hljs-string">of</span> <span class="hljs-string">messages,</span> <span class="hljs-string">but</span> <span class="hljs-string">only</span> <span class="hljs-string">if</span> <span class="hljs-string">there</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">environment</span> <span class="hljs-string">value</span> <span class="hljs-string">set</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">msg:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;Provisioning based on YOUR_KEY which is: <span class="hljs-template-variable">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;YOUR_KEY&#x27;) }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;These servers were built using the password of &#x27;<span class="hljs-template-variable">{{ password_used }}</span>&#x27;. Please retain this for later use.&quot;</span>

      <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">Vault</span>
      <span class="hljs-attr">ansible.builtin.debug:</span>
        <span class="hljs-attr">msg:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ansible_become_password: <span class="hljs-template-variable">{{ ansible_become_password }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_admin_user: <span class="hljs-template-variable">{{ mariadb_admin_user }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_admin_password: <span class="hljs-template-variable">{{ mariadb_admin_password }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_wordpress_db: <span class="hljs-template-variable">{{ mariadb_wordpress_db }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_wordpress_user: <span class="hljs-template-variable">{{ mariadb_wordpress_user }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_wordpress_password: <span class="hljs-template-variable">{{ mariadb_wordpress_password }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_phpmyadmin_db: <span class="hljs-template-variable">{{ mariadb_phpmyadmin_db }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_phpmyadmin_user: <span class="hljs-template-variable">{{ mariadb_phpmyadmin_user }}</span>&quot;</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mariadb_phpmyadmin_password: <span class="hljs-template-variable">{{ mariadb_phpmyadmin_password }}</span>&quot;</span>
      <span class="hljs-attr">no_log:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># abilitare per vedere i valori</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Write</span> <span class="hljs-string">some</span> <span class="hljs-string">content</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">file</span> <span class="hljs-string">/tmp/foo.txt</span>
      <span class="hljs-attr">ansible.builtin.copy:</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/foo.txt</span>
        <span class="hljs-attr">content:</span> <span class="hljs-string">|
        Good Morning!
        Awesome sunshine today.
</span>      <span class="hljs-attr">register:</span> <span class="hljs-string">display_file_content</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Debug</span> <span class="hljs-string">display_file_content</span>
      <span class="hljs-attr">ansible.builtin.debug:</span>
        <span class="hljs-attr">var:</span> <span class="hljs-string">display_file_content</span>
        <span class="hljs-attr">verbosity:</span> <span class="hljs-number">2</span>
</code></pre>
<p>This registers the content of the copy module output and displays it only when you specify verbosity as 2. For example:\</p>
<pre><code class="language-bash">ansible-playbook demo.yaml -vv
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffail_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fail_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fail_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffail_module.html" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checks</span> <span class="hljs-string">executed</span> <span class="hljs-string">before</span> <span class="hljs-string">execution</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">pre_checks</span>
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">stats</span> <span class="hljs-string">of</span> <span class="hljs-string">source</span> <span class="hljs-string">backup</span> <span class="hljs-string">files</span>
      <span class="hljs-attr">ansible.builtin.stat:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ rsync_home_src }}</span>&quot;</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">p</span>
      <span class="hljs-attr">delegate_to:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Fail</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">directory</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">Exists</span>
      <span class="hljs-attr">ansible.builtin.fail:</span>
        <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;Backup source directory doesn&#x27;t exists! <span class="hljs-template-variable">{{ rsync_home_src }}</span>&quot;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">not</span> <span class="hljs-string">(p.stat.isdir</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span> <span class="hljs-string">and</span> <span class="hljs-string">p.stat.isdir)</span>

<span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">/srv/http</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
      <span class="hljs-attr">ansible.builtin.stat:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/srv/http</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">p</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">Fail</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">directory</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">Exists</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
      <span class="hljs-attr">ansible.builtin.fail:</span>
        <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;/srv/http directory doesn&#x27;t exists!&quot;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">not</span> <span class="hljs-string">(p.stat.isdir</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span> <span class="hljs-string">and</span> <span class="hljs-string">p.stat.isdir)</span>

<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fassert_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fassert_module.html" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">ansible.builtin.assert:</span> { <span class="hljs-attr">that:</span> <span class="hljs-string">&quot;ansible_os_family != &#x27;RedHat&#x27;&quot;</span> }

<span class="hljs-bullet">-</span> <span class="hljs-attr">ansible.builtin.assert:</span>
    <span class="hljs-attr">that:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&#x27;foo&#x27; in some_command_result.stdout&quot;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">number_of_the_counting</span> <span class="hljs-string">==</span> <span class="hljs-number">3</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">After</span> <span class="hljs-string">version</span> <span class="hljs-number">2.7</span> <span class="hljs-string">both</span> <span class="hljs-string">&#x27;msg&#x27;</span> <span class="hljs-string">and</span> <span class="hljs-string">&#x27;fail_msg&#x27;</span> <span class="hljs-string">can</span> <span class="hljs-string">customize</span> <span class="hljs-string">failing</span> <span class="hljs-string">assertion</span> <span class="hljs-string">message</span>
  <span class="hljs-attr">ansible.builtin.assert:</span>
    <span class="hljs-attr">that:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&lt;=</span> <span class="hljs-number">100</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&gt;=</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">fail_msg:</span> <span class="hljs-string">&quot;&#x27;my_param&#x27; must be between 0 and 100&quot;</span>
    <span class="hljs-attr">success_msg:</span> <span class="hljs-string">&quot;&#x27;my_param&#x27; is between 0 and 100&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Please</span> <span class="hljs-string">use</span> <span class="hljs-string">&#x27;msg&#x27;</span> <span class="hljs-string">when</span> <span class="hljs-string">ansible</span> <span class="hljs-string">version</span> <span class="hljs-string">is</span> <span class="hljs-string">smaller</span> <span class="hljs-string">than</span> <span class="hljs-number">2.7</span>
  <span class="hljs-attr">ansible.builtin.assert:</span>
    <span class="hljs-attr">that:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&lt;=</span> <span class="hljs-number">100</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&gt;=</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;&#x27;my_param&#x27; must be between 0 and 100&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">quiet</span> <span class="hljs-string">to</span> <span class="hljs-string">avoid</span> <span class="hljs-string">verbose</span> <span class="hljs-string">output</span>
  <span class="hljs-attr">ansible.builtin.assert:</span>
    <span class="hljs-attr">that:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&lt;=</span> <span class="hljs-number">100</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">my_param</span> <span class="hljs-string">&gt;=</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">quiet:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fshell_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fshell_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Execute shell commands on targets.<br>
It is almost exactly like the <code>ansible.builtin.command</code> module but runs the command through a shell (<code>/bin/sh</code>) on the remote node.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Change</span> <span class="hljs-string">the</span> <span class="hljs-string">working</span> <span class="hljs-string">directory</span> <span class="hljs-string">to</span> <span class="hljs-string">somedir/</span> <span class="hljs-string">before</span> <span class="hljs-string">executing</span> <span class="hljs-string">the</span> <span class="hljs-string">command</span>
    <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">somescript.sh</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">somelog.txt</span>
    <span class="hljs-attr">args:</span>
        <span class="hljs-attr">chdir:</span> <span class="hljs-string">somedir/</span>

    <span class="hljs-comment"># You can also use the &#x27;args&#x27; form to provide the options.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">This</span> <span class="hljs-string">command</span> <span class="hljs-string">will</span> <span class="hljs-string">change</span> <span class="hljs-string">the</span> <span class="hljs-string">working</span> <span class="hljs-string">directory</span> <span class="hljs-string">to</span> <span class="hljs-string">somedir/</span> <span class="hljs-string">and</span> <span class="hljs-string">will</span> <span class="hljs-string">only</span> <span class="hljs-string">run</span> <span class="hljs-string">when</span> <span class="hljs-string">somedir/somelog.txt</span> <span class="hljs-string">doesn&#x27;t</span> <span class="hljs-string">exist</span>
    <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">somescript.sh</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">somelog.txt</span>
    <span class="hljs-attr">args:</span>
        <span class="hljs-attr">chdir:</span> <span class="hljs-string">somedir/</span>
        <span class="hljs-attr">creates:</span> <span class="hljs-string">somelog.txt</span>
    <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Start</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-comment"># MariaDB deve essere attivo per poter eseguire la creazione degli utenti e dei database</span>
      <span class="hljs-comment"># ansible.builtin.service: systemd non Ã¨ ancora attivo al tempo dell&#x27;esecuzione del playbook nel Dockerfile</span>
      <span class="hljs-comment">#   name: mariadb</span>
      <span class="hljs-comment">#   state: started</span>
      <span class="hljs-comment">#   enabled: false</span>
      <span class="hljs-comment"># $ sudo -u mysql -s &quot;cd /tmp/; nohup /usr/bin/mariadbd --datadir=/var/lib/mysql &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span>
      <span class="hljs-comment"># $ sudo bash -c &quot;kill -SIGTERM $(pidof mariadbd)&quot;</span>
      <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">&quot;cd /tmp/; nohup /usr/bin/mariadbd --datadir=<span class="hljs-template-variable">{{ mariadb_datadir }}</span> &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">mysql</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">Stop</span> <span class="hljs-string">MariaDB</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Unset</span> <span class="hljs-string">root</span> <span class="hljs-string">password</span> <span class="hljs-string">se</span> <span class="hljs-string">la</span> <span class="hljs-string">password</span> <span class="hljs-string">Ã¨</span> <span class="hljs-string">root</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-comment"># senza -p consente la login quando la password non Ã¨ ancora stata impostata</span>
      <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">|
        mariadb -u root -proot &lt;&lt;- EOF
        ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD(&quot;&quot;);
        FLUSH PRIVILEGES;
        EOF
</span>      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-comment"># Quando la password Ã¨ giÃ  vuota il comando fallisce perchÃ¨ passiamo una password &quot;root&quot;, tale errore deve essere ignorato</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-literal">false</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Stop</span> <span class="hljs-string">MariaDB</span>
      <span class="hljs-comment"># MariaDB viene fatto partire da riga di comando perchÃ¨ systemd non Ã¨ attivo al momento dell&#x27;esecuzione dello script Ansible</span>
      <span class="hljs-comment"># analogamente deve essere fermato da riga di comando anzichÃ¨ con systemctl stop.</span>
      <span class="hljs-attr">tags:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">mariadb</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">stopmariadb</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">/usr/bin/kill</span> <span class="hljs-string">-s</span> <span class="hljs-string">SIGTERM</span> <span class="hljs-string">$(pidof</span> <span class="hljs-string">mariadbd)</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fscript_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fscript_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Runs a local script on a remote node after transferring it.<br>
Come per il modulo raw, questo modulo non richiede l'installazione di python nel managed node.<br>
The local script at path will be transferred to the remote node and then executed.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">a</span> <span class="hljs-string">script</span> <span class="hljs-string">with</span> <span class="hljs-string">arguments</span> <span class="hljs-string">(free</span> <span class="hljs-string">form)</span>
      <span class="hljs-attr">ansible.builtin.script:</span> <span class="hljs-string">/some/local/script.sh</span> <span class="hljs-string">--some-argument</span> <span class="hljs-number">1234</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">a</span> <span class="hljs-string">script</span> <span class="hljs-string">with</span> <span class="hljs-string">arguments</span> <span class="hljs-string">(using</span> <span class="hljs-string">&#x27;cmd&#x27;</span> <span class="hljs-string">parameter)</span>
      <span class="hljs-attr">ansible.builtin.script:</span>
        <span class="hljs-attr">cmd:</span> <span class="hljs-string">/some/local/script.sh</span> <span class="hljs-string">--some-argument</span> <span class="hljs-number">1234</span>

</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcommand_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcommand_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Execute commands on targets.
Esegue un comando <strong>senza</strong> creare una shell per la sua esecuzione</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">mysql_install_db</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-comment"># https://mariadb.com/kb/en/mysql_install_db/</span>
      <span class="hljs-comment"># /usr/bin/mariadb-install-db</span>
      <span class="hljs-attr">ansible.builtin.command:</span> <span class="hljs-string">&quot;mysql_install_db --user=mysql --basedir=/usr --datadir=<span class="hljs-template-variable">{{ mariadb_datadir }}</span>&quot;</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Start</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-comment"># MariaDB deve essere attivo per poter eseguire la creazione degli utenti e dei database</span>
      <span class="hljs-comment"># ansible.builtin.service: systemd non Ã¨ ancora attivo al tempo dell&#x27;esecuzione del playbook nel Dockerfile</span>
      <span class="hljs-comment">#   name: mariadb</span>
      <span class="hljs-comment">#   state: started</span>
      <span class="hljs-comment">#   enabled: false</span>
      <span class="hljs-comment"># $ sudo -u mysql -s &quot;cd /tmp/; nohup /usr/bin/mariadbd --datadir=/var/lib/mysql &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span>
      <span class="hljs-comment"># $ sudo bash -c &quot;kill -SIGTERM $(pidof mariadbd)&quot;</span>
      <span class="hljs-attr">ansible.builtin.shell:</span> <span class="hljs-string">&quot;cd /tmp/; nohup /usr/bin/mariadbd --datadir=<span class="hljs-template-variable">{{ mariadb_datadir }}</span> &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">mysql</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">Stop</span> <span class="hljs-string">MariaDB</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">SSL</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Import</span> <span class="hljs-string">Root</span> <span class="hljs-string">CA</span> <span class="hljs-string">|</span> <span class="hljs-string">apache_ssl.yml</span>
      <span class="hljs-attr">ansible.builtin.command:</span> <span class="hljs-string">trust</span> <span class="hljs-string">anchor</span> <span class="hljs-string">--store</span> <span class="hljs-string">/etc/httpd/conf/rootCACert.pem</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">notify:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">Apache</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">PHP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Pacchetti</span> <span class="hljs-string">AUR</span> <span class="hljs-string">|</span> <span class="hljs-string">Build</span> <span class="hljs-bullet">-</span> {{ <span class="hljs-string">item</span> }}
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">aur_builder</span>
      <span class="hljs-attr">ansible.builtin.command:</span> <span class="hljs-string">yay</span> <span class="hljs-string">--noconfirm</span> <span class="hljs-string">--answerdiff</span> <span class="hljs-string">None</span>  <span class="hljs-string">-S</span> {{ <span class="hljs-string">item</span> }}
      <span class="hljs-attr">register:</span> <span class="hljs-string">aur</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">&quot;aur.rc == 0&quot;</span>
      <span class="hljs-comment"># debugger: always</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">Install</span> <span class="hljs-string">Script</span> <span class="hljs-bullet">-</span> <span class="hljs-string">wp-cli</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
      <span class="hljs-attr">ansible.builtin.command:</span> <span class="hljs-string">&gt;
        wp core install --path=&quot;{{ wordpress_install_directory }}&quot; --url=&quot;{{ wordpress_url }}&quot; --title=&quot;{{ wordpress_title }}&quot;
        --admin_user=&quot;{{ wordpress_admin_user }}&quot; --admin_password=&quot;{{ wordpress_admin_password }}&quot; --admin_email=&quot;{{ wordpress_admin_email }}&quot;
</span>      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">http</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-attr">chdir:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ wordpress_install_directory }}</span>&quot;</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">failed_when:</span> <span class="hljs-string">result.rc</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">notify:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">Apache</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">PHP</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcopy_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fcopy_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Copy files to remote locations.<br>
The copy module copies a file from the local or remote machine to a location on the remote machine.
Use the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html">ansible.builtin.fetch</a> module to copy files from remote locations to the local box.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Write</span> <span class="hljs-string">some</span> <span class="hljs-string">content</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">file</span> <span class="hljs-string">/tmp/foo.txt</span>
      <span class="hljs-attr">ansible.builtin.copy:</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/foo.txt</span>
        <span class="hljs-attr">content:</span> <span class="hljs-string">|
          Good Morning!
          Awesome sunshine today.
</span>      <span class="hljs-attr">register:</span> <span class="hljs-string">display_file_content</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Debug</span> <span class="hljs-string">display_file_content</span>
      <span class="hljs-attr">ansible.builtin.debug:</span>
      <span class="hljs-attr">var:</span> <span class="hljs-string">display_file_content</span>
      <span class="hljs-attr">verbosity:</span> <span class="hljs-number">2</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">a</span> <span class="hljs-string">new</span> <span class="hljs-string">&quot;ntp.conf file into place, backing up the original if it differs from the copied version
      ansible.builtin.copy:
        src: /mine/ntp.conf
        dest: /etc/ntp.conf
        owner: root
        group: root
        mode: &#x27;0644&#x27;
        backup: yes

    - name: Copy file with owner and permission, using symbolic representation
      ansible.builtin.copy:
        src: /srv/myfiles/foo.conf
        dest: /etc/foo.conf
        owner: foo
        group: foo
        mode: u=rw,g=r,o=r

    # Da Manjaro_LAMP
    - name: Wordpress | Configure Apache 1 | wordpress.yml # Esempio di path relativo alla cartella files del role
      ansible.builtin.copy:
        src: wordpress.conf                         # path relativo alla cartella del ruolo lamp/files
                                                    # https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html#using-roles-at-the-play-level
        dest: /etc/httpd/conf/extra/wordpress.conf
        mode: &#x27;0644&#x27;
        remote_src: false # false Ã¨ il default: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#parameter-remote_src
                          # viene posto a true quando il file da copiare Ã¨ giÃ  presente nel Managed Node

    - name: Apache SSL | Copia dei Certificati | apache_ssl.yml
      ansible.builtin.copy:
        src: &#x27;<span class="hljs-template-variable">{{ item.src }}</span>&#x27;
        dest: &#x27;<span class="hljs-template-variable">{{ item.dst }}</span>&#x27;
        mode: &#x27;0644&#x27;
        owner: http
        group: http
        remote_src: false # false Ã¨ il default: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#parameter-remote_src
                          # viene posto a true quando il file da copiare Ã¨ giÃ  presente nel Managed Node
      loop:
        # per evitare un lineinfile si utilizzano i valori preconfigurati in
        - { src: ssl/server.crt, dst: /etc/httpd/conf/server.crt }
        - { src: ssl/server.key, dst: /etc/httpd/conf/server.key }
        - { src: ssl/rootCACert.pem, dst: /etc/httpd/conf/rootCACert.pem }

...
</span></code></pre>
<p>Normalmente copy copia il file presente nel Control Node negli host Managed Node, a meno che non si utilizzi il parametro <code>remote_src</code>,
che se impostato effettua una copia remota interamente nel Managed Node senza prendere il file dal Control Node:</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SDDM</span> <span class="hljs-string">|</span> <span class="hljs-string">Copy</span> <span class="hljs-string">Configuration</span> <span class="hljs-string">File</span>
      <span class="hljs-attr">ansible.builtin.copy:</span>
        <span class="hljs-attr">src:</span> <span class="hljs-string">/usr/lib/sddm/sddm.conf.d/default.conf</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/sddm.conf</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-number">0644</span>
        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># false Ã¨ il default: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#parameter-remote_src</span>
                          <span class="hljs-comment"># viene posto a true perchÃ¨ il file da copiare Ã¨ giÃ  presente nel Managed Node</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Midnight</span> <span class="hljs-string">Commander</span> <span class="hljs-string">|</span> <span class="hljs-string">Copy</span> <span class="hljs-string">Keymap</span> <span class="hljs-bullet">-</span> <span class="hljs-string">main.yml</span>
      <span class="hljs-attr">ansible.builtin.copy:</span>
        <span class="hljs-attr">src:</span> <span class="hljs-string">/etc/mc/mc.keymap</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">~/.config/mc/</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-number">0644</span>
        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># false Ã¨ il default: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#parameter-remote_src</span>
                          <span class="hljs-comment"># viene posto a true perchÃ¨ il file da copiare Ã¨ giÃ  presente nel managed node</span>
<span class="hljs-string">...</span>
</code></pre>
<p>Utilizzo come comando adhoc:</p>
<pre><code class="language-bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span> &gt; text.txt
$ ansible managed_node -i inventory \  <span class="hljs-comment">## tells Ansible which inventory file to use</span>
    -m copy \                            <span class="hljs-comment">## tells Ansible which module to load,</span>
    -a <span class="hljs-string">&quot;src=test.txt dest=/tmp/test.txt&quot;</span> <span class="hljs-comment">## attributes that are passed to the module</span>
$ ansible managed_node -i inventory -m shell -a <span class="hljs-string">&quot;cat /tmp/text.txt&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffetch_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffetch_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Fetch files from remote nodes.<br>
This module works like <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html">ansible.builtin.copy</a>, but in reverse.<br>
It is used for fetching files from remote machines and storing them locally in a file tree, organized by hostname.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Store</span> <span class="hljs-string">file</span> <span class="hljs-string">into</span> <span class="hljs-string">/tmp/fetched/host.example.com/tmp/somefile</span>
  <span class="hljs-attr">ansible.builtin.fetch:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">/tmp/somefile</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/fetched</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Storing</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">path</span> <span class="hljs-string">relative</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">playbook</span>
  <span class="hljs-attr">ansible.builtin.fetch:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">/tmp/uniquefile</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">special/prefix-{{</span> <span class="hljs-string">inventory_hostname</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">flat:</span> <span class="hljs-literal">yes</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ftemplate_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ftemplate_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Template a file out to a target host
Templates are processed by the <a href="https://jinja.palletsprojects.com">Jinja2 templating language</a>.</p>
<pre><code class="language-bash"><span class="hljs-comment">## Create a text file called template.txt.j2 with &quot;Test Message&quot; as contents</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Test Message&quot;</span> &gt; template.txt.j2
<span class="hljs-comment"># Append the text {{ ata_message }} to the file</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{{ ata_message }}&quot;</span> &gt;&gt; template.txt.j2
<span class="hljs-comment"># Run the Ansible template module against the managed_node in inventory file &quot;inventory&quot;</span>
<span class="hljs-comment"># The template module will copy and transform the template.txt.j2 file to the</span>
<span class="hljs-comment"># managed host in the /tmp directory</span>
$ ansible managed_node -i inventory -m template \ 
-a <span class="hljs-string">&quot;src=template.txt.j2 dest=/tmp/template.txt&quot;</span> \ 
-e <span class="hljs-string">&quot;ata_message=&#x27;Hello World Template&#x27;&quot;</span>
$ ansible managed_node -i inventory -m shell -a <span class="hljs-string">&quot;cat /tmp/template.txt&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsynchronize_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsynchronize_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>A wrapper around rsync to make common tasks in your playbooks quick and easy.<br>
â€¢rsync must be installed on both the local and remote host.</p>
<p><code>rsync</code></p>
<pre><code class="language-bash"><span class="hljs-comment"># Run the Ansible synchronize module against the managed_node in inventory file &quot;inventory&quot;</span>
<span class="hljs-comment"># The synchronize module will copy the test.txt file to the</span>
<span class="hljs-comment"># managed host in the /tmp directory</span>
$ ansible managed_node -i inventory \
    -m synchronize \
    -a <span class="hljs-string">&quot;src=test.txt dest=/tmp/test.txt&quot;</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-comment"># Example .rsync-filter file in the source directory</span>
<span class="hljs-comment"># - var       # exclude any path whose last part is &#x27;var&#x27;</span>
<span class="hljs-comment"># - /var      # exclude any path starting with &#x27;var&#x27; starting at the source directory</span>
<span class="hljs-comment"># + /var/conf # include /var/conf even though it was previously excluded</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Synchronize</span> <span class="hljs-string">passing</span> <span class="hljs-string">in</span> <span class="hljs-string">extra</span> <span class="hljs-string">rsync</span> <span class="hljs-string">options</span>
        <span class="hljs-attr">ansible.posix.synchronize:</span>
        <span class="hljs-attr">src:</span> <span class="hljs-string">/tmp/helloworld</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/var/www/helloworld</span>
        <span class="hljs-attr">rsync_opts:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;--no-motd&quot;</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;--exclude=.git&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Funarchive_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Funarchive_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Oltre a decomprimere <strong>Ã¨ in grado di scaricare l'archivio da una URL</strong>.</p>
<p>Unpacks an archive after (optionally) copying it from the local machine.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-comment"># Da Manjaro_LAMP</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configurazione</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">Remove</span> <span class="hljs-string">preceding</span> <span class="hljs-string">installation</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
      <span class="hljs-attr">ansible.builtin.file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/srv/http/wordpress</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Wordpress</span> <span class="hljs-string">|</span> <span class="hljs-string">Download</span> <span class="hljs-string">and</span> <span class="hljs-string">unarchive</span> <span class="hljs-string">|</span> <span class="hljs-string">wordpress.yml</span>
      <span class="hljs-attr">ansible.builtin.unarchive:</span>
        <span class="hljs-attr">src:</span> <span class="hljs-string">https://wordpress.org/latest.tar.gz</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/srv/http/</span>
        <span class="hljs-attr">creates:</span> <span class="hljs-string">/srv/http/wordpress</span>
        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0755&#x27;</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">http</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">http</span>

<span class="hljs-comment"># possiamo utilizzare il modulo unarchive, invece di usare copy e shell+tar</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Play</span> <span class="hljs-string">to</span> <span class="hljs-string">copy</span> <span class="hljs-string">file</span> <span class="hljs-string">and</span> <span class="hljs-string">uncompress</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">appservers</span>
  <span class="hljs-attr">vars:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">userid :</span> <span class="hljs-string">&quot;weblogic&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">oracle_home:</span> <span class="hljs-string">&quot;/opt/oracle&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">jdk_instl_file:</span> <span class="hljs-string">&quot;server-jre-8u191-linux-x64.tar.gz&quot;</span>

  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name :</span> <span class="hljs-string">Copy</span> <span class="hljs-string">and</span> <span class="hljs-string">Install</span> <span class="hljs-string">Java</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">become_user:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ userid }}</span>&quot;</span>
    <span class="hljs-attr">tags:</span> <span class="hljs-string">javainstall</span>
    <span class="hljs-attr">unarchive:</span>
      <span class="hljs-attr">src:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item }}</span>&quot;</span>           <span class="hljs-comment"># If &#x27;remote_src=no&#x27; (default), local path to archive file to copy to the target server;</span>
      <span class="hljs-attr">dest:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ oracle_home }}</span>&quot;</span>
      <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span>
    <span class="hljs-attr">with_items:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ jdk_instl_file }}</span>&quot;</span>

<span class="hljs-comment"># possiamo utilizzare il modulo unarchive scaricando il file sorgente dalla rete</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Play</span> <span class="hljs-string">to</span> <span class="hljs-string">download</span> <span class="hljs-string">and</span> <span class="hljs-string">install</span> <span class="hljs-string">tomcat8</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">appservers</span>

  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">Java</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">yum:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">java-1.8.0-openjdk-devel</span>
      <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">crate</span> <span class="hljs-string">a</span> <span class="hljs-string">directory</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">file:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/opt/tomcat8&quot;</span>
      <span class="hljs-attr">state:</span> <span class="hljs-string">directory</span>
      <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name :</span> <span class="hljs-string">Download</span> <span class="hljs-string">and</span> <span class="hljs-string">install</span> <span class="hljs-string">tomcat</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">tags:</span> <span class="hljs-string">installtc</span>
    <span class="hljs-attr">unarchive:</span>
      <span class="hljs-attr">src:</span> <span class="hljs-string">&quot;http://apachemirror.wuchna.com/tomcat/tomcat-8/v8.5.49/bin/apache-tomcat-8.5.49.tar.gz&quot;</span>
      <span class="hljs-attr">dest:</span> <span class="hljs-string">&quot;/opt/tomcat8/&quot;</span>
      <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span>
      <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">register:</span> <span class="hljs-string">&quot;tcinstall&quot;</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Start</span> <span class="hljs-string">the</span> <span class="hljs-string">tomcat</span> <span class="hljs-string">instance</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">shell:</span>
      <span class="hljs-string">&quot;./startup.sh&quot;</span>
    <span class="hljs-attr">args:</span>
      <span class="hljs-attr">chdir:</span> <span class="hljs-string">&quot;/opt/tomcat8/apache-tomcat-8.5.49/bin&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fget_url_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fget_url_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Downloads files from HTTP, HTTPS, or FTP to node
wget - Downloads files from HTTP, HTTPS, or FTP to the remote server. The remote server must have direct access to the remote resource.</p>
<pre><code class="language-bash"><span class="hljs-comment"># Run the Ansible get_url module against the managed_node in inventory file &quot;inventory&quot;</span>
<span class="hljs-comment"># The get_url module will copy the &quot;file_example_CSV_5000.csv&quot; file from https://file-examples-com.github.io</span>
<span class="hljs-comment"># to the managed host in the /tmp directory</span>
$ ansible managed_node -i inventory \
-m get_url \
-a <span class="hljs-string">&quot;url=&#x27;https://file-examples-com.github.io/uploads/2017/02/file_example_CSV_5000.csv&#x27; dest=/tmp/test.csv&quot;</span>  
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">foo.conf</span>
        <span class="hljs-attr">get_url:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://example.com/path/file.conf</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/foo.conf</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0440&#x27;</span>   

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">Tomcat8</span> <span class="hljs-string">from</span> <span class="hljs-string">tomcat.apache.org</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">appserver</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">a</span> <span class="hljs-string">Directory</span> <span class="hljs-string">/opt/tomcat8</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/tomcat8</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">directory</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">tomcat</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">tomcat</span>

   <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">Tomcat</span> <span class="hljs-string">using</span> <span class="hljs-string">get_url</span>
     <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
     <span class="hljs-attr">get_url:</span>
       <span class="hljs-attr">url:</span> <span class="hljs-string">https://www-us.apache.org/dist/tomcat/tomcat-8/v8.5.40/bin/apache-tomcat-8.5.40.tar.gz</span>
       <span class="hljs-attr">dest:</span> <span class="hljs-string">/opt/tomcat8</span>
       <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span>
       <span class="hljs-comment"># checksum: sha512:5bdea5414713c9ba39e226f062701fa14998b1a798c9750f956a0f59b5edabb8d83af9ec9f81cf9f47fa92c21b560c9b2be1b543d0bd8f1b49579b69101d3a8f</span>
       <span class="hljs-attr">checksum:</span> <span class="hljs-string">sha512:https://www.apache.org/dist/tomcat/tomcat-8/v8.5.40/bin/apache-tomcat-8.5.40.tar.gz.sha512</span>
       <span class="hljs-attr">group:</span> <span class="hljs-string">tomcat</span>
       <span class="hljs-attr">owner:</span> <span class="hljs-string">tomcat</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Play</span> <span class="hljs-string">Get-URL</span> <span class="hljs-string">Download</span> <span class="hljs-string">the</span> <span class="hljs-string">Protected</span> <span class="hljs-string">File</span> <span class="hljs-string">with</span> <span class="hljs-string">Basic</span> <span class="hljs-string">Authentication</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">appserver</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Access</span> <span class="hljs-string">the</span> <span class="hljs-string">WebSite</span> <span class="hljs-string">and</span> <span class="hljs-string">make</span> <span class="hljs-string">sure</span> <span class="hljs-string">the</span> <span class="hljs-string">URL</span> <span class="hljs-string">is</span> <span class="hljs-string">live</span>
      <span class="hljs-attr">uri:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://mwiweb02/admin/secure.txt</span>
        <span class="hljs-attr">status_code:</span> <span class="hljs-number">401</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">validateurl</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;INFO: HTTP Response for the URL&quot;</span>
      <span class="hljs-attr">debug:</span> <span class="hljs-string">var=validateurl.msg</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Access</span> <span class="hljs-string">the</span> <span class="hljs-string">same</span> <span class="hljs-string">URL</span> <span class="hljs-string">with</span> <span class="hljs-string">Basic</span> <span class="hljs-string">Authentication</span> <span class="hljs-string">and</span> <span class="hljs-string">Download</span> <span class="hljs-string">the</span> <span class="hljs-string">file</span>
      <span class="hljs-attr">get_url:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://mwiweb02/admin/secure.txt</span>
        <span class="hljs-attr">url_password:</span> <span class="hljs-string">Sarav@123</span>
        <span class="hljs-attr">url_username:</span> <span class="hljs-string">sarav</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/secure.txt</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">the</span> <span class="hljs-string">File</span> <span class="hljs-string">contents</span>
      <span class="hljs-attr">shell:</span> <span class="hljs-string">&gt;
         cat /tmp/secure.txt
</span>      <span class="hljs-attr">register:</span> <span class="hljs-string">shellout</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;INFO: Display the File Contents&quot;</span>
      <span class="hljs-attr">debug:</span> <span class="hljs-string">var=shellout.stdout_lines</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Play</span> <span class="hljs-string">Get-URL</span> <span class="hljs-string">Download</span> <span class="hljs-string">the</span> <span class="hljs-string">File</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">appserver</span>
  <span class="hljs-attr">tasks:</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Access</span> <span class="hljs-string">the</span> <span class="hljs-string">FTP</span> <span class="hljs-string">URL</span> <span class="hljs-string">and</span> <span class="hljs-string">download</span> <span class="hljs-string">the</span> <span class="hljs-string">file</span>
      <span class="hljs-attr">get_url:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">ftp://mwiweb02/admin/secure.txt</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/secure.txt</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Display</span> <span class="hljs-string">the</span> <span class="hljs-string">File</span> <span class="hljs-string">contents</span>
      <span class="hljs-attr">shell:</span> <span class="hljs-string">&gt;
         cat /tmp/secure.txt
</span>      <span class="hljs-attr">register:</span> <span class="hljs-string">shellout</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;INFO: Display the File Contents&quot;</span>
      <span class="hljs-attr">debug:</span> <span class="hljs-string">var=shellout.stdout_lines</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fgit_module.html%23git-module" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html#git-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html#git-module</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fgit_module.html%23git-module" aria-hidden="true">ðŸ”—</a></h2>
<p>Deploy software (or files) from git checkouts</p>
<pre><code class="language-bash"><span class="hljs-comment"># Run the Ansible git module against the managed_node in inventory file &quot;inventory&quot;</span>
<span class="hljs-comment"># The git module will copy Ansible git repository from GitHub</span>
<span class="hljs-comment"># to the managed host in the /tmp directory</span>
$ ansible managed_node -i inventory
    -m git
    -a <span class="hljs-string">&quot;repo=https://github.com/ansible/ansible.git dest=/tmp/ansible&quot;</span>
$ ansible managed_node -i inventory -m shell -a <span class="hljs-string">&quot;ls -ahsl /tmp/ansible&quot;</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-comment"># Example Create git archive from repo</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">git:</span>
        <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/ansible/ansible-examples.git</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/src/ansible-examples</span>
        <span class="hljs-attr">archive:</span> <span class="hljs-string">/tmp/ansible-examples.zip</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">git:</span>
        <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/ansible/ansible-examples.git</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/src/ansible-examples</span>
        <span class="hljs-attr">separate_git_dir:</span> <span class="hljs-string">/src/ansible-examples.git</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Farchive_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Farchive_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Creates a compressed archive of one or more files or trees.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Compress</span> <span class="hljs-string">directory</span> <span class="hljs-string">/path/to/foo/</span> <span class="hljs-string">into</span> <span class="hljs-string">/path/to/foo.tgz</span>
        <span class="hljs-attr">archive:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/path/to/foo</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/path/to/foo.tgz</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">a</span> <span class="hljs-string">bz2</span> <span class="hljs-string">archive</span> <span class="hljs-string">of</span> <span class="hljs-string">multiple</span> <span class="hljs-string">files,</span> <span class="hljs-string">rooted</span> <span class="hljs-string">at</span> <span class="hljs-string">/path</span>
        <span class="hljs-attr">archive:</span>
        <span class="hljs-attr">path:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">/path/to/foo</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">/path/wong/foo</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/path/file.tar.bz2</span>
        <span class="hljs-attr">format:</span> <span class="hljs-string">bz2</span>
</code></pre>
<p><code>var</code>: Be aware that <strong>this option already runs in Jinja2 context</strong> and has an implicit <code>{{ }}</code> wrapping, so you should not be using Jinja2 delimiters unless you are looking for double interpolation.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">Facts</span>
    <span class="hljs-attr">when:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">ansible.builtin.debug:</span>
    <span class="hljs-attr">var:</span> <span class="hljs-string">ansible_facts</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">Configuration</span> <span class="hljs-string">Variables</span>
    <span class="hljs-attr">ansible.builtin.debug:</span>
    <span class="hljs-attr">var:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item }}</span>&quot;</span> <span class="hljs-comment"># Double interpolation, var Ã¨ giÃ  eseguita in un Jinja2 context</span>
                      <span class="hljs-comment"># https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html#parameter-var</span>
    <span class="hljs-attr">loop:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">kernel_version</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ansible_user_id</span>
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fstat_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fstat_module.html" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">set</span> <span class="hljs-string">computed</span> <span class="hljs-string">variables</span> <span class="hljs-string">and</span> <span class="hljs-string">print</span> <span class="hljs-string">info</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gnome</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">monitor</span>
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">stats</span> <span class="hljs-string">of</span> <span class="hljs-string">monitors</span> <span class="hljs-string">file</span>
      <span class="hljs-attr">ansible.builtin.stat:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">~/.config/monitors.xml</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">st</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Screen</span> <span class="hljs-string">Scaling</span>
      <span class="hljs-attr">community.general.xml:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">~/.config/monitors.xml</span>
        <span class="hljs-attr">xpath:</span> <span class="hljs-string">/monitors/configuration/logicalmonitor/scale</span>
        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;2&#x27;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">st.stat.exists</span> <span class="hljs-string">and</span> <span class="hljs-string">st.stat.isreg</span>
<span class="hljs-string">...</span>
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checks</span> <span class="hljs-string">executed</span> <span class="hljs-string">before</span> <span class="hljs-string">execution</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">pre_checks</span>
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">stats</span> <span class="hljs-string">of</span> <span class="hljs-string">source</span> <span class="hljs-string">backup</span> <span class="hljs-string">files</span>
      <span class="hljs-attr">ansible.builtin.stat:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ rsync_home_src }}</span>&quot;</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">p</span>
      <span class="hljs-attr">delegate_to:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Fail</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">directory</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">Exists</span>
      <span class="hljs-attr">ansible.builtin.fail:</span>
        <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;Backup source directory doesn&#x27;t exists! <span class="hljs-template-variable">{{ rsync_home_src }}</span>&quot;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">not</span> <span class="hljs-string">(p.stat.isdir</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span> <span class="hljs-string">and</span> <span class="hljs-string">p.stat.isdir)</span>
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffind_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/find_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/find_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffind_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Return a list of files based on specific criteria.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Visual</span> <span class="hljs-string">Studio</span> <span class="hljs-string">Code</span> <span class="hljs-string">|</span> <span class="hljs-string">Find</span> <span class="hljs-string">Configuration</span>
  <span class="hljs-attr">find:</span>
    <span class="hljs-attr">paths:</span> <span class="hljs-string">~/workspaces/configuration/manjaro/home/$USER/.config/Code/User</span>
    <span class="hljs-attr">recurse:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">patterns:</span> <span class="hljs-string">&quot;*.json&quot;</span>
  <span class="hljs-attr">register:</span> <span class="hljs-string">files_to_copy</span>

<span class="hljs-comment"># Note that YAML double quotes require escaping backslashes but yaml single quotes do not.</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Find</span> <span class="hljs-string">/var/log</span> <span class="hljs-string">files</span> <span class="hljs-string">equal</span> <span class="hljs-string">or</span> <span class="hljs-string">greater</span> <span class="hljs-string">than</span> <span class="hljs-number">10</span> <span class="hljs-string">megabytes</span> <span class="hljs-string">ending</span> <span class="hljs-string">with</span> <span class="hljs-string">.old</span> <span class="hljs-string">or</span> <span class="hljs-string">.log.gz</span> <span class="hljs-string">via</span> <span class="hljs-string">regex</span>
  <span class="hljs-attr">find:</span>
    <span class="hljs-attr">paths:</span> <span class="hljs-string">/var/log</span>
    <span class="hljs-attr">patterns:</span> <span class="hljs-string">&quot;^.*?\\.(?:old|log\\.gz)$&quot;</span>
    <span class="hljs-attr">size:</span> <span class="hljs-string">10m</span>
    <span class="hljs-attr">use_regex:</span> <span class="hljs-literal">yes</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">multiple</span> <span class="hljs-string">patterns</span> <span class="hljs-string">that</span> <span class="hljs-string">contain</span> <span class="hljs-string">a</span> <span class="hljs-string">comma</span> <span class="hljs-string">formatted</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">YAML</span> <span class="hljs-string">list</span>
  <span class="hljs-attr">find:</span>
    <span class="hljs-attr">paths:</span> <span class="hljs-string">/var/log</span>
    <span class="hljs-attr">file_type:</span> <span class="hljs-string">file</span>
    <span class="hljs-attr">use_regex:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">patterns:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;^_[0-9]{2,4}_.*.log$&#x27;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;^[a-z]{1,5}_.*log$&#x27;</span>

<span class="hljs-comment"># Da Manjaro_LAMP</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Empty</span> <span class="hljs-string">datadir</span> <span class="hljs-string">find</span> <span class="hljs-string">/var/lib/mysql</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
  <span class="hljs-attr">ansible.builtin.find:</span>
    <span class="hljs-attr">paths:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ mariadb_datadir }}</span>&quot;</span>
    <span class="hljs-attr">hidden:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">recurse:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">file_type:</span> <span class="hljs-string">any</span>
  <span class="hljs-attr">register:</span> <span class="hljs-string">collected_files</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Empty</span> <span class="hljs-string">datadir</span> <span class="hljs-string">delete</span> <span class="hljs-string">contents</span> <span class="hljs-string">/var/lib/mysql</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
  <span class="hljs-attr">ansible.builtin.file:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item.path }}</span>&quot;</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span>
  <span class="hljs-attr">loop:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ collected_files.files }}</span>&quot;</span>
  <span class="hljs-attr">loop_control:</span>
    <span class="hljs-attr">label:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item.path }}</span>&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffile_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Ffile_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Manage files and file properties</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Change</span> <span class="hljs-string">file</span> <span class="hljs-string">ownership,</span> <span class="hljs-string">group</span> <span class="hljs-string">and</span> <span class="hljs-string">permissions</span>
        <span class="hljs-attr">file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/foo.conf</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">foo</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">foo</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0644&#x27;</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">a</span> <span class="hljs-string">directory</span> <span class="hljs-string">if</span> <span class="hljs-string">it</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">exist</span>
        <span class="hljs-attr">file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/some_directory</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">directory</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0755&#x27;</span>

    <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-comment"># - name: MariaDB | Delete datadir shell /var/lib/mysql | mariadb.yml</span>
    <span class="hljs-comment">#   ansible.builtin.shell: &quot;rm -rf {{ mariadb_datadir }}/* {{ mariadb_datadir }}/.*&quot;</span>
    <span class="hljs-comment">#   register: result</span>
    <span class="hljs-comment">#   changed_when: result.rc == 0</span>
    <span class="hljs-comment">#   failed_when: result.rc &gt; 0</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Remove</span> <span class="hljs-string">datadir</span> <span class="hljs-string">/var/lib/mysql</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-attr">ansible.builtin.file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ mariadb_datadir }}</span>&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MariaDB</span> <span class="hljs-string">|</span> <span class="hljs-string">Create</span> <span class="hljs-string">datadir</span> <span class="hljs-string">/var/lib/mysql</span> <span class="hljs-string">|</span> <span class="hljs-string">mariadb.yml</span>
      <span class="hljs-attr">ansible.builtin.file:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ mariadb_datadir }}</span>&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">directory</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0755&#x27;</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">mysql</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">mysql</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Freplace_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Freplace_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Replace all instances of a particular string in a file using a back-referenced regular expression.<br>
Sostituzioni con backreferences di espressioni regolari</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ansible</span> <span class="hljs-string">replace</span> <span class="hljs-string">string</span> <span class="hljs-string">example</span>
        <span class="hljs-attr">replace:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/ansible/sample.txt</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;Unix&#x27;</span>
        <span class="hljs-attr">replace:</span> <span class="hljs-string">&quot;Linux&quot;</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ansible</span> <span class="hljs-string">replace</span> <span class="hljs-string">string</span> <span class="hljs-string">example</span>
        <span class="hljs-attr">replace:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/hosts</span>
        <span class="hljs-attr">regexp:</span>  <span class="hljs-string">&#x27;(\s+)server\.myubuntu\.com(\s+.*)?$&#x27;</span>
        <span class="hljs-attr">replace:</span> <span class="hljs-string">&#x27;\1server.linuxtechi.info\2&#x27;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Flineinfile_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Flineinfile_module.html" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="https://www.middlewareinventory.com/blog/ansible-lineinfile-examples/">https://www.middlewareinventory.com/blog/ansible-lineinfile-examples/</a></li>
<li><a href="https://www.cloudbees.com/blog/ansible-lineinfile-9-ways-to-use-it-to-improve-your-playbooks">https://www.cloudbees.com/blog/ansible-lineinfile-9-ways-to-use-it-to-improve-your-playbooks</a></li>
<li><a href="https://docs.python.org/3/library/re.html">https://docs.python.org/3/library/re.html</a>
<ul>
<li><a href="https://docs.python.org/3/library/re.html#re.sub">https://docs.python.org/3/library/re.html#re.sub</a></li>
</ul>
</li>
<li><a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html">https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html#changed">https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html#changed</a></li>
</ul>
<p>Manage lines in text files.<br>
PuÃ² creare il file se non esiste.\ 
Permette di editare un file effettuando inserimenti e cancellazioni.</p>
<p><strong><code>validate</code></strong>: The validation command to run before copying the updated file into the final destination.<br>
A temporary file path is used to validate, passed in through <code>%s</code> which must be present. Also, the command is passed securely so shell features such as expansion and pipes will not work.</p>
<p><strong><code>check_mode</code></strong>: Can run in check_mode and return changed status prediction without modifying target
<strong><code>diff_mode</code></strong>:  Will return details on what has changed (or possibly needs changing in check_mode), when in diff mode</p>
<p><strong><code>search_string</code></strong>: The literal string to look for in every line of the file. This <strong>does not have to match the entire line</strong>.</p>
<ul>
<li>
<p>For <code>state=present</code>, the line to replace if the string is found in the file. Only the last line found will be replaced.</p>
</li>
<li>
<p>For <code>state=absent</code>, the line(s) to remove if the string is in the line.</p>
</li>
<li>
<p><strong>If the literal expression is not matched, the line will be added</strong> to the file in keeping with <code>insertbefore</code> or <code>insertafter</code> settings.</p>
<p>Mutually exclusive with <code>backrefs</code> and <code>regexp</code>.</p>
</li>
</ul>
<h3 id="esempi" tabindex="-1">Esempi <a class="header-anchor" href="#esempi" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-comment"># Da https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html#examples</span>
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Before 2.3, option &#x27;dest&#x27;, &#x27;destfile&#x27; or &#x27;name&#x27; was used instead of &#x27;path&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">SELinux</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">enforcing</span> <span class="hljs-string">mode</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/selinux/config</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^SELINUX=&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">SELINUX=enforcing</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Make</span> <span class="hljs-string">sure</span> <span class="hljs-string">group</span> <span class="hljs-string">wheel</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">sudoers</span> <span class="hljs-string">configuration</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sudoers</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^%wheel&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Replace</span> <span class="hljs-string">a</span> <span class="hljs-string">localhost</span> <span class="hljs-string">entry</span> <span class="hljs-string">with</span> <span class="hljs-string">our</span> <span class="hljs-string">own</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/hosts</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^127\.0\.0\.1&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-string">localhost</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0644&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Replace</span> <span class="hljs-string">a</span> <span class="hljs-string">localhost</span> <span class="hljs-string">entry</span> <span class="hljs-string">searching</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">literal</span> <span class="hljs-string">string</span> <span class="hljs-string">to</span> <span class="hljs-string">avoid</span> <span class="hljs-string">escaping</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/hosts</span>
        <span class="hljs-attr">search_string:</span> <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-string">localhost</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0644&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">the</span> <span class="hljs-string">default</span> <span class="hljs-string">Apache</span> <span class="hljs-string">port</span> <span class="hljs-string">is</span> <span class="hljs-number">8080</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^Listen &#x27;</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&#x27;^#Listen &#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">Listen</span> <span class="hljs-number">8080</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">php</span> <span class="hljs-string">extension</span> <span class="hljs-string">matches</span> <span class="hljs-string">new</span> <span class="hljs-string">pattern</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">search_string:</span> <span class="hljs-string">&#x27;&lt;FilesMatch &quot;.php[45]?$&quot;&gt;&#x27;</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&#x27;^\t&lt;Location \/&gt;\n&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;        &lt;FilesMatch &quot;.php[34]?$&quot;&gt;&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">we</span> <span class="hljs-string">have</span> <span class="hljs-string">our</span> <span class="hljs-string">own</span> <span class="hljs-string">comment</span> <span class="hljs-string">added</span> <span class="hljs-string">to</span> <span class="hljs-string">/etc/services</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/services</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^# port for http&#x27;</span>
        <span class="hljs-attr">insertbefore:</span> <span class="hljs-string">&#x27;^www.*80/tcp&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;# port for http by default&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Add</span> <span class="hljs-string">a</span> <span class="hljs-string">line</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">file</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">file</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">exist,</span> <span class="hljs-string">without</span> <span class="hljs-string">passing</span> <span class="hljs-string">regexp</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/testfile</span>
        <span class="hljs-attr">line:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.99</span> <span class="hljs-string">foo.lab.net</span> <span class="hljs-string">foo</span>
        <span class="hljs-attr">create:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Yaml requires escaping backslashes in double quotes but not in single quotes</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">the</span> <span class="hljs-string">JBoss</span> <span class="hljs-string">memory</span> <span class="hljs-string">settings</span> <span class="hljs-string">are</span> <span class="hljs-string">exactly</span> <span class="hljs-string">as</span> <span class="hljs-string">needed</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/jboss-as/bin/standalone.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^(.*)Xms(\d+)m(.*)$&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1Xms${xms}m\3&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Fully quoted because of the &#x27;: &#x27; on the line. See the Gotchas in the YAML docs.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Validate</span> <span class="hljs-string">the</span> <span class="hljs-string">sudoers</span> <span class="hljs-string">file</span> <span class="hljs-string">before</span> <span class="hljs-string">saving</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sudoers</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^%ADMIN ALL=&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;%ADMIN ALL=(ALL) NOPASSWD: ALL&#x27;</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">/usr/sbin/visudo</span> <span class="hljs-string">-cf</span> <span class="hljs-string">%s</span>
    <span class="hljs-comment"># See https://docs.python.org/3/library/re.html for further details on syntax</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">backrefs</span> <span class="hljs-string">with</span> <span class="hljs-string">alternative</span> <span class="hljs-string">group</span> <span class="hljs-string">syntax</span> <span class="hljs-string">to</span> <span class="hljs-string">avoid</span> <span class="hljs-string">conflicts</span> <span class="hljs-string">with</span> <span class="hljs-string">variable</span> <span class="hljs-string">values</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/config</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">^(host=).*</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">\g&lt;1&gt;{{</span> <span class="hljs-string">hostname</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">yes</span>

    <span class="hljs-comment"># Da Manjaro_Install</span>
    <span class="hljs-comment"># https://wiki.archlinux.org/index.php/Fsck#Boot_time_checking</span>
    <span class="hljs-comment"># https://forum.manjaro.org/t/how-to-enforce-boot-time-file-system-check/28363</span>
    <span class="hljs-comment"># Fix fsck-grub - attivazione di fsck con max mount count 30</span>
    <span class="hljs-comment"># fsck di systemd non viene eseguito se la root partition non Ã¨ readonly al boot</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Fsck</span> <span class="hljs-string">|</span> <span class="hljs-string">Fix</span> <span class="hljs-string">fsck-grub-systemd</span> <span class="hljs-string">|</span> <span class="hljs-string">Make</span> <span class="hljs-string">Root</span> <span class="hljs-string">Partition</span> <span class="hljs-string">Readonly</span> <span class="hljs-bullet">-</span> <span class="hljs-string">fsck.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/default/grub</span>
        <span class="hljs-comment"># regexp: &#x27;^#.*GRUB_ROOT_FS_RO&#x27;</span>
        <span class="hljs-comment"># line: &#x27;GRUB_ROOT_FS_RO=true&#x27;</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^.*#(.*GRUB_ROOT_FS_RO.*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SDDM</span> <span class="hljs-string">|</span> <span class="hljs-string">Set</span> <span class="hljs-string">Theme</span> <span class="hljs-bullet">-</span> <span class="hljs-string">sddm.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sddm.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^.*Current=&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;Current=maldives&#x27;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">SDDM</span> <span class="hljs-string">|</span> <span class="hljs-string">Restart</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SDDM</span> <span class="hljs-string">|</span> <span class="hljs-string">Set</span> <span class="hljs-string">HiDPI</span> <span class="hljs-bullet">-</span> <span class="hljs-string">sddm.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sddm.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^.*ServerArguments&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;ServerArguments=-nolisten tcp -dpi 250&#x27;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">SDDM</span> <span class="hljs-string">|</span> <span class="hljs-string">Restart</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Midnight</span> <span class="hljs-string">Commander</span> <span class="hljs-string">|</span> <span class="hljs-string">Set</span> <span class="hljs-string">Del</span> <span class="hljs-string">Key</span> <span class="hljs-bullet">-</span> <span class="hljs-string">gnome.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">~/.config/mc/mc.keymap</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">^.*Delete</span> <span class="hljs-string">=</span> <span class="hljs-string">f8$</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;Delete = delete&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Pacchetti</span> <span class="hljs-string">AUR</span> <span class="hljs-string">|</span> <span class="hljs-string">Configurazione</span> <span class="hljs-string">Sudo</span> <span class="hljs-string">Utente</span> <span class="hljs-string">AUR</span> <span class="hljs-bullet">-</span> <span class="hljs-string">main.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sudoers.d/11-install-aur_builder</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman&#x27;</span>
        <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># the file will be created if it does not already exist.</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0644&#x27;</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">&#x27;visudo -cf %s&#x27;</span>

    <span class="hljs-comment"># Da [ansible_examples](https://github.com/ansible/ansible-examples.git)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">insert</span> <span class="hljs-string">iptables</span> <span class="hljs-string">rule</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/sysconfig/iptables</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ mysql_port }}</span>&quot;</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&quot;^:OUTPUT &quot;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;-A INPUT -p tcp  --dport <span class="hljs-template-variable">{{ mysql_port }}</span> -j  ACCEPT&quot;</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">iptables</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">insert</span> <span class="hljs-string">iptables</span> <span class="hljs-string">rule</span> <span class="hljs-string">for</span> <span class="hljs-string">httpd</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/sysconfig/iptables</span>
        <span class="hljs-attr">create:</span> <span class="hljs-literal">yes</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ httpd_port }}</span>&quot;</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&quot;^:OUTPUT &quot;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;-A INPUT -p tcp  --dport <span class="hljs-template-variable">{{ httpd_port }}</span> -j  ACCEPT&quot;</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">iptables</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PRINT</span> <span class="hljs-string">DATA</span> <span class="hljs-string">TO</span> <span class="hljs-string">TERMINAL</span> <span class="hljs-string">WINDOW</span>
        <span class="hljs-attr">debug:</span>
          <span class="hljs-attr">var:</span> <span class="hljs-string">username_info.json</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">ansible.builtin.lineinfile:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;./username_info.yml&quot;</span>
          <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^username&#x27;</span>
          <span class="hljs-attr">insertafter:</span> <span class="hljs-string">EOF</span>
          <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;username: <span class="hljs-template-variable">{{username_info.json[0][&quot;success&quot;][&quot;username&quot;]}}</span>&#x27;</span>

    <span class="hljs-comment"># Da https://www.cloudbees.com/blog/ansible-lineinfile-9-ways-to-use-it-to-improve-your-playbooks</span>
    <span class="hljs-comment"># Changing Multiple Lines</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Change</span> <span class="hljs-string">SSH</span> <span class="hljs-string">daemon</span> <span class="hljs-string">configuration</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item.line }}</span>&quot;</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ item.regexp }}</span>&quot;</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/ssh/sshd_config</span>
      <span class="hljs-attr">loop:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">line:</span> <span class="hljs-string">GatewayPorts</span> <span class="hljs-literal">no</span>
          <span class="hljs-attr">regexp:</span> <span class="hljs-string">^GatewayPorts</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">line:</span> <span class="hljs-string">X11Forwarding</span> <span class="hljs-literal">yes</span>
          <span class="hljs-attr">regexp:</span> <span class="hljs-string">^X11Forwarding</span>

    <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">|</span> <span class="hljs-string">Servername</span> <span class="hljs-string">|</span> <span class="hljs-string">apache.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*#\s*(ServerName.*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">ServerName</span> <span class="hljs-string">localhost:80</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">httpd</span> <span class="hljs-string">-t</span> <span class="hljs-string">-f</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">line_check</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">|</span> <span class="hljs-string">Print</span> <span class="hljs-string">httpd.conf</span> <span class="hljs-string">Changed</span> <span class="hljs-string">|</span> <span class="hljs-string">apache.yml</span>
      <span class="hljs-comment"># https://ansible-lint.readthedocs.io/rules/no-handler/</span>
      <span class="hljs-comment"># noqa: no-handler</span>
      <span class="hljs-attr">ansible.builtin.debug:</span>
        <span class="hljs-attr">msg:</span> <span class="hljs-string">&#x27;httpd.conf changed&#x27;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">line_check.changed</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span> <span class="hljs-string">unique_id_module</span> <span class="hljs-string">|</span> <span class="hljs-string">apache.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*#\s*(LoadModule unique_id_module .*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">httpd</span> <span class="hljs-string">-t</span> <span class="hljs-string">-f</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">|</span> <span class="hljs-string">Disable</span> <span class="hljs-string">mpm_event_module</span> <span class="hljs-string">|</span> <span class="hljs-string">apache.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*(LoadModule mpm_event_module .*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;#\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-comment"># Non si puÃ² validare prima di aver abilitato un altro modulo MPM come mpm_prefork_module</span>
        <span class="hljs-comment"># validate: httpd -t -f %s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true    - name: PHP | Enable PHP | apache_php.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">{{ item }}</span>&#x27;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-comment"># Ora che Ã¨ stato abilitato un altro modulo MPM si puÃ² validare</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">httpd</span> <span class="hljs-string">-t</span> <span class="hljs-string">-f</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
      <span class="hljs-attr">loop:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">LoadModule</span> <span class="hljs-string">php_module</span> <span class="hljs-string">modules/libphp.so</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">AddHandler</span> <span class="hljs-string">php-script</span> <span class="hljs-string">.php</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Include</span> <span class="hljs-string">conf/extra/php_module.conf</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">|</span> <span class="hljs-string">Configure</span> <span class="hljs-string">PHP</span> <span class="hljs-string">Extentions</span> <span class="hljs-number">1</span> <span class="hljs-string">|</span> <span class="hljs-string">apache_php.yml</span>
      <span class="hljs-comment"># https://make.wordpress.org/hosting/handbook/server-environment/#php-extensions</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/php/php.ini</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*;\s*(<span class="hljs-template-variable">{{ item }}</span>.*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">php</span> <span class="hljs-string">--ini</span> <span class="hljs-string">-c</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
      <span class="hljs-attr">loop:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=bz2</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=exif</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=ftp</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=gd</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=iconv</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=intl</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=mysqli</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=pdo_mysql</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">extension=zip</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">|</span> <span class="hljs-string">Configure</span> <span class="hljs-string">PHP</span> <span class="hljs-string">Extentions</span> <span class="hljs-number">2</span> <span class="hljs-string">|</span> <span class="hljs-string">apache_php.yml</span>
      <span class="hljs-comment"># https://make.wordpress.org/hosting/handbook/server-environment/#php-extensions</span>
      <span class="hljs-comment"># bisogna avere installato il pacchetto php-imagick</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/php/conf.d/imagick.ini</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*;\s*(extension.*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">php</span> <span class="hljs-string">--ini</span> <span class="hljs-string">-c</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">|</span> <span class="hljs-string">Configure</span> <span class="hljs-string">PHP</span> <span class="hljs-string">Timezone</span> <span class="hljs-string">|</span> <span class="hljs-string">apache_php.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/php/php.ini</span>
        <span class="hljs-attr">search_string:</span> <span class="hljs-string">date.timezone</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;date.timezone = Europe/Rome&#x27;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">php</span> <span class="hljs-string">--ini</span> <span class="hljs-string">-c</span> <span class="hljs-string">%s</span>
      <span class="hljs-comment"># check_mode: &#x27;{{ check_mode_enabled }}&#x27;</span>
      <span class="hljs-comment"># diff: true</span>
      <span class="hljs-attr">notify:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">Apache</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Handlers</span> <span class="hljs-string">|</span> <span class="hljs-string">Verifica</span> <span class="hljs-string">finale</span> <span class="hljs-string">configurazione</span> <span class="hljs-string">PHP</span>


<span class="hljs-string">...</span>
</code></pre>
<h3 id="verifica-di-presenza-di-una-riga" tabindex="-1">Verifica di presenza di una riga <a class="header-anchor" href="#verifica-di-presenza-di-una-riga" aria-hidden="true">ðŸ”—</a></h3>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html">https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html#changed">https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html#changed</a></li>
<li><a href="https://stackoverflow.com/questions/29075287/ansible-insert-line-if-not-exists">https://stackoverflow.com/questions/29075287/ansible-insert-line-if-not-exists</a> <code>changed</code> e <code>found</code>
<ul>
<li><a href="https://stackoverflow.com/questions/73656480/ansible-what-is-the-difference-between-changed-and-found-in-return-values">https://stackoverflow.com/questions/73656480/ansible-what-is-the-difference-between-changed-and-found-in-return-values</a>
<ul>
<li>
<p><a href="https://github.com/ansible/ansible/blob/devel/lib/ansible/modules/lineinfile.py#L567">https://github.com/ansible/ansible/blob/devel/lib/ansible/modules/lineinfile.py#L567</a></p>
<pre><code class="language-python">changed = <span class="hljs-built_in">len</span>(found) &gt; <span class="hljs-number">0</span>
module.exit_json(changed=changed, found=<span class="hljs-built_in">len</span>(found), msg=msg, backup=backupdest, diff=difflist)
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Example: Validate if a String or line is present in the file&quot;</span>
      <span class="hljs-comment"># $ ansible web -m shell -a &quot;grep -i LogLevel /etc/httpd/conf/httpd.conf&quot; -i ansible_hosts</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">tags:</span> <span class="hljs-string">example_check</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;LogLevel debug&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-attr">backup:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">diff_mode:</span> <span class="hljs-literal">true</span>
      <span class="hljs-comment"># Con il check_mode abilitato il file non viene realmente modificato</span>
      <span class="hljs-attr">check_mode:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">changed_when:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">line_check</span>
    <span class="hljs-comment"># Se il file Ã¨ stato cambiato significa che la riga non c&#x27;era</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">File</span> <span class="hljs-string">Changed</span>
        <span class="hljs-attr">ansible.builtin.debug:</span>
          <span class="hljs-attr">msg:</span> <span class="hljs-string">&#x27;File Changed: The line was not found.&#x27;</span>
        <span class="hljs-attr">when:</span> <span class="hljs-string">line_check.found</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
        <span class="hljs-comment"># when: line_check.changed</span>
<span class="hljs-string">...</span>
</code></pre>
<h3 id="commentare%2Fdecommentare" tabindex="-1">Commentare/Decommentare <a class="header-anchor" href="#commentare%2Fdecommentare" aria-hidden="true">ðŸ”—</a></h3>
<ul>
<li><a href="https://stackoverflow.com/questions/39239602/commenting-out-a-line-with-ansible-lineinfile-module">https://stackoverflow.com/questions/39239602/commenting-out-a-line-with-ansible-lineinfile-module</a></li>
</ul>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Comment the Exisiting ServerAdmin Line&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">tags:</span> <span class="hljs-string">lineinfileexample6_1</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*(ServerAdmin .*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;# \1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">lineinfileexample6_1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Uncomment the Exisiting ServerAdmin Line&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">tags:</span> <span class="hljs-string">lineinfileexample6_1_2</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^\s*#*\s*(ServerAdmin .*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">lineinfileexample6_1_2</span>

    <span class="hljs-comment"># Da Manjaro_Install</span>
    <span class="hljs-comment"># https://wiki.archlinux.org/index.php/Fsck#Boot_time_checking</span>
    <span class="hljs-comment"># https://forum.manjaro.org/t/how-to-enforce-boot-time-file-system-check/28363</span>
    <span class="hljs-comment"># Fix fsck-grub - attivazione di fsck con max mount count 30</span>
    <span class="hljs-comment"># fsck di systemd non viene eseguito se la root partition non Ã¨ readonly al boot</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Fsck</span> <span class="hljs-string">|</span> <span class="hljs-string">Fix</span> <span class="hljs-string">fsck-grub-systemd</span> <span class="hljs-string">|</span> <span class="hljs-string">Make</span> <span class="hljs-string">Root</span> <span class="hljs-string">Partition</span> <span class="hljs-string">Readonly</span> <span class="hljs-bullet">-</span> <span class="hljs-string">fsck.yml</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/default/grub</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^.*#(.*GRUB_ROOT_FS_RO.*)&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;\1&#x27;</span>
        <span class="hljs-attr">backrefs:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Example6: Add a New ServerAdmin Before the Commented Line&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">tags:</span> <span class="hljs-string">lineinfileexample6_2</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">insertbefore:</span> <span class="hljs-string">&#x27;# ServerAdmin .*&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;ServerAdmin aksarav@middlewareinventory.com&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
      <span class="hljs-attr">register:</span> <span class="hljs-string">lineinfileexample6_2</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Example7: Update the ServerName - Validate the Changes Before Saving/Committing&quot;</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&#x27;#ServerName www.example.com:80&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&quot;ServerName www.middlewareinventory.com:80&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
        <span class="hljs-comment"># Command to Validate the Configuration and %s is a working copy of the file</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">&quot;httpd -t -f %s&quot;</span>
    <span class="hljs-comment"># Here the %s is the working copy of the actual file. Ansible would always copy the file and keep it as a working copy and make the changes and finally copy it over to the Destined location and replace the original file.</span>

    <span class="hljs-comment"># Da https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html#examples</span>
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Before 2.3, option &#x27;dest&#x27;, &#x27;destfile&#x27; or &#x27;name&#x27; was used instead of &#x27;path&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">the</span> <span class="hljs-string">default</span> <span class="hljs-string">Apache</span> <span class="hljs-string">port</span> <span class="hljs-string">is</span> <span class="hljs-number">8080</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^Listen &#x27;</span>
        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&#x27;^#Listen &#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">Listen</span> <span class="hljs-number">8080</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">we</span> <span class="hljs-string">have</span> <span class="hljs-string">our</span> <span class="hljs-string">own</span> <span class="hljs-string">comment</span> <span class="hljs-string">added</span> <span class="hljs-string">to</span> <span class="hljs-string">/etc/services</span>
      <span class="hljs-attr">ansible.builtin.lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/services</span>
        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^# port for http&#x27;</span>
        <span class="hljs-attr">insertbefore:</span> <span class="hljs-string">&#x27;^www.*80/tcp&#x27;</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;# port for http by default&#x27;</span>
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fuser_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fuser_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Manage user accounts</p>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/getent_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/getent_module.html</a></li>
</ul>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">determine</span> <span class="hljs-string">available</span> <span class="hljs-string">users</span>
  <span class="hljs-attr">getent:</span>
    <span class="hljs-attr">database:</span> <span class="hljs-string">passwd</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">aur_builder</span>
    <span class="hljs-attr">fail_key:</span> <span class="hljs-literal">false</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">debug</span> <span class="hljs-string">users</span>
  <span class="hljs-attr">debug:</span>
    <span class="hljs-attr">var:</span> <span class="hljs-string">getent_passwd</span>
  <span class="hljs-attr">when:</span> <span class="hljs-string">getent_passwd</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">aur_user_create</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">user:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">aur_builder</span>
    <span class="hljs-attr">create_home:</span> <span class="hljs-literal">no</span>
    <span class="hljs-attr">group:</span> <span class="hljs-string">wheel</span>
    <span class="hljs-comment"># state: absent</span>
  <span class="hljs-attr">when:</span> <span class="hljs-string">getent_passwd</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">defined</span>  
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">aur_user_sudo_config</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">lineinfile:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sudoers.d/11-install-aur_builder</span>
    <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman&#x27;</span>
    <span class="hljs-attr">create:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">validate:</span> <span class="hljs-string">&#x27;visudo -cf %s&#x27;</span>
  <span class="hljs-attr">when:</span> <span class="hljs-string">getent_passwd</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">defined</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fservice_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fservice_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Manage services.<br>
Supported init systems include BSD init, OpenRC, SysV, Solaris SMF, systemd, upstart.<br>
This module is a proxy for multiple more specific service manager modules (such as <code>ansible.builtin.systemd</code> and <code>ansible.builtin.sysvinit</code>).<br>
The module to be executed is determined by the <code>use</code> option, which defaults to the service manager discovered by <code>ansible.builtin.setup</code> <code>ansible_service_mgr</code> fact</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Example</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Start</span> <span class="hljs-string">service</span> <span class="hljs-string">foo,</span> <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">running</span> <span class="hljs-string">process</span> <span class="hljs-string">/usr/bin/foo</span>
        <span class="hljs-attr">service:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">foo</span>
        <span class="hljs-attr">pattern:</span> <span class="hljs-string">/usr/bin/foo</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Restart</span> <span class="hljs-string">network</span> <span class="hljs-string">service</span> <span class="hljs-string">for</span> <span class="hljs-string">interface</span> <span class="hljs-string">eth0</span>
        <span class="hljs-attr">service:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">network</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">restarted</span>
        <span class="hljs-attr">args:</span> <span class="hljs-string">eth0</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fsystemd_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fbuiltin%2Fsystemd_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Controls systemd units (services, timers, and so on) on remote hosts.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Preload</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">preload</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">ansible.builtin.systemd:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">preload</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Systemd</span> <span class="hljs-string">Backup</span> <span class="hljs-string">Service</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span>
  <span class="hljs-attr">ansible.builtin.systemd:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">backup</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">user</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">restarted</span>
    <span class="hljs-attr">daemon_reload:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">force:</span> <span class="hljs-literal">true</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ClamAV</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span>
  <span class="hljs-attr">ansible.builtin.systemd:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">clamav-daemon</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">system</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ClamAV</span> <span class="hljs-string">|</span> <span class="hljs-string">Freshclam</span> <span class="hljs-string">Enable</span>
  <span class="hljs-attr">ansible.builtin.systemd:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">clamav-freshclam</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">system</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>
<span class="hljs-string">...</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsysctl_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/sysctl_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/sysctl_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fsysctl_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>This module manipulates sysctl entries and optionally performs a <code>/sbin/sysctl -p</code> after changing them.</p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span>  <span class="hljs-string">fs.inotify.max_user_watches</span> <span class="hljs-string">|</span> <span class="hljs-string">set</span>
  <span class="hljs-attr">ansible.posix.sysctl:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">fs.inotify.max_user_watches</span>
    <span class="hljs-attr">value:</span> <span class="hljs-number">524288</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">sysctl_file:</span> <span class="hljs-string">/etc/sysctl.d/60-max_user_watches.conf</span>
    <span class="hljs-attr">sysctl_set:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">reload:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">when:</span>  <span class="hljs-string">max_user_watches.stdout|int</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">524288</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Sysctl</span> <span class="hljs-string">|</span> <span class="hljs-string">Abilitazione</span> <span class="hljs-string">SysRq</span> <span class="hljs-string">per</span> <span class="hljs-string">REISUDO</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">sysctl</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">sysrq</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">ansible.posix.sysctl:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">kernel.sysrq</span>
    <span class="hljs-attr">value:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">sysctl_file:</span> <span class="hljs-string">/etc/sysctl.d/60-sysrq.conf</span>
    <span class="hljs-attr">reload:</span> <span class="hljs-literal">false</span>

<span class="hljs-comment"># Set ip forwarding on in /proc and in the sysctl file and reload if necessary</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">ansible.posix.sysctl:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">net.ipv4.ip_forward</span>
    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;1&#x27;</span>
    <span class="hljs-attr">sysctl_set:</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">reload:</span> <span class="hljs-literal">yes</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fauthorized_key_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fansible%2Fposix%2Fauthorized_key_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Adds or removes an SSH authorized key.</p>
<p>You might already have this collection installed if you are using the ansible package.<br>
It is not included in <code>ansible-core</code>. To check whether it is installed, run</p>
<pre><code class="language-bash">ansible-galaxy collection list
</code></pre>
<p>To install it, use:</p>
<pre><code class="language-bash">ansible-galaxy collection install ansible.posix
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">authorized</span> <span class="hljs-string">key</span> <span class="hljs-string">taken</span> <span class="hljs-string">from</span> <span class="hljs-string">file</span>
  <span class="hljs-attr">ansible.posix.authorized_key:</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">charlie</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ lookup(&#x27;file&#x27;, &#x27;/home/charlie/.ssh/id_rsa.pub&#x27;) }}</span>&quot;</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">authorized</span> <span class="hljs-string">key,</span> <span class="hljs-string">removing</span> <span class="hljs-string">all</span> <span class="hljs-string">the</span> <span class="hljs-string">authorized</span> <span class="hljs-string">keys</span> <span class="hljs-string">already</span> <span class="hljs-string">set</span>
  <span class="hljs-attr">ansible.posix.authorized_key:</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ lookup(&#x27;file&#x27;, &#x27;public_keys/doe-jane&#x27;) }}</span>&quot;</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">exclusive:</span> <span class="hljs-literal">True</span>
    
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">authorized</span> <span class="hljs-string">key</span> <span class="hljs-string">for</span> <span class="hljs-string">user</span> <span class="hljs-string">ubuntu</span> <span class="hljs-string">copying</span> <span class="hljs-string">it</span> <span class="hljs-string">from</span> <span class="hljs-string">current</span> <span class="hljs-string">user</span>
  <span class="hljs-attr">ansible.posix.authorized_key:</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">ubuntu</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ lookup(&#x27;file&#x27;, lookup(&#x27;env&#x27;,&#x27;HOME&#x27;) + &#x27;/.ssh/id_rsa.pub&#x27;) }}</span>&quot;</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fpacman_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fpacman_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Manage packages with pacman.</p>
<p>Manage AUR packages with pacman:</p>
<ul>
<li><a href="https://github.com/Jguer/yay">https://github.com/Jguer/yay</a> - An AUR Helper Written in Go</li>
</ul>
<p>Per effettuare la build di pacchetti AUR mediante pacman si deve installare l'helper YAY:</p>
<pre><code class="language-bash"><span class="hljs-built_in">sudo</span> pacman -Syu --needed yay
</code></pre>
<p>To use YAY AUR helper (executable option), a few extra setup steps are required beforehand. <br>
<strong>A dedicated build user with permissions to install packages is necessary.</strong></p>
<ul>
<li><a href="https://github.com/Jguer/yay">https://github.com/Jguer/yay</a></li>
<li><a href="https://github.com/kewlfft/ansible-aur#create-the-aur_builder-user">https://github.com/kewlfft/ansible-aur#create-the-aur_builder-user</a></li>
<li>&lt;<a href="https://github.com/Jguer/yay/issues/1026">https://github.com/Jguer/yay/issues/1026</a> Allow installing AUR packages as root with yay&gt;</li>
</ul>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">Example</span> <span class="hljs-string">Playbook</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
  <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">become_method:</span> <span class="hljs-string">sudo</span>
  <span class="hljs-attr">vars:</span>
      <span class="hljs-comment"># ansible_become_password: ... definita nel file $ANSIBLE_VAULT_PASSWORD_FILE, oppure parametri -K, --ask-become-pass di ansible-playbook </span>
      <span class="hljs-attr">update_system:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">tasks:</span>
      <span class="hljs-comment"># https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Full</span> <span class="hljs-string">Manjaro</span> <span class="hljs-string">system</span> <span class="hljs-string">upgrade</span>
          <span class="hljs-attr">pacman:</span>
          <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">yes</span>
          <span class="hljs-attr">upgrade:</span> <span class="hljs-literal">yes</span>
          <span class="hljs-comment"># https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html</span>
          <span class="hljs-comment"># https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html</span>
          <span class="hljs-attr">when:</span> <span class="hljs-string">update_system</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Midnight</span> <span class="hljs-string">Commander</span>
          <span class="hljs-attr">pacman:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">mc</span>
          <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>
          <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">no</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">webserver</span>
          <span class="hljs-attr">pacman:</span>
          <span class="hljs-attr">name:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">nginx</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">postgresql</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">postgresql-server</span>
          <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">AUR</span>
        <span class="hljs-attr">community.general.pacman:</span>
          <span class="hljs-attr">name:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">opencl-amd</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">dislocker</span>
          <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>
          <span class="hljs-attr">executable:</span> <span class="hljs-string">yay</span>                       <span class="hljs-comment"># Utilizzo dell&#x27;helper YAY per la build dei pacchetti AUR</span>
          <span class="hljs-attr">extra_args:</span> <span class="hljs-string">--builddir</span> <span class="hljs-string">/var/cache/yay</span>

      <span class="hljs-comment"># Da Manjaro_LAMP</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">|</span> <span class="hljs-string">Full</span> <span class="hljs-string">Manjaro</span> <span class="hljs-string">System</span> <span class="hljs-string">Upgrade</span> <span class="hljs-string">|</span> <span class="hljs-string">pacman.yml</span>
      <span class="hljs-attr">community.general.pacman:</span>
        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">upgrade:</span> <span class="hljs-literal">true</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">|</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">YAY</span> <span class="hljs-string">AUR</span> <span class="hljs-string">Helper</span> <span class="hljs-string">|</span> <span class="hljs-string">pacman.yml</span>
      <span class="hljs-comment"># yay: helper per l&#x27;installazione dei pacchetti AUR</span>
      <span class="hljs-attr">community.general.pacman:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">yay</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">|</span> <span class="hljs-string">Disinstallazione</span> <span class="hljs-string">Pacchetti</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">da</span> <span class="hljs-string">elenco</span> <span class="hljs-string">defaults/main.yml</span> <span class="hljs-string">|</span> <span class="hljs-string">pacman.yml</span>
      <span class="hljs-comment"># Ci sono dei pacchetti che vanno prima disinstallati per evitare conflitti/problemi</span>
      <span class="hljs-attr">community.general.pacman:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ pacman_pakages_remove }}</span>&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span>
        <span class="hljs-attr">force:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">extra_args:</span> <span class="hljs-string">--recursive</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">pacman_pakages_remove</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span> <span class="hljs-string">and</span> <span class="hljs-string">(pacman_pakages_remove|length</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span><span class="hljs-string">)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">|</span> <span class="hljs-string">Installazione</span> <span class="hljs-string">Pacchetti</span> <span class="hljs-string">Pacman</span> <span class="hljs-string">da</span> <span class="hljs-string">elenco</span> <span class="hljs-string">defaults/main.yml</span> <span class="hljs-string">|</span> <span class="hljs-string">pacman.yml</span>
      <span class="hljs-attr">community.general.pacman:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{ pacman_pakages }}</span>&quot;</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>
        <span class="hljs-attr">extra_args:</span> <span class="hljs-string">--needed</span>
      <span class="hljs-attr">notify:</span> <span class="hljs-string">Updatedb</span> <span class="hljs-comment"># per aggiornare mlocate</span>
</code></pre>
<h3 id="ansible-aur" tabindex="-1">Ansible-AUR <a class="header-anchor" href="#ansible-aur" aria-hidden="true">ðŸ”—</a></h3>
<p>Non lo sto utilizzando, ho preferito il package standard <code>community.general.pacman</code> in combinazione con <code>yay</code></p>
<ul>
<li><a href="https://github.com/kewlfft/ansible-aur">https://github.com/kewlfft/ansible-aur</a></li>
<li><a href="https://wiki.archlinux.org/title/Ansible#AUR">https://wiki.archlinux.org/title/Ansible#AUR</a></li>
<li><a href="https://github.com/Jguer/yay">https://github.com/Jguer/yay</a>  An AUR Helper Written in Go</li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html</a></li>
</ul>
<p>ansible-aur non puÃ² lavorare con il normale utente abilitato sudo perchÃ¨ i tool di build vietano di essere invocati da root,
per risolvere il problema si crea un utente che con sudo non abbia bisogno di fornire la password</p>
<pre><code class="language-bash">$ ansible-galaxy install kewlfft.aur
Starting galaxy role install process
- downloading role <span class="hljs-string">&#x27;aur&#x27;</span>, owned by kewlfft
- downloading role from https://github.com/kewlfft/ansible-aur/archive/master.tar.gz
- extracting kewlfft.aur to `/home/<span class="hljs-variable">$USER</span>/.ansible/roles/kewlfft.aur`
- `kewlfft.aur` (master) was installed successfully
</code></pre>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/collections/index_module.html">https://docs.ansible.com/ansible/latest/collections/index_module.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/getent_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/getent_module.html</a></li>
</ul>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Manjaro</span> <span class="hljs-string">Post</span> <span class="hljs-string">Installation</span> <span class="hljs-string">Steps</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">manjaro</span>
  <span class="hljs-attr">roles:</span>
    <span class="hljs-comment"># https://github.com/kewlfft/ansible-aur</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">kewlfft.aur</span>
  <span class="hljs-attr">tasks:</span>

    <span class="hljs-comment"># https://github.com/kewlfft/ansible-aur</span>
    <span class="hljs-comment"># creazione dell&#x27;utenza sudo necessaria alla build AUR</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">aur_user_create</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">user:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">aur_builder</span>
        <span class="hljs-attr">create_home:</span> <span class="hljs-literal">no</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">wheel</span>
        <span class="hljs-comment"># state: absent</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">aur_user_sudo_config</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">lineinfile:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sudoers.d/11-install-aur_builder</span>
        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman&#x27;</span>
        <span class="hljs-attr">create:</span> <span class="hljs-literal">yes</span>
        <span class="hljs-attr">validate:</span> <span class="hljs-string">&#x27;visudo -cf %s&#x27;</span>

    <span class="hljs-comment"># Install package_name using the first known helper found</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install_aur</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">become_user:</span> <span class="hljs-string">aur_builder</span>
      <span class="hljs-attr">aur:</span>
        <span class="hljs-attr">name:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">opencl-amd</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">dislocker</span>

</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fufw_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fufw_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>Manage firewall with UFW.</p>
<p>name: string Use profile located in <code>/etc/ufw/applications.d</code><br>
aliases: <code>app</code></p>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configurazione</span> <span class="hljs-string">Firewall</span> <span class="hljs-string">UFW</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ufw</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">UFW</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span>
      <span class="hljs-attr">community.general.ufw:</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">enabled</span>
        <span class="hljs-attr">policy:</span> <span class="hljs-string">deny</span>
        <span class="hljs-attr">direction:</span> <span class="hljs-string">incoming</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">UFW</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span> <span class="hljs-string">for</span> <span class="hljs-string">CIFS</span>
      <span class="hljs-attr">community.general.ufw:</span>
        <span class="hljs-attr">rule:</span> <span class="hljs-string">allow</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">CIFS</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">UFW</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span> <span class="hljs-string">for</span> <span class="hljs-string">SSH</span>
      <span class="hljs-attr">community.general.ufw:</span>
        <span class="hljs-attr">rule:</span> <span class="hljs-string">allow</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">SSH</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">UFW</span> <span class="hljs-string">|</span> <span class="hljs-string">Enable</span> <span class="hljs-string">Logging</span>
      <span class="hljs-attr">community.general.ufw:</span>
        <span class="hljs-attr">logging:</span> <span class="hljs-string">low</span>
</code></pre>
<h2 id="https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fxml_module.html" tabindex="-1"><a href="https://docs.ansible.com/ansible/latest/collections/community/general/xml_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/xml_module.html</a> <a class="header-anchor" href="#https%3A%2F%2Fdocs.ansible.com%2Fansible%2Flatest%2Fcollections%2Fcommunity%2Fgeneral%2Fxml_module.html" aria-hidden="true">ðŸ”—</a></h2>
<p>A CRUD-like interface to managing bits of XML files.</p>
<p>The below requirements are needed on the host that executes this module:</p>
<p>lxml &gt;= 2.3.0</p>
<pre><code class="language-bash"><span class="hljs-built_in">sudo</span> pacman -Syu --needed python-lxml
</code></pre>
<pre><code class="language-yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Screen</span> <span class="hljs-string">Scaling</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gnome</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">monitor</span>
  <span class="hljs-attr">community.general.xml:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">~/.config/monitors.xml</span>
    <span class="hljs-attr">xpath:</span> <span class="hljs-string">/monitors/configuration/logicalmonitor/scale</span>
    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;2&#x27;</span>
</code></pre>
</body></html>