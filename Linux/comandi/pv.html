<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-08 13:38:20.187" />
        <title>pv</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../inc/js/hljs/styles/default.css" />
        <script src="../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="pv" tabindex="-1">pv <a class="header-anchor" href="#pv" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-08 13:38:20.187</p>
<nav class="table-of-contents"><ol></ol></nav><h1 id="pipe-viewer" tabindex="-1">Pipe Viewer <a class="header-anchor" href="#pipe-viewer" aria-hidden="true">ðŸ”—</a></h1>
<pre><code class="language-bash">$ pamac search <span class="hljs-string">&#x27;^pv$&#x27;</span>
pv  1.6.6-3  community 
    A terminal-based tool <span class="hljs-keyword">for</span> monitoring the progress of data through a pipeline.

$ <span class="hljs-built_in">sudo</span> pamac install pv
</code></pre>
<ul>
<li><a href="http://www.ivarch.com/programs/pv.shtml">http://www.ivarch.com/programs/pv.shtml</a></li>
</ul>
<p>`pv' - Pipe Viewer - is a terminal-based tool for monitoring the progress of data through a pipeline. It can be inserted into any normal pipeline between two processes to give a visual indication of how quickly data is passing through, how long it has taken, how near to completion it is, and an estimate of how long it will be until completion.</p>
<pre><code class="language-bash">apt-get install pv
$ gzip -c access.log &gt; access.log.gz
$ pv access.log | gzip &gt; access.log.gz
611MB 0:00:11 [58.3MB/s] [=&gt; ] 15% ETA 0:00:59
</code></pre>
<p>Pipe viewer acts as &quot;cat&quot; here, except it also adds a progress bar.
We can see that gzip processed 611MB of data in 11 seconds. It has processed 15% of all data and it will take 59 more seconds to finish.</p>
<p>You may stick several pv processes in between. For example, you can time how fast the data is being read from the disk and how much data is gzip outputting:</p>
<pre><code class="language-bash">$ pv -cN <span class="hljs-built_in">source</span> access.log | gzip | pv -cN gzip &gt; access.log.gz
<span class="hljs-built_in">source</span>: 760MB 0:00:15 [37.4MB/s] [=&gt; ] 19% ETA 0:01:02
gzip: 34.5MB 0:00:15 [1.74MB/s] [ &lt;=&gt; ]
</code></pre>
<p>Here we specified the ?-N? parameter to pv to create a named stream. The ?-c? parameter makes sure the output is not garbaged by one pv process writing over the other.</p>
<p>This example shows that ?access.log? file is being read at a speed of 37.4MB/s but gzip is writing data at only 1.74MB/s. We can immediately calculate the compression rate. It?s 37.4/1.74 = 21x!</p>
<pre><code class="language-bash">$ tar -czf - . | pv &gt; out.tgz
117MB 0:00:55 [2.7MB/s] [&gt; ]

$ tar -cf - . | pv -s $(<span class="hljs-built_in">du</span> -sb . | awk <span class="hljs-string">&#x27;{print $1}&#x27;</span>) | gzip &gt; out.tgz
253MB 0:00:05 [46.7MB/s] [&gt; ] 1% ETA 0:04:49
</code></pre>
<p>What happens here is we tell tar to create ?-c? an archive of all files in current dir ?.? (recursively) and output the data to stdout ?-f -?. Next we specify the size ?-s? to pv of all files in current dir. The ?du -sb . | awk ?{print $1}?? returns number of bytes in current dir, and it gets fed as ?-s? parameter to pv. Next we gzip the whole content and output the result to out.tgz file. This way ?pv? knows how much data is still left to be processed and shows us that it will take yet another 4 mins 49 secs to finish.</p>
<pre><code class="language-bash">$ pv /dev/zero &gt; /dev/null
157GB 0:00:38 [4,17GB/s]
</code></pre>
<pre><code class="language-bash">$ tar -cf - /path/to/dir | pv | nc -l -p 6666 -q 5
$ nc 192.168.1.100 6666 | pv | tar -xf -
</code></pre>
<pre><code class="language-bash"><span class="hljs-comment"># pv per aggiungere una progress bar</span>
$ tar -c /var/lib/mysql | pv --size `<span class="hljs-built_in">du</span> -sh /var/lib/mysql/. | <span class="hljs-built_in">cut</span> -f1` | pigz -5 | nc -l 8888
14.5GB 0:03:12 [77.1MB/s] [===================================&gt; ] 96%
$ pacman -Syu pigz pv
$ pigz -dc <span class="hljs-variable">$USER</span>.tar.gz | pv | tar -xf -
</code></pre>
</body></html>