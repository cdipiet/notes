<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-08 13:44:53.425" />
        <title>ext4</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../inc/js/hljs/styles/default.css" />
        <script src="../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="ext4" tabindex="-1">ext4 <a class="header-anchor" href="#ext4" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-08 13:44:53.425</p>
<nav class="table-of-contents"><ol><li><a href="#formattare-un-hard-disk">Formattare un Hard Disk </a><ol><li><a href="#listing-partitions">Listing partitions </a></li><li><a href="#creating-partitions-with-fdisk">Creating partitions with fdisk </a></li></ol></li><li><a href="#formatting-partitions-in-linux">Formatting partitions in Linux </a></li><li><a href="#fsck">fsck </a></li><li><a href="#impostare-label-per-ext4">Impostare label per ext4 </a></li><li><a href="#velocizzare-ext4---utilizzo-di-indicizzazione-directory">Velocizzare ext4 - Utilizzo di indicizzazione Directory </a></li><li><a href="#resize">Resize </a><ol><li><a href="#enlarge">Enlarge </a></li><li><a href="#shrink">Shrink </a></li><li><a href="#esempio-shrink">Esempio shrink </a></li><li><a href="#esempio-enlarge">Esempio enlarge </a></li></ol></li></ol></nav><h1 id="ext4-1" tabindex="-1">Ext4 <a class="header-anchor" href="#ext4-1" aria-hidden="true">ðŸ”—</a></h1>
<h2 id="formattare-un-hard-disk" tabindex="-1">Formattare un Hard Disk <a class="header-anchor" href="#formattare-un-hard-disk" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="https://man.archlinux.org/man/lsblk.8">https://man.archlinux.org/man/lsblk.8</a> lsblk - list block devices</li>
<li><a href="https://man.archlinux.org/man/gdisk.8">https://man.archlinux.org/man/gdisk.8</a> gdisk - Interactive GUID partition table (GPT) manipulator</li>
<li><a href="https://man.archlinux.org/man/sgdisk.8">https://man.archlinux.org/man/sgdisk.8</a> sgdisk - Command-line GUID partition table (GPT) manipulator for Linux and Unix</li>
<li><a href="https://man.archlinux.org/man/fdisk.8">https://man.archlinux.org/man/fdisk.8</a></li>
<li><a href="https://man.archlinux.org/man/mkfs.ext4.8">https://man.archlinux.org/man/mkfs.ext4.8</a> mke2fs - create an ext2/ext3/ext4 file system</li>
<li><a href="https://man.archlinux.org/man/e2label.8">https://man.archlinux.org/man/e2label.8</a> e2label - Change the label on an ext2/ext3/ext4 file system</li>
<li><a href="https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en">https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en</a> resize2fs - ext2/ext3/ext4 file system resizer. <strong>does not manipulate the size of partitions</strong></li>
<li><a href="https://man.archlinux.org/man/growpart.1">https://man.archlinux.org/man/growpart.1</a> growpart - extend last partition in a partition table to fill available space</li>
<li><a href="https://man.archlinux.org/man/core/e2fsprogs/e2fsck.8.en">https://man.archlinux.org/man/core/e2fsprogs/e2fsck.8.en</a></li>
<li><a href="https://wiki.archlinux.org/title/persistent_block_device_naming">https://wiki.archlinux.org/title/persistent_block_device_naming</a></li>
<li><a href="https://wiki.archlinux.org/title/installation_guide#Format_the_partitions">https://wiki.archlinux.org/title/installation_guide#Format_the_partitions</a></li>
<li><a href="https://wiki.archlinux.org/title/partitioning">https://wiki.archlinux.org/title/partitioning</a></li>
<li><a href="https://wiki.archlinux.org/title/fdisk">https://wiki.archlinux.org/title/fdisk</a></li>
<li><a href="https://www.redhat.com/sysadmin/partitions-fdisk">https://www.redhat.com/sysadmin/partitions-fdisk</a></li>
<li><a href="https://superuser.com/questions/1099232/what-is-the-difference-between-a-partition-name-and-a-partition-label">https://superuser.com/questions/1099232/what-is-the-difference-between-a-partition-name-and-a-partition-label</a></li>
<li><a href="https://superuser.com/questions/1099232/what-is-the-difference-between-a-partition-name-and-a-partition-label">How to set the PARTLABEL for a GPT partition?</a></li>
<li><a href="https://gist.github.com/burningTyger/cb6e61afdeb527f4b87e57774ac40f16">Install Arch</a></li>
</ul>
<h3 id="listing-partitions" tabindex="-1">Listing partitions <a class="header-anchor" href="#listing-partitions" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash">$ <span class="hljs-built_in">sudo</span> fdisk -x
  Disk /dev/sda: 3,64 TiB, 4000787030016 bytes, 7814037168 sectors
  Disk model: Samsung SSD 870 
  Units: sectors of 1 * 512 = 512 bytes
  Sector size (logical/physical): 512 bytes / 512 bytes
  I/O size (minimum/optimal): 512 bytes / 512 bytes
  Disklabel <span class="hljs-built_in">type</span>: gpt
  Disk identifier: E4FF6C8E-E6F7-B344-8EEB-CC8E599107CC
  First usable LBA: 2048
  Last usable LBA: 7814037134
  Alternative LBA: 7814037167
  Partition entries starting LBA: 2
  Allocated partition entries: 128
  Partition entries ending LBA: 33

  Dispositivo      Start       Fine    Settori Type-UUID                            UUID                                 Nome Attrs
  /dev/sda1         2048     616447     614400 21686148-6449-6E6F-744E-656564454649 36AD8203-28E7-B847-B777-2DEB3A7C4B2C      
  /dev/sda2       616448  205416447  204800000 0FC63DAF-8483-4772-8E79-3D69D8477DE4 1FB84297-4B39-9941-BBB1-463ABEDB2D3C      
  /dev/sda3    205416448 4301416447 4096000000 0FC63DAF-8483-4772-8E79-3D69D8477DE4 9C59E1EB-13B6-CA49-A4CA-18DD6351FFF2      
  /dev/sda4   4301416448 7814032031 3512615584 0FC63DAF-8483-4772-8E79-3D69D8477DE4 3CBD3722-3E7E-FF46-AE37-1BFB7B70BD87      


  Disk /dev/sdb: 931,48 GiB, 1000170586112 bytes, 1953458176 sectors
  Disk model: My Passport 25E1
  Units: sectors of 1 * 512 = 512 bytes
  Sector size (logical/physical): 512 bytes / 512 bytes
  I/O size (minimum/optimal): 512 bytes / 512 bytes
  Disklabel <span class="hljs-built_in">type</span>: gpt
  Disk identifier: B64B7F8F-DE6E-4C80-9F62-917DC8D1A09E
  First usable LBA: 34
  Last usable LBA: 1953458142
  Alternative LBA: 1953458175
  Partition entries starting LBA: 2
  Allocated partition entries: 128
  Partition entries ending LBA: 33

  Dispositivo Start       Fine    Settori Type-UUID                            UUID                                 Nome      Attrs
  /dev/sdb1    2048 1953456127 1953454080 0FC63DAF-8483-4772-8E79-3D69D8477DE4 199CB70C-06A5-499B-B53F-7A6C170FEE1A Backup1TB 

$ lsblk -f                    <span class="hljs-comment"># visualizzazione di tutte le partizioni</span>
$ <span class="hljs-built_in">sudo</span> lsblk -o NAME,TYPE,PTTYPE,SIZE,FSTYPE,FSUSE%,LABEL,PARTLABEL,UUID,RO,MOUNTPOINT,MODEL
  NAME   TYPE PTTYPE   SIZE FSTYPE FSUSE% LABEL PARTLABEL UUID                                 RO MOUNTPOINT MODEL
  sda    disk gpt      3,6T                                                                     0            Samsung SSD 870 QVO 4TB
  â”œâ”€sda1 part gpt      300M vfat       0%                 5219-E515                             0 /boot/efi  
  â”œâ”€sda2 part gpt     97,7G ext4      47%                 8977405d-e9dc-4e16-9266-fd9fe3a72d13  0 /          
  â”œâ”€sda3 part gpt      1,9T ext4       3%                 9b556884-d7ae-4333-9562-25079096b3df  0 /home      
  â””â”€sda4 part gpt      1,6T ext4      15% opt             56868511-822a-44a6-9ae0-70180454948a  0 /opt       
  sdb    disk gpt    931,5G                                                                     0            WDC WD10SDZW-11UMGS0
  â””â”€sdb1 part gpt    931,5G                     Backup1TB                                       0            
</code></pre>
<h3 id="creating-partitions-with-fdisk" tabindex="-1">Creating partitions with fdisk <a class="header-anchor" href="#creating-partitions-with-fdisk" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash">$ fdisk /dev/sdb
    
Welcome to fdisk (util-linux 2.32.1).
Changes will remain <span class="hljs-keyword">in</span> memory only <span class="hljs-keyword">until</span> you decide to write them.
Be careful before using the write <span class="hljs-built_in">command</span>.
 
Does not contain a recognized partition table.
    Created a new DOS disklabel with disk identifier 0x569c5370.
    
Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n
Partition <span class="hljs-built_in">type</span>
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container <span class="hljs-keyword">for</span> logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-2097151, default 2048):
Last sector, +sectors or +size{K,M,G,T,P} (2048-2097151, default 2097151): +500
    
Created a new partition 1 of <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;Linux&#x27;</span> and of size 250.5 KiB.
**Be sure to write your changes to disk using the `w` flag**
</code></pre>
<h2 id="formatting-partitions-in-linux" tabindex="-1">Formatting partitions in Linux <a class="header-anchor" href="#formatting-partitions-in-linux" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-bash">$ <span class="hljs-built_in">sudo</span> gdisk -l /dev/sdb <span class="hljs-comment"># usare gdisk per impostare la PARTLABEL GPT</span>
$ <span class="hljs-built_in">sudo</span> mkfs.ext4 -L BackupHD -cv /dev/sdb1
$ <span class="hljs-built_in">sudo</span> e2label /dev/sdb1 BackupHD
$ <span class="hljs-built_in">sudo</span> lsblk -o NAME,TYPE,PTTYPE,SIZE,FSTYPE,FSUSE%,LABEL,PARTLABEL,UUID,RO,MOUNTPOINT,MODEL /dev/sdb
</code></pre>
<h2 id="fsck" tabindex="-1">fsck <a class="header-anchor" href="#fsck" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li>
<p><a href="https://man.archlinux.org/man/core/e2fsprogs/e2fsck.8.en">https://man.archlinux.org/man/core/e2fsprogs/e2fsck.8.en</a></p>
<pre><code>-f Force checking even if the file system seems clean.
-v Verbose mode.
-C This option causes e2fsck to write completion information to the specified file descriptor
   If the file descriptor specified is 0, e2fsck will print a completion bar as it goes about its business. This requires that e2fsck is running on a video console or terminal.
-p Automatically repair (&quot;preen&quot;) the file system. This option will cause e2fsck to automatically fix any file system problems that can be safely fixed without human intervention.
</code></pre>
</li>
</ul>
<pre><code class="language-bash"><span class="hljs-comment"># Controllo immediato di una partizione smontata</span>
$ <span class="hljs-built_in">sudo</span> e2fsck -f -C 0 -p /dev/sdb4
</code></pre>
<h2 id="impostare-label-per-ext4" tabindex="-1">Impostare label per ext4 <a class="header-anchor" href="#impostare-label-per-ext4" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-bash">$ lsblk -f                    <span class="hljs-comment"># visualizzazione di tutte le partizioni</span>
$ e2label /dev/sdc3           <span class="hljs-comment"># visualizzazione label</span>
$ e2label /dev/sdc3 backup    <span class="hljs-comment"># impostazione label</span>
</code></pre>
<h2 id="velocizzare-ext4---utilizzo-di-indicizzazione-directory" tabindex="-1">Velocizzare ext4 - Utilizzo di indicizzazione Directory <a class="header-anchor" href="#velocizzare-ext4---utilizzo-di-indicizzazione-directory" aria-hidden="true">ðŸ”—</a></h2>
<p>Questa funzione migliora l'accesso ai file nelle directory di grandi dimensioni o directory contenenti molti file utilizzando un sistema di hash binari per memorizzare le informazioni della directory. Ãˆ perfettamente sicuro da usare e fornisce un miglioramento sostanziale nella maggior parte dei casi, quindi Ã¨ una buona idea abilitarlo:</p>
<pre><code>tune2fs -O dir_index /dev/hdXY
</code></pre>
<p>Questo avrÃ  effetto solo con le directory create su quel filesystem dopo aver eseguito tune2fs. Per applicare questa funzionalitÃ  alle directory esistenti, si deve eseguire l'utilitÃ  e2fsck per ottimizzare e reindicizzare le directory sul filesystem:</p>
<pre><code>e2fsck -D -f /dev/hdXY
</code></pre>
<p>Note: Questo dovrebbe funzionare sia con filesystem ext2 che ext3. A seconda delle dimensioni del file system, l'operazione potrebbe richiedere molto tempo.</p>
<p>Supponiamo di voler velocizzare <code>/dev/sda1</code> che Ã¨ <code>ext4</code>
Se si tratta della partizione di root od home, bisogna partire con una distro live</p>
<pre><code class="language-bash"><span class="hljs-built_in">sudo</span> su
</code></pre>
<p>aggiungere <code>noatime</code> in <code>/etc/fstab</code> per <code>/dev/sda1</code></p>
<p>Indicizzare le directory:</p>
<pre><code class="language-bash">umount /dev/sda1 la partizione deve essere smontata
<span class="hljs-built_in">sudo</span> tune2fs -O dir_index /dev/sda1
<span class="hljs-built_in">sudo</span> e2fsck -D /dev/sda1
</code></pre>
<p>Deframmentare:</p>
<pre><code class="language-bash"><span class="hljs-built_in">sudo</span> e4defrag -c /dev/sda1 per controllare lo stato di frammentazione
<span class="hljs-built_in">sudo</span> e4defrag /dev/sda1
</code></pre>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Ext3_(Italiano)">https://wiki.archlinux.org/index.php/Ext3_(Italiano)</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Ext4_(Italiano)">https://wiki.archlinux.org/index.php/Ext4_(Italiano)</a></li>
</ul>
<h2 id="resize" tabindex="-1">Resize <a class="header-anchor" href="#resize" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en">https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en</a> resize2fs - ext2/ext3/ext4 file system resizer. <strong>does not manipulate the size of partitions</strong></li>
</ul>
<p>The <code>resize2fs</code> program will resize ext2, ext3, or <code>ext4</code> file systems. It can be used to enlarge or shrink an unmounted file system.
Linux 2.6 kernel supports on-line resize for filesystems mounted using ext3 and ext4.</p>
<p><strong>If size parameter is not specified, it will default to the size of the partition</strong>.</p>
<ul>
<li><code>-P</code> Print an estimate of the number of file system blocks in the file system if it is shrunk using resize2fs's <code>-M</code> option and then exit.</li>
<li><code>-M</code> Shrink the file system to minimize its size as much as possible, given the files stored in the file system.</li>
</ul>
<h3 id="enlarge" tabindex="-1">Enlarge <a class="header-anchor" href="#enlarge" aria-hidden="true">ðŸ”—</a></h3>
<p><code>resize2fs</code> non modifica la partizione, per estendere un file system, prima bisogna distruggere e ricreare la partizione con <code>fdisk</code> (attenzione a <strong>specificare lo stesso cilindro iniziale</strong>) con dimensioni maggiori, operazione che eseguita in questo modo Ã¨ non distruttiva e non fÃ  perdere i dati. Solo dopo aver esteso la partizione utilizzare <code>resize2fs</code> per estendere il file system:</p>
<ol>
<li><code>fdisk</code> distruggere e ricreare la partizione con dimensioni maggiori , <strong>specificando il medesimo cilindro iniziale</strong></li>
<li><code>resize2fs</code></li>
</ol>
<h3 id="shrink" tabindex="-1">Shrink <a class="header-anchor" href="#shrink" aria-hidden="true">ðŸ”—</a></h3>
<ol>
<li>Prima utilizzare <code>resize2fs</code> per restringere il file system</li>
<li>Dopo utilizzare <code>fdisk</code> per distruggere e ricreare la partizione con dimensioni minori</li>
</ol>
<h3 id="esempio-shrink" tabindex="-1">Esempio shrink <a class="header-anchor" href="#esempio-shrink" aria-hidden="true">ðŸ”—</a></h3>
<p><code>/dev/sda1</code> E' grande 40GB, sono occupati 16GB lo voglio ridurre a 20GB</p>
<pre><code class="language-bash"><span class="hljs-comment"># Spazio disponibile</span>

<span class="hljs-comment"># Per vedere quanto Ã¨ grande un blocco</span>
$ dumpe2fs -h /dev/sda1 <span class="hljs-comment"># E&#x27; grande 40GB, occupati 16GB lo voglio ridurre a 20GB</span>
    Filesystem UUID:          61d740ad-db0b-4326-b36b-cdf7c4fa27c8
    Filesystem OS <span class="hljs-built_in">type</span>:       Linux
    Block count:              10485504
    Block size:               4096
    Free blocks:              5333535
    Mount count:              6
    Maximum mount count:      30

<span class="hljs-comment"># modo per vedere lo spazio utilizzato</span>
$ lsblk -o NAME,TYPE,FSTYPE,SIZE,FSUSED,FSUSE%,MOUNTPOINT,LABEL,PARTLABEL /dev/sda1
    NAME TYPE FSTYPE SIZE FSUSED FSUSE% MOUNTPOINT
    sda1 part ext4    40G  15,5G    39% /
<span class="hljs-comment"># modo per vedere lo spazio utilizzato</span>
$ resize2fs -P /dev/sda1 <span class="hljs-comment"># numero dei blocchi che sarebbe possibile liberare al massimo con l&#x27;opzione -M</span>
Estimated minimum size of the filesystem: 4371230
<span class="hljs-comment"># Convertiamo i blocchi in GB sapendo che un blocco Ã¨ 4096 bytes</span>
$ python -c <span class="hljs-string">&quot;print(4371230*4096/1024/1024/1024)&quot;</span>
16.67491912841797

<span class="hljs-comment"># root deve essere smontato per fare il resize</span>
<span class="hljs-comment"># Reboot da cdrom Manjaro /dev/sda1 Ã¨ giÃ  smontata</span>
$ <span class="hljs-built_in">sudo</span> e2fsck -f -C 0 /dev/sda1
$ <span class="hljs-built_in">sudo</span> resize2fs -p /dev/sda1 20G <span class="hljs-comment"># Non uso -M perchÃ¨ non voglio ridurre la dimensione al minimo</span>
$ <span class="hljs-built_in">sudo</span> fdisk <span class="hljs-comment"># distruggere e ricreare la partizione sda1 piÃ¹ piccola, utilizzando il medesimo cilindro iniziale</span>
</code></pre>
<h3 id="esempio-enlarge" tabindex="-1">Esempio enlarge <a class="header-anchor" href="#esempio-enlarge" aria-hidden="true">ðŸ”—</a></h3>
<ul>
<li>
<p><a href="https://man.archlinux.org/man/fdisk.8">https://man.archlinux.org/man/fdisk.8</a></p>
<pre><code>  -u, --units[=unit]
  When listing partition tables, show sizes in 'sectors' or in 'cylinders'. The default is to show sizes in sectors. For backward compatibility, it is possible to use the option without the unit argument â€” then the default is used. Note that the optional unit argument cannot be separated from the -u option by a space, the correct form is for example '-u=cylinders'.
</code></pre>
</li>
<li>
<p><a href="https://man.archlinux.org/man/growpart.1">https://man.archlinux.org/man/growpart.1</a> rewrite partition table so that partition takes up all the space it can</p>
</li>
<li>
<p><a href="https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en">https://man.archlinux.org/man/core/e2fsprogs/resize2fs.8.en</a> resize2fs - ext2/ext3/ext4 file system resizer. <strong>does not manipulate the size of partitions</strong></p>
</li>
<li>
<p><code>growpart</code> : <strong>you can extend only the last partition</strong></p>
</li>
<li>
<p><code>resize2fs</code> : <strong>If size parameter is not specified, it will default to the size of the partition</strong>.</p>
</li>
</ul>
<pre><code class="language-bash">$ <span class="hljs-built_in">sudo</span> fdisk <span class="hljs-comment"># distruggere e ricreare la partizione sda1 piÃ¹ grande, utilizzando il medesimo cilindro iniziale</span>
$ <span class="hljs-built_in">sudo</span> LC_ALL=en_US.UTF-8 growpart /dev/sda 1 
$ <span class="hljs-built_in">sudo</span> resize2fs /dev/sda1
</code></pre>
<p>Esempio di fdisk con here document:</p>
<pre><code class="language-bash">fdisk -u /dev/whatever &lt;&lt;<span class="hljs-string">EOF
n
p
1

w
EOF</span>
</code></pre>
</body></html>