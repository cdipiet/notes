<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-08 13:44:53.384" />
        <title>ufw</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../../inc/js/hljs/styles/default.css" />
        <script src="../../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="ufw" tabindex="-1">ufw <a class="header-anchor" href="#ufw" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-08 13:44:53.384</p>
<nav class="table-of-contents"><ol><li><a href="#application-profiles">Application Profiles </a></li><li><a href="#configurazione-per-samba-in-modo-che-le-connessioni-siano-consentite-solamente-da-un-determinato-host">Configurazione per Samba in modo che le connessioni siano consentite solamente da un determinato host </a></li><li><a href="#apertura-porte-samba">Apertura porte Samba </a></li></ol></nav><h1 id="ufw-in-manjaro-con-systemd" tabindex="-1">UFW in Manjaro con systemd <a class="header-anchor" href="#ufw-in-manjaro-con-systemd" aria-hidden="true">ðŸ”—</a></h1>
<ul>
<li><a href="https://wiki.manjaro.org/index.php/Firewalls">https://wiki.manjaro.org/index.php/Firewalls</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Uncomplicated_Firewall">https://wiki.archlinux.org/index.php/Uncomplicated_Firewall</a></li>
<li><a href="http://www.clausconrad.com/blog/easy-firewall-setup-for-manjaro-linux">http://www.clausconrad.com/blog/easy-firewall-setup-for-manjaro-linux</a></li>
</ul>
<p>Dopo l'installazione, Manjaro non prevede un firewall attivo di default,
utilizziamo Uncomplicated Firewall, ufw, e la sui GUI: GUFW</p>
<pre><code class="language-bash"><span class="hljs-comment"># Installazione e avvio</span>
$ <span class="hljs-built_in">sudo</span> pacman -Syu
$ <span class="hljs-built_in">sudo</span> pacman -Syu --needed ufw ufw-extras gufw
$ <span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> ufw.service
$ <span class="hljs-built_in">sudo</span> ufw <span class="hljs-built_in">enable</span>
<span class="hljs-comment">#sudo ufw disable</span>
<span class="hljs-comment"># Partenza immediata di ufw:</span>
$ <span class="hljs-built_in">sudo</span> systemctl start ufw
<span class="hljs-comment"># Controllare lo stato:</span>
$ <span class="hljs-built_in">cat</span> /etc/ufw/ufw.conf
$ <span class="hljs-built_in">sudo</span> ufw status
$ <span class="hljs-built_in">sudo</span> ufw status verbose
$ <span class="hljs-built_in">sudo</span> systemctl status ufw

<span class="hljs-comment"># Abilitiamo tutto il traffico in uscita</span>
$ <span class="hljs-built_in">sudo</span> ufw default allow outgoing
<span class="hljs-comment"># Disabilitiamo tutto il traffico in ingresso</span>
$ <span class="hljs-built_in">sudo</span> ufw default deny <span class="hljs-comment"># oppure:</span>
$ <span class="hljs-built_in">sudo</span> ufw default deny incoming
<span class="hljs-comment"># iptables -S | grep ACCEPT altro modo per vedere le regole sul traffico accettato</span>

<span class="hljs-comment"># Abilitare e controllare il logging con systemd</span>
$ ufw logging on
$ ufw logging low
$ ufw logging full
$ journalctl -f -k --grep=<span class="hljs-string">&quot;UFW&quot;</span>
$ journalctl --system --since=today | grep UFW
$ journalctl -f -k --grep=<span class="hljs-string">&quot;IN=.*OUT=.*&quot;</span>
$ <span class="hljs-built_in">sudo</span> dmesg|grep -i ufw
<span class="hljs-comment"># - off    disables ufw managed logging</span>
<span class="hljs-comment"># - low    logs all blocked packets not matching the defined policy (with rate limiting), as well as packets matching logged rules</span>
<span class="hljs-comment"># - medium log level low, plus all allowed packets not matching the defined policy, all INVALID packets, and all new connections.  All logging is done with rate limiting.</span>
<span class="hljs-comment"># - high   log level medium (without rate limiting), plus all packets with rate limiting</span>
<span class="hljs-comment"># - full   log level high without rate limiting</span>


<span class="hljs-comment"># Aggiunta delle porte relative ad una applicazione definita in uno dei file di /etc/ufw/applications.d</span>
<span class="hljs-built_in">sudo</span> ufw app list
<span class="hljs-built_in">sudo</span> ufw app info CIFS
<span class="hljs-built_in">sudo</span> ufw status numbered
<span class="hljs-built_in">sudo</span> ufw allow CIFS

<span class="hljs-comment"># Configurazione delle porte</span>
<span class="hljs-comment"># Se la porta che si vuole aprire o chiudere Ã¨ definita in /etc/services, Ã¨ possibile usare il nome al posto del numero della porta. Negli esempi seguenti, si sostituirÃ  22 con ssh.</span>
<span class="hljs-built_in">sudo</span> ufw allow ssh

<span class="hljs-comment"># Per consentire i pacchetti tcp e udp in ingresso sulla porta 8443:</span>
<span class="hljs-built_in">sudo</span> ufw allow 8443
<span class="hljs-comment"># Per consentire i pacchetti tcp in ingresso sulla porta 8443:</span>
<span class="hljs-built_in">sudo</span> ufw allow <span class="hljs-keyword">in</span> 8443/tcp
<span class="hljs-built_in">sudo</span> ufw allow 8443/tcp <span class="hljs-comment"># &#x27;in&#x27; Ã¨ il default</span>
<span class="hljs-comment"># Per rimuovere la regola</span>
<span class="hljs-built_in">sudo</span> ufw delete allow 8443/tcp

<span class="hljs-comment"># Per bloccare i pacchetti tcp e udp sulla porta 53, digitare il comando:</span>
<span class="hljs-built_in">sudo</span> ufw deny 53
<span class="hljs-built_in">sudo</span> ufw status numbered
<span class="hljs-built_in">sudo</span> ufw delete 2

<span class="hljs-built_in">sudo</span> ufw status verbose
<span class="hljs-built_in">sudo</span> ufw logging full
journalctl -f -u ufw
<span class="hljs-built_in">sudo</span> ufw logging low

$ <span class="hljs-built_in">sudo</span> ufw allow ssh
<span class="hljs-comment"># or:</span>
$ <span class="hljs-built_in">sudo</span> ufw allow 22
$ <span class="hljs-built_in">sudo</span> ufw allow 80/tcp
$ <span class="hljs-built_in">sudo</span> ufw allow http/tcp
$ <span class="hljs-built_in">sudo</span> ufw allow 1725/udp
$ <span class="hljs-built_in">sudo</span> ufw allow 1725/udp
$ <span class="hljs-built_in">sudo</span> ufw allow from 123.45.67.89/24
$ <span class="hljs-built_in">sudo</span> ufw allow from 123.45.67.89 to any port 22 proto tcp
$ <span class="hljs-built_in">sudo</span> ufw allow from &lt;some_address&gt; to any app &lt;app_name&gt;
$ <span class="hljs-built_in">sudo</span> ufw allow from 192.168.192.0/24 to any app samba4

<span class="hljs-comment"># Esempio di rimozione di un regola</span>
$ <span class="hljs-built_in">sudo</span> ufw delete allow 22
<span class="hljs-comment"># CuriositÃ : partenza di ufw come timer systemd</span>
<span class="hljs-comment"># Solamente allo scopo di dare un esempio dei timer systemd,</span>
<span class="hljs-comment"># vediamo come far partire ufw con un timer systemd anzichÃ¨ con il sudo systemctl enable ufw:</span>
<span class="hljs-comment"># sudo nano /etc/systemd/system/ufwAuto.service</span>
<span class="hljs-comment">#    this is ufwAuto.service :</span>
<span class="hljs-comment">#        [Unit]</span>
<span class="hljs-comment">#        Description=Check Is FireWall on/off and Up it is down!</span>
<span class="hljs-comment">#        [Service]</span>
<span class="hljs-comment">#        Type=simple</span>
<span class="hljs-comment">#        ExecStart=/home/cdp/ufw.sh</span>
<span class="hljs-comment">#        [Install]</span>
<span class="hljs-comment">#        WantedBy=multi-user.target</span>
<span class="hljs-comment">#    and this is ufw.sh:</span>
<span class="hljs-comment">#        #!/usr/bin/env bash</span>
<span class="hljs-comment">#        temp=$(sudo ufw status | grep Status | cut -d&quot; &quot; -f2)</span>
<span class="hljs-comment">#        if [ &quot;$temp&quot; == &quot;inactive&quot; ]; then</span>
<span class="hljs-comment">#        exec sudo ufw enable</span>
<span class="hljs-comment">#        fi</span>
<span class="hljs-comment">#    and then create a time unit for that service:</span>
<span class="hljs-comment">#    sudo nano /etc/systemd/system/ufwAuto.timer</span>
<span class="hljs-comment">#    this is ufwAuto.timer :</span>
<span class="hljs-comment">#        [Unit]</span>
<span class="hljs-comment">#        Description=Run ufwAuto.service every 1 minutes</span>
<span class="hljs-comment">#        [Timer]</span>
<span class="hljs-comment">#        OnCalendar=*:0/1</span>
<span class="hljs-comment">#        Unit=ufwAuto.service</span>
<span class="hljs-comment">#        [Install]</span>
<span class="hljs-comment">#        WantedBy=multi-user.target</span>
<span class="hljs-comment">#    after that you must enable and start service unit to run the script according to pattern in timer unit:</span>
<span class="hljs-comment">#    sudo systemctl enable ufwAuto.service</span>
<span class="hljs-comment">#    sudo systemctl start ufwAuto.service</span>

<span class="hljs-comment">#    Vedere i default</span>
/etc/ufw/applications.d
$ ufw app list
</code></pre>
<h2 id="application-profiles" tabindex="-1">Application Profiles <a class="header-anchor" href="#application-profiles" aria-hidden="true">ðŸ”—</a></h2>
<p><code>/etc/ufw/applications.d</code></p>
<pre><code class="language-bash">$ grep 139 *
ufw-fileserver:ports=137,138/udp|139,445/tcp
/etc/ufw/applications.d]$ <span class="hljs-built_in">cat</span> ufw-fileserver 
[CIFS]
title=SMB/CIFS server
description=SMB/CIFS server
ports=137,138/udp|139,445/tcp

[NFS]
title=NFS server
description=NFS and portmap server. Will also need access to mountd, statd and possibly others
ports=2049,111/tcp|2049,111/udp

[svnserve]
title=Subversion server
description=Subversion server <span class="hljs-keyword">for</span> access to Subversion repositories.
ports=3690/tcp

$ <span class="hljs-built_in">sudo</span> ufw app list

</code></pre>
<h2 id="configurazione-per-samba-in-modo-che-le-connessioni-siano-consentite-solamente-da-un-determinato-host" tabindex="-1">Configurazione per Samba in modo che le connessioni siano consentite solamente da un determinato host <a class="header-anchor" href="#configurazione-per-samba-in-modo-che-le-connessioni-siano-consentite-solamente-da-un-determinato-host" aria-hidden="true">ðŸ”—</a></h2>
<pre><code class="language-bash">$ <span class="hljs-built_in">sudo</span> bash -c <span class="hljs-string">&quot;cat &gt; /etc/ufw/applications.d/cdp-samba&quot;</span> &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span> 
[samba]
title=Samba
description=Samba as domain controller
ports=53|88|135/tcp|137,138/udp|139,389,445/tcp|464|636/tcp|1024:5000/tcp|3268,3269/tcp|5353
EOF
$ <span class="hljs-built_in">sudo</span> ufw app update samba
$ <span class="hljs-built_in">sudo</span> ufw app info samba
$ <span class="hljs-built_in">sudo</span> ufw --force reset
$ <span class="hljs-built_in">sudo</span> ufw <span class="hljs-built_in">enable</span>
$ <span class="hljs-built_in">sudo</span> ufw allow from 192.168.1.4 to any app samba
$ <span class="hljs-built_in">sudo</span> ufw status verbose
</code></pre>
<pre><code class="language-bash">$ grep <span class="hljs-string">&#x27;\s13[5,7,8,9]\/&#x27;</span> /etc/services
epmap             135/tcp
epmap             135/udp
netbios-ns        137/tcp
netbios-ns        137/udp
netbios-dgm       138/tcp
netbios-dgm       138/udp
netbios-ssn       139/tcp
netbios-ssn       139/udp

$ grep -P <span class="hljs-string">&#x27;(?&lt;=\s)(53|88|389|445|464|636|3268|3269|5353)(?=\/)&#x27;</span> /etc/services
domain             53/tcp
domain             53/udp
kerberos           88/tcp
kerberos           88/udp
ldap              389/tcp
ldap              389/udp
microsoft-ds      445/tcp
microsoft-ds      445/udp
kpasswd           464/tcp
kpasswd           464/udp
ldaps             636/tcp
ldaps             636/udp
msft-gc          3268/tcp
msft-gc          3268/udp
msft-gc-ssl      3269/tcp
msft-gc-ssl      3269/udp
mdns             5353/tcp
mdns             5353/udp
</code></pre>
<h2 id="apertura-porte-samba" tabindex="-1">Apertura porte Samba <a class="header-anchor" href="#apertura-porte-samba" aria-hidden="true">ðŸ”—</a></h2>
<p>Server Message Block (<strong>SMB</strong>), aka Common Internet File System (<strong>CIFS</strong>).<br>
NetBIOSProvides: Name Service (Port 137/UDP) + Datagram Service (Port 138/UDP) + Session Service (Port 139/TCP)</p>
<ul>
<li><strong>Port 139</strong>: SMB originally ran on top of NetBIOS using port 139. NetBIOS is an older transport layer that allows Windows computers to talk to each other on the same network.</li>
<li><strong>Port 445</strong>: Later versions of SMB (after Windows 2000) began to use port 445 on top of a TCP stack. Using TCP allows SMB to work over the internet.</li>
</ul>
<p>Per CIFS e NetBIOS vanno aperte le seguenti porte:</p>
<table class="table"><thead>
<tr>
<th style="text-align:left">Porta</th>
<th style="text-align:left">Tipo</th>
<th style="text-align:left">Protocollo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">137</td>
<td style="text-align:left">UDP</td>
<td style="text-align:left">NetBIOS</td>
</tr>
<tr>
<td style="text-align:left">138</td>
<td style="text-align:left">UDP</td>
<td style="text-align:left">NetBIOS</td>
</tr>
<tr>
<td style="text-align:left">139</td>
<td style="text-align:left">TCP</td>
<td style="text-align:left">NetBIOS</td>
</tr>
<tr>
<td style="text-align:left">445</td>
<td style="text-align:left">TCP</td>
<td style="text-align:left">CIFS</td>
</tr>
</tbody>
</table>
<pre><code class="language-bash">
$ <span class="hljs-built_in">sudo</span> ufw allow from 192.168.1.4 to any app CIFS

$ <span class="hljs-built_in">sudo</span> ufw app info CIFS
Profile: CIFS
Title: SMB/CIFS server
Description: SMB/CIFS server
Ports:
  137,138/udp
  139,445/tcp

$ <span class="hljs-built_in">sudo</span> ufw allow from 192.168.1.4 to any app CIFS
$ <span class="hljs-built_in">sudo</span> ufw status numbered
Status: active
     To                         Action      From
     --                         ------      ----
[ 1] CIFS                       ALLOW IN    192.168.1.4               

$ <span class="hljs-built_in">sudo</span> ufw status verbose
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), deny (routed)
New profiles: skip
To                         Action      From
--                         ------      ----
137,138/udp (CIFS)         ALLOW IN    192.168.1.4               
139,445/tcp (CIFS)         ALLOW IN    192.168.1.4               
</code></pre>
<p>Altro modo, definire una nuova app:</p>
<pre><code class="language-bash"><span class="hljs-comment"># Apertura porte samba per il solo pc del lavoro</span>
<span class="hljs-comment"># Si puo definire una nuovo app con piu porte o semplicemente utilizzare il CIFS predefinito</span>
$ <span class="hljs-built_in">sudo</span> bash -c <span class="hljs-string">&quot;cat &gt; /etc/ufw/applications.d/cdp-samba&quot;</span> &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span> 
[samba]
title=Samba
description=Samba as domain controller
ports=53|88|135/tcp|137,138/udp|139,389,445/tcp|464|636/tcp|1024:5000/tcp|3268,3269/tcp|5353
EOF
$ <span class="hljs-built_in">sudo</span> ufw app update samba
$ <span class="hljs-built_in">sudo</span> ufw app info samba
$ <span class="hljs-built_in">sudo</span> ufw allow from 192.168.1.4 to any app samba
$ <span class="hljs-built_in">sudo</span> ufw status verbose

$ <span class="hljs-built_in">sudo</span> ufw status numbered
Status: active
     To                         Action      From
     --                         ------      ----
[ 1] samba                      ALLOW IN    192.168.1.4 

$ <span class="hljs-built_in">sudo</span> ufw delete 1
</code></pre>
</body></html>