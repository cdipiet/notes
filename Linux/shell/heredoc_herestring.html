<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-08 13:38:19.822" />
        <title>heredoc_herestring</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../inc/js/hljs/styles/default.css" />
        <script src="../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="heredoc_herestring" tabindex="-1">heredoc_herestring <a class="header-anchor" href="#heredoc_herestring" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-08 13:38:19.822</p>
<nav class="table-of-contents"><ol><li><a href="#heredoc">heredoc </a><ol><li><a href="#con-sostituzione-dei-parametri%2C-%24user-viene-sostituito">Con sostituzione dei parametri, $USER viene sostituito </a></li><li><a href="#senza-sostituzione-dei-parametri%2C-%24user-non-viene-sostituito">Senza sostituzione dei parametri, $USER NON viene sostituito </a></li><li><a href="#heredoc-che-scrivono-in-directory-che-richiedono-sudo">heredoc che scrivono in directory che richiedono sudo </a></li></ol></li><li><a href="#esempi">Esempi </a><ol><li><a href="#example-19-2.-dummyfile%3A-creates-a-2-line-dummy-file">Example 19-2. dummyfile: Creates a 2-line dummy file </a></li><li><a href="#example-19-3.-multi-line-message-using-cat">Example 19-3. Multi-line message using cat </a></li><li><a href="#example-19-4.-multi-line-message%2C-with-tabs-suppressed">Example 19-4. Multi-line message, with tabs suppressed </a></li><li><a href="#example-19-5.-here-document-with-replaceable-parameters">Example 19-5. Here document with replaceable parameters </a></li><li><a href="#example-19-6.-upload-a-file-pair-to-sunsite-incoming-directory">Example 19-6. Upload a file pair to Sunsite incoming directory </a></li><li><a href="#example-19-7.-parameter-substitution-turned-off">Example 19-7. Parameter substitution turned off </a></li><li><a href="#example-19-8.-a-script-that-generates-another-script">Example 19-8. A script that generates another script </a></li><li><a href="#example-19-9.-here-documents-and-functions">Example 19-9. Here documents and functions </a></li><li><a href="#example-19-10.-%22anonymous%22-here-document">Example 19-10. &quot;Anonymous&quot; Here Document </a></li><li><a href="#example-19-11.-commenting-out-a-block-of-code">Example 19-11. Commenting out a block of code </a></li><li><a href="#example-19-12.-a-self-documenting-script">Example 19-12. A self-documenting script </a></li><li><a href="#heredoc-and-temporary-files">heredoc and temporary files </a></li></ol></li><li><a href="#here-string">Here String </a><ol><li><a href="#example-19-13.-prepending-a-line-to-a-file">Example 19-13. Prepending a line to a file </a></li><li><a href="#example-19-14.-parsing-a-mailbox">Example 19-14. Parsing a mailbox </a></li></ol></li><li><a href="#heredoc-concatenati-con-rimozione-dell'ultimo-newline-del-primo-heredoc">heredoc concatenati con rimozione dell&#39;ultimo newline del primo heredoc </a></li></ol></nav><h1 id="heredoc-herestring" tabindex="-1">heredoc herestring <a class="header-anchor" href="#heredoc-herestring" aria-hidden="true">ðŸ”—</a></h1>
<h2 id="heredoc" tabindex="-1">heredoc <a class="header-anchor" href="#heredoc" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="http://www.pluto.it/files/ildp/guide/abs/here-docs.html">http://www.pluto.it/files/ildp/guide/abs/here-docs.html</a></li>
<li><a href="https://tldp.org/LDP/abs/html/here-docs.html">https://tldp.org/LDP/abs/html/here-docs.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Here_document">https://en.wikipedia.org/wiki/Here_document</a></li>
</ul>
<p>L'heredoc permette di inserire un intero documento in uno script oppure di creare un file<br>
mediante un unica istruzione di shell:</p>
<h3 id="con-sostituzione-dei-parametri%2C-%24user-viene-sostituito" tabindex="-1">Con sostituzione dei parametri, $USER viene sostituito <a class="header-anchor" href="#con-sostituzione-dei-parametri%2C-%24user-viene-sostituito" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash">$ <span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">END
hello world $USER
END</span>
</code></pre>
<h3 id="senza-sostituzione-dei-parametri%2C-%24user-non-viene-sostituito" tabindex="-1">Senza sostituzione dei parametri, $USER NON viene sostituito <a class="header-anchor" href="#senza-sostituzione-dei-parametri%2C-%24user-non-viene-sostituito" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash">$ <span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">&#x27;END&#x27;</span>
hello world <span class="hljs-variable">$USER</span>
END
</code></pre>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># Heredoc allows the user to define an arbitrary delimiter:</span>
$ <span class="hljs-built_in">cat</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$c_data_dir_mountpoint</span>/etc/dhcpcd.conf&quot;</span> &lt;&lt; <span class="hljs-string">EOS
interface eth0
static ip_address=$v_rpi_static_ip_on_modem_net/24
static routers=$modem_ip
static domain_name_servers=$v_pia_dns_server_1 $v_pia_dns_server_2
EOS</span>

</code></pre>
<p>Il nome del delimitatore, in questo esempio <code>EOS</code> Ã¨ arbitrario.
Ci sono tuttavia alcune note importanti:</p>
<ol>
<li class="m">
<p>la sintassi di base prevede l'interpolazione del contenuto, ovvero il contenuto viene interpretato e le variabili e comandi di shell sostituiti con i risultati. Utilizzare il formato con gli apici che racchiudono il delimitatore per impedire l'interpolazione e far considerare il contenuto come una stringa grezza, raw string:</p>
<p>&lt;&lt; <span class="mrb">'</span>EOS<span class="mrb">'</span></p>
</li>
<li>
<p>il delimitatore di chiusura <strong>non</strong> deve essere indentato, utilizzare il seguente formato per consentire la sua indentazione:</p>
<p class="m">&lt;&lt;<span class="mrb">-</span> EOS</p>
<p>tuttavia l'indentazione dovrÃ  essere effettuata con dei <strong>tab</strong>, non con degli spazi</p>
</li>
</ol>
<p>In order to assign a heredoc string to a variable, some trickery is required:</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-built_in">read</span> -r -d <span class="hljs-string">&#x27;&#x27;</span> body &lt;&lt; <span class="hljs-string">STR
{
  &quot;title&quot;: &quot;$1&quot;,
  &quot;body&quot;: &quot;$2&quot;,
}
STR</span>
</code></pre>
<p>The above will set the variable <code>$body</code> to the heredoc content,
by piping it to read, which will read it and set it without delimiter (<code>-d ''</code>).<br>
Donâ€™t forget that in order to use the resulting variable correctly, it must be quoted (<code>&quot;$body&quot;</code>)!</p>
<h3 id="heredoc-che-scrivono-in-directory-che-richiedono-sudo" tabindex="-1">heredoc che scrivono in directory che richiedono sudo <a class="header-anchor" href="#heredoc-che-scrivono-in-directory-che-richiedono-sudo" aria-hidden="true">ðŸ”—</a></h3>
<ul>
<li><a href="https://stackoverflow.com/questions/4412029/generate-script-in-bash-and-save-it-to-location-requiring-sudo">https://stackoverflow.com/questions/4412029/generate-script-in-bash-and-save-it-to-location-requiring-sudo</a></li>
</ul>
<p>Se <code>cat</code> deve scrivere in una directory che richiede <code>sudo</code>, non si puÃ² <br>
semplicemente anteporre sudo a cat:</p>
<p><strong>NO</strong></p>
<pre><code class="language-bash"><span class="hljs-comment"># NON funziona</span>
$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> &gt; /etc/fstab &lt;&lt; <span class="hljs-string">EOF
/mnt/bl/dislocker-file /mnt/bitlocker auto nofail 0 0
EOF</span>
</code></pre>
<p>Non funziona perchÃ¨ <code>&gt; /etc/fstab</code> cerca di aprire il file in scrittura con il processo shell corrente che non Ã¨ sotto <code>sudo</code>.
Il file deve essere aperto in una sotto shell attivata con sudo, si puÃ² fare con <code>sudo bash -c</code>:</p>
<pre><code class="language-bash">$ <span class="hljs-built_in">sudo</span> bash -c <span class="hljs-string">&quot;cat &gt; /etc/nginx/sites-available/sec504wiki.conf&quot;</span> &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span>
server {
    listen       127.0.0.1:9001;
    server_name  wiki;
    location / {
        root   /mnt/CDPBackup/wiki;
        index  index.html index.htm;
        add_header Last-Modified <span class="hljs-variable">$date_gmt</span>;
        add_header Cache-Control <span class="hljs-string">&#x27;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;
        if_modified_since off;
        expires off;
        etag off;
    }
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
EOF
</code></pre>
<h2 id="esempi" tabindex="-1">Esempi <a class="header-anchor" href="#esempi" aria-hidden="true">ðŸ”—</a></h2>
<h3 id="example-19-2.-dummyfile%3A-creates-a-2-line-dummy-file" tabindex="-1">Example 19-2. dummyfile: Creates a 2-line dummy file <a class="header-anchor" href="#example-19-2.-dummyfile%3A-creates-a-2-line-dummy-file" aria-hidden="true">ðŸ”—</a></h3>
<p>Even such unlikely candidates as the vi text editor lend themselves to here documents.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># Noninteractive use of &#x27;vi&#x27; to edit a file.</span>
<span class="hljs-comment"># Emulates &#x27;sed&#x27;.</span>

E_BADARGS=85

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage: `basename <span class="hljs-variable">$0</span>` filename&quot;</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>

TARGETFILE=<span class="hljs-variable">$1</span>

<span class="hljs-comment"># Insert 2 lines in file, then save.</span>
<span class="hljs-comment">#--------Begin here document-----------#</span>
vi <span class="hljs-variable">$TARGETFILE</span> &lt;&lt;<span class="hljs-string">x23LimitStringx23
i
This is line 1 of the example file.
This is line 2 of the example file.
^[
ZZ
x23LimitStringx23</span>
<span class="hljs-comment">#----------End here document-----------#</span>

<span class="hljs-comment">#  Note that ^[ above is a literal escape</span>
<span class="hljs-comment">#+ typed by Control-V &lt;Esc&gt;.</span>

<span class="hljs-comment">#  Bram Moolenaar points out that this may not work with &#x27;vim&#x27;</span>
<span class="hljs-comment">#+ because of possible problems with terminal interaction.</span>

<span class="hljs-built_in">exit</span>
</code></pre>
<p>Notare come vengono inviati i comandi a vi mediante lo stdin alimentato dall'heredoc.</p>
<h3 id="example-19-3.-multi-line-message-using-cat" tabindex="-1">Example 19-3. Multi-line message using cat <a class="header-anchor" href="#example-19-3.-multi-line-message-using-cat" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment">#  &#x27;echo&#x27; is fine for printing single line messages,</span>
<span class="hljs-comment">#+  but somewhat problematic for for message blocks.</span>
<span class="hljs-comment">#   A &#x27;cat&#x27; here document overcomes this limitation.</span>

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">End-of-message
-------------------------------------
This is line 1 of the message.
This is line 2 of the message.
This is line 3 of the message.
This is line 4 of the message.
This is the last line of the message.
-------------------------------------
End</span>-of-message

<span class="hljs-comment">#  Replacing line 7, above, with</span>
<span class="hljs-comment">#+   cat &gt; $Newfile &lt;&lt;End-of-message</span>
<span class="hljs-comment">#+       ^^^^^^^^^^</span>
<span class="hljs-comment">#+ writes the output to the file $Newfile, rather than to stdout.</span>

<span class="hljs-built_in">exit</span> 0


<span class="hljs-comment">#--------------------------------------------</span>
<span class="hljs-comment"># Code below disabled, due to &quot;exit 0&quot; above.</span>

<span class="hljs-comment"># S.C. points out that the following also works.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-------------------------------------
This is line 1 of the message.
This is line 2 of the message.
This is line 3 of the message.
This is line 4 of the message.
This is the last line of the message.
-------------------------------------&quot;</span>
<span class="hljs-comment"># However, text may not include double quotes unless they are escaped.</span>
</code></pre>
<h3 id="example-19-4.-multi-line-message%2C-with-tabs-suppressed" tabindex="-1">Example 19-4. Multi-line message, with tabs suppressed <a class="header-anchor" href="#example-19-4.-multi-line-message%2C-with-tabs-suppressed" aria-hidden="true">ðŸ”—</a></h3>
<p>The <code>-</code> option to mark a here document limit string (<code>&lt;&lt;-LimitString</code>) <strong>suppresses leading tabs (but not spaces) in the output</strong>. This may be useful in making a script more readable.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># Same as previous example, but...</span>

<span class="hljs-comment">#  The - option to a here document &lt;&lt;-</span>
<span class="hljs-comment">#+ suppresses leading tabs in the body of the document,</span>
<span class="hljs-comment">#+ but *not* spaces.</span>

<span class="hljs-built_in">cat</span> &lt;&lt;-<span class="hljs-string">ENDOFMESSAGE
	This is line 1 of the message.
	This is line 2 of the message.
	This is line 3 of the message.
	This is line 4 of the message.
	This is the last line of the message.
ENDOFMESSAGE</span>
<span class="hljs-comment"># The output of the script will be flush left.</span>
<span class="hljs-comment"># Leading tab in each line will not show.</span>

<span class="hljs-comment"># Above 5 lines of &quot;message&quot; prefaced by a tab, not spaces.</span>
<span class="hljs-comment"># Spaces not affected by   &lt;&lt;-  .</span>

<span class="hljs-comment"># Note that this option has no effect on *embedded* tabs.</span>

<span class="hljs-built_in">exit</span> 0
</code></pre>
<h3 id="example-19-5.-here-document-with-replaceable-parameters" tabindex="-1">Example 19-5. Here document with replaceable parameters <a class="header-anchor" href="#example-19-5.-here-document-with-replaceable-parameters" aria-hidden="true">ðŸ”—</a></h3>
<p>A here document supports parameter and command substitution. It is therefore possible to pass different parameters to the body of the here document, changing its output accordingly.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># Another &#x27;cat&#x27; here document, using parameter substitution.</span>

<span class="hljs-comment"># Try it with no command-line parameters,   ./scriptname</span>
<span class="hljs-comment"># Try it with one command-line parameter,   ./scriptname Mortimer</span>
<span class="hljs-comment"># Try it with one two-word quoted command-line parameter,</span>
<span class="hljs-comment">#                           ./scriptname &quot;Mortimer Jones&quot;</span>

CMDLINEPARAM=1     <span class="hljs-comment">#  Expect at least command-line parameter.</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ge <span class="hljs-variable">$CMDLINEPARAM</span> ]
<span class="hljs-keyword">then</span>
  NAME=<span class="hljs-variable">$1</span>          <span class="hljs-comment">#  If more than one command-line param,</span>
                   <span class="hljs-comment">#+ then just take the first.</span>
<span class="hljs-keyword">else</span>
  NAME=<span class="hljs-string">&quot;John Doe&quot;</span>  <span class="hljs-comment">#  Default, if no command-line parameter.</span>
<span class="hljs-keyword">fi</span>  

RESPONDENT=<span class="hljs-string">&quot;the author of this fine script&quot;</span>  
  

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">Endofmessage

Hello, there, $NAME.
Greetings to you, $NAME, from $RESPONDENT.

# This comment shows up in the output (why?).

Endofmessage</span>

<span class="hljs-comment"># Note that the blank lines show up in the output.</span>
<span class="hljs-comment"># So does the comment.</span>

<span class="hljs-built_in">exit</span>
</code></pre>
<h3 id="example-19-6.-upload-a-file-pair-to-sunsite-incoming-directory" tabindex="-1">Example 19-6. Upload a file pair to Sunsite incoming directory <a class="header-anchor" href="#example-19-6.-upload-a-file-pair-to-sunsite-incoming-directory" aria-hidden="true">ðŸ”—</a></h3>
<p>This is a useful script containing a here document with parameter substitution.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># upload.sh</span>

<span class="hljs-comment">#  Upload file pair (Filename.lsm, Filename.tar.gz)</span>
<span class="hljs-comment">#+ to incoming directory at Sunsite/UNC (ibiblio.org).</span>
<span class="hljs-comment">#  Filename.tar.gz is the tarball itself.</span>
<span class="hljs-comment">#  Filename.lsm is the descriptor file.</span>
<span class="hljs-comment">#  Sunsite requires &quot;lsm&quot; file, otherwise will bounce contributions.</span>


E_ARGERROR=85

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage: `basename <span class="hljs-variable">$0</span>` Filename-to-upload&quot;</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_ARGERROR</span>
<span class="hljs-keyword">fi</span>  


Filename=`<span class="hljs-built_in">basename</span> <span class="hljs-variable">$1</span>`           <span class="hljs-comment"># Strips pathname out of file name.</span>

Server=<span class="hljs-string">&quot;ibiblio.org&quot;</span>
Directory=<span class="hljs-string">&quot;/incoming/Linux&quot;</span>
<span class="hljs-comment">#  These need not be hard-coded into script,</span>
<span class="hljs-comment">#+ but may instead be changed to command-line argument.</span>

Password=<span class="hljs-string">&quot;your.e-mail.address&quot;</span>   <span class="hljs-comment"># Change above to suit.</span>

ftp -n <span class="hljs-variable">$Server</span> &lt;&lt;<span class="hljs-string">End-Of-Session
# -n option disables auto-logon

user anonymous &quot;$Password&quot;       #  If this doesn&#x27;t work, then try:
                                 #  quote user anonymous &quot;$Password&quot;
binary
bell                             # Ring &#x27;bell&#x27; after each file transfer.
cd $Directory
put &quot;$Filename.lsm&quot;
put &quot;$Filename.tar.gz&quot;
bye
End</span>-Of-Session

<span class="hljs-built_in">exit</span> 0
</code></pre>
<h3 id="example-19-7.-parameter-substitution-turned-off" tabindex="-1">Example 19-7. Parameter substitution turned off <a class="header-anchor" href="#example-19-7.-parameter-substitution-turned-off" aria-hidden="true">ðŸ”—</a></h3>
<p>Quoting or escaping the &quot;limit string&quot; at the head of a here document disables parameter substitution within its body. The reason for this is that quoting/escaping the limit string effectively escapes the <code>$</code>, `, and \ special characters, and causes them to be interpreted literally. (Thank you, Allen Halsey, for pointing this out.)</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment">#  A &#x27;cat&#x27; here-document, but with parameter substitution disabled.</span>

NAME=<span class="hljs-string">&quot;John Doe&quot;</span>
RESPONDENT=<span class="hljs-string">&quot;the author of this fine script&quot;</span>  

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">&#x27;Endofmessage&#x27;</span>

Hello, there, <span class="hljs-variable">$NAME</span>.
Greetings to you, <span class="hljs-variable">$NAME</span>, from <span class="hljs-variable">$RESPONDENT</span>.

Endofmessage

<span class="hljs-comment">#   No parameter substitution when the &quot;limit string&quot; is quoted or escaped.</span>
<span class="hljs-comment">#   Either of the following at the head of the here document would have</span>
<span class="hljs-comment">#+  the same effect.</span>
<span class="hljs-comment">#   cat &lt;&lt;&quot;Endofmessage&quot;</span>
<span class="hljs-comment">#   cat &lt;&lt;\Endofmessage</span>



<span class="hljs-comment">#   And, likewise:</span>

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">&quot;SpecialCharTest&quot;</span>

Directory listing would follow
<span class="hljs-keyword">if</span> <span class="hljs-built_in">limit</span> string were not quoted.
`<span class="hljs-built_in">ls</span> -l`

Arithmetic expansion would take place
<span class="hljs-keyword">if</span> <span class="hljs-built_in">limit</span> string were not quoted.
$((<span class="hljs-number">5</span> + <span class="hljs-number">3</span>))

A a single backslash would <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">limit</span> string were not quoted.
\\

SpecialCharTest


<span class="hljs-built_in">exit</span>
</code></pre>
<h3 id="example-19-8.-a-script-that-generates-another-script" tabindex="-1">Example 19-8. A script that generates another script <a class="header-anchor" href="#example-19-8.-a-script-that-generates-another-script" aria-hidden="true">ðŸ”—</a></h3>
<p>Disabling parameter substitution permits outputting literal text. <br>
Generating scripts or even program code is one use for this.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># generate-script.sh</span>
<span class="hljs-comment"># Based on an idea by Albert Reiner.</span>

OUTFILE=generated.sh         <span class="hljs-comment"># Name of the file to generate.</span>


<span class="hljs-comment"># -----------------------------------------------------------</span>
<span class="hljs-comment"># &#x27;Here document containing the body of the generated script.</span>
(
<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This is a generated shell script.&quot;</span>
<span class="hljs-comment">#  Note that since we are inside a subshell,</span>
<span class="hljs-comment">#+ we can&#x27;t access variables in the &quot;outside&quot; script.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Generated file will be named: <span class="hljs-variable">$OUTFILE</span>&quot;</span>
<span class="hljs-comment">#  Above line will not work as normally expected</span>
<span class="hljs-comment">#+ because parameter expansion has been disabled.</span>
<span class="hljs-comment">#  Instead, the result is literal output.</span>

a=7
b=3

<span class="hljs-built_in">let</span> <span class="hljs-string">&quot;c = <span class="hljs-variable">$a</span> * <span class="hljs-variable">$b</span>&quot;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;c = <span class="hljs-variable">$c</span>&quot;</span>

<span class="hljs-built_in">exit</span> 0
EOF
) &gt; <span class="hljs-variable">$OUTFILE</span>
<span class="hljs-comment"># -----------------------------------------------------------</span>

<span class="hljs-comment">#  Quoting the &#x27;limit string&#x27; prevents variable expansion</span>
<span class="hljs-comment">#+ within the body of the above &#x27;here document.&#x27;</span>
<span class="hljs-comment">#  This permits outputting literal strings in the output file.</span>

<span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$OUTFILE</span>&quot;</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">chmod</span> 755 <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-comment"># Make the generated file executable.</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Problem in creating file: \&quot;<span class="hljs-variable">$OUTFILE</span>\&quot;&quot;</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#  This method also works for generating</span>
<span class="hljs-comment">#+ C programs, Perl programs, Python programs, Makefiles,</span>
<span class="hljs-comment">#+ and the like.</span>

<span class="hljs-built_in">exit</span> 0
</code></pre>
<p>It is possible to set a variable from the output of a here document.<br>
This is actually a devious form of command substitution.</p>
<pre><code class="language-bash">variable=$(<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">SETVAR
This variable
runs over multiple lines.
SETVAR</span>
)

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$variable</span>&quot;</span>
</code></pre>
<p>A here document can supply input to a function in the same script.</p>
<h3 id="example-19-9.-here-documents-and-functions" tabindex="-1">Example 19-9. Here documents and functions <a class="header-anchor" href="#example-19-9.-here-documents-and-functions" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># here-function.sh</span>

<span class="hljs-function"><span class="hljs-title">GetPersonalData</span></span> ()
{
  <span class="hljs-built_in">read</span> firstname
  <span class="hljs-built_in">read</span> lastname
  <span class="hljs-built_in">read</span> address
  <span class="hljs-built_in">read</span> city
  <span class="hljs-built_in">read</span> state
  <span class="hljs-built_in">read</span> zipcode
} <span class="hljs-comment"># This certainly appears to be an interactive function, but . . .</span>


<span class="hljs-comment"># Supply input to the above function.</span>
GetPersonalData &lt;&lt;<span class="hljs-string">RECORD001
Bozo
Bozeman
2726 Nondescript Dr.
Bozeman
MT
21226
RECORD001</span>


<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$firstname</span> <span class="hljs-variable">$lastname</span>&quot;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$address</span>&quot;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$city</span>, <span class="hljs-variable">$state</span> <span class="hljs-variable">$zipcode</span>&quot;</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0

</code></pre>
<h3 id="example-19-10.-%22anonymous%22-here-document" tabindex="-1">Example 19-10. &quot;Anonymous&quot; Here Document <a class="header-anchor" href="#example-19-10.-%22anonymous%22-here-document" aria-hidden="true">ðŸ”—</a></h3>
<p>E' possibile utilizzare il <code>true</code> ovvero il suo alias <code>:</code> come un comando nullo che accetta un output da un here document.<br>
creando un cosiddetto &quot;anonymous&quot; here document.<br>
Bisogna avere l'accortezza perÃ² di effettuare lo <strong>strong-quoting</strong> <code>'</code> del delimitatore.\</p>
<p>Questo primo esempio non avendo lo strong-quoting del delimitatore non vÃ  bene perchÃ¨ le variabili vengono valutate,
ed avendo la forma con il punto interrogativo generano un errore se non inizializzate:</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

: &lt;&lt;<span class="hljs-string">TESTVARIABLES
${HOSTNAME?}${USER?}${MAIL?}  # Print error message if one of the variables not set.
TESTVARIABLES</span>

<span class="hljs-built_in">exit</span> $?
</code></pre>
<p>Questo esempio non Ã¨ ancora un modo di commentare delle linee di codice perchÃ¨
non essendo <code>TESTVARIABLES</code> racchiuso tra <code>'</code> apici, il suo contenuto viene valutato e quindi puÃ² generare un errore,
la sintassi <code>${MAIL?}</code> genera un errore quando MAIL non Ã¨ definita.</p>
<h3 id="example-19-11.-commenting-out-a-block-of-code" tabindex="-1">Example 19-11. Commenting out a block of code <a class="header-anchor" href="#example-19-11.-commenting-out-a-block-of-code" aria-hidden="true">ðŸ”—</a></h3>
<p>Tip: A variation of the above technique permits <span class="mrb">&quot;commenting out&quot; blocks of code</span>.</p>
<p>aggiungendo uno strong-quote si ottiene l'effetto di commentare effettivamente delle linee multiple,<br>
perchÃ¨ cosÃ¬ facendo le variabili non vengono processate e non possono generare errori,<br>
il <code>:</code> Ã¨ una abbreviazione per il comando <code>true</code>.</p>
<p>Questo primo esempio non avendo ancora lo strong-quoting del delimitatore non vÃ  bene perchÃ¨ le variabili vengono valutate,
ed avendo eventualmente la forma con il punto interrogativo generano un errore se non inizializzate:</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># commentblock.sh</span>

: &lt;&lt;<span class="hljs-string">COMMENTBLOCK
echo &quot;This line will not echo.&quot;
This is a comment line missing the &quot;#&quot; prefix.
This is another comment line missing the &quot;#&quot; prefix.

&amp;*@!!++=
The above line will cause no error message,
because the Bash interpreter will ignore it.
COMMENTBLOCK</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Exit value of above \&quot;COMMENTBLOCK\&quot; is $?.&quot;</span>   <span class="hljs-comment"># 0</span>
<span class="hljs-comment"># No error shown.</span>
<span class="hljs-built_in">echo</span>
</code></pre>
<p>Questo secondo esempio non avendo ancora lo strong-quoting del delimitatore non vÃ  bene perchÃ¨ le variabili vengono valutate,
ed avendo eventualmente la forma con il punto interrogativo generano un errore se non inizializzate:</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment">#  The above technique also comes in useful for commenting out</span>
<span class="hljs-comment">#+ a block of working code for debugging purposes.</span>
<span class="hljs-comment">#  This saves having to put a &quot;#&quot; at the beginning of each line,</span>
<span class="hljs-comment">#+ then having to go back and delete each &quot;#&quot; later.</span>
<span class="hljs-comment">#  Note that the use of of colon, above, is optional.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Just before commented-out code block.&quot;</span>
<span class="hljs-comment">#  The lines of code between the double-dashed lines will not execute.</span>
<span class="hljs-comment">#  ===================================================================</span>
: &lt;&lt;<span class="hljs-string">DEBUGXXX
for file in *
do
 cat &quot;$file&quot;
done
DEBUGXXX</span>
<span class="hljs-comment">#  ===================================================================</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Just after commented-out code block.&quot;</span>

<span class="hljs-built_in">exit</span> 0
</code></pre>
<p>Questo esempio finalmente realizza un commento multiriga corretto,<br>
effettuando lo strong-quote del <code>'COMMENTBLOCK'</code>:</p>
<pre><code>  : &lt;&lt;'COMMENTBLOCK'
</code></pre>
<p>Si evita l'errore:</p>
<pre><code>$ sh commented-bad.sh
commented-bad.sh: line 3: foo_bar_bazz: parameter null or not set
</code></pre>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment">######################################################################</span>
<span class="hljs-comment">#  Note, however, that if a bracketed variable is contained within</span>
<span class="hljs-comment">#+ the commented-out code block,</span>
<span class="hljs-comment">#+ then this could cause problems.</span>
<span class="hljs-comment">#  for example:</span>

  : &lt;&lt;<span class="hljs-string">&#x27;COMMENTBLOCK&#x27;</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This line will not echo.&quot;</span>
  &amp;*@!!++=
  <span class="hljs-variable">${foo_bar_bazz?}</span>
  $(<span class="hljs-built_in">rm</span> -rf /tmp/foobar/)
  $(<span class="hljs-built_in">touch</span> my_build_directory/cups/Makefile)
COMMENTBLOCK
</code></pre>
<h3 id="example-19-12.-a-self-documenting-script" tabindex="-1">Example 19-12. A self-documenting script <a class="header-anchor" href="#example-19-12.-a-self-documenting-script" aria-hidden="true">ðŸ”—</a></h3>
<p>Yet another twist of this nifty trick makes &quot;self-documenting&quot; scripts possible.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># self-document.sh: self-documenting script</span>
<span class="hljs-comment"># Modification of &quot;colm.sh&quot;.</span>

DOC_REQUEST=70

<span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&quot;-h&quot;</span>  -o <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&quot;--help&quot;</span> ]     <span class="hljs-comment"># Request help.</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage: <span class="hljs-variable">$0</span> [directory-name]&quot;</span>; <span class="hljs-built_in">echo</span>
  sed --silent -e <span class="hljs-string">&#x27;/DOCUMENTATIONXX$/,/^DOCUMENTATIONXX$/p&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span> |
  sed -e <span class="hljs-string">&#x27;/DOCUMENTATIONXX$/d&#x27;</span>; <span class="hljs-built_in">exit</span> <span class="hljs-variable">$DOC_REQUEST</span>; <span class="hljs-keyword">fi</span>


: &lt;&lt;<span class="hljs-string">DOCUMENTATIONXX
List the statistics of a specified directory in tabular format.
---------------------------------------------------------------
The command-line parameter gives the directory to be listed.
If no directory specified or directory specified cannot be read,
then list the current working directory.

DOCUMENTATIONXX</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> -o ! -r <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]
<span class="hljs-keyword">then</span>
  directory=.
<span class="hljs-keyword">else</span>
  directory=<span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Listing of &quot;</span><span class="hljs-variable">$directory</span><span class="hljs-string">&quot;:&quot;</span>; <span class="hljs-built_in">echo</span>
(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;PERMISSIONS LINKS OWNER GROUP SIZE MONTH DAY HH:MM PROG-NAME\n&quot;</span> \
; <span class="hljs-built_in">ls</span> -l <span class="hljs-string">&quot;<span class="hljs-variable">$directory</span>&quot;</span> | sed 1d) | column -t

<span class="hljs-built_in">exit</span> 0
</code></pre>
<p>Using a cat script is an alternate way of accomplishing this.</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

DOC_REQUEST=70

<span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&quot;-h&quot;</span>  -o <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&quot;--help&quot;</span> ]     <span class="hljs-comment"># Request help.</span>
<span class="hljs-keyword">then</span>                                       <span class="hljs-comment"># Use a &quot;cat script&quot; . . .</span>
  <span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">&#x27;DOCUMENTATIONXX&#x27;</span>
List the statistics of a specified directory <span class="hljs-keyword">in</span> tabular format.
---------------------------------------------------------------
The command-line parameter gives the directory to be listed.
If no directory specified or directory specified cannot be <span class="hljs-built_in">read</span>,
<span class="hljs-keyword">then</span> list the current working directory.

DOCUMENTATIONXX
<span class="hljs-built_in">exit</span> <span class="hljs-variable">$DOC_REQUEST</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 id="heredoc-and-temporary-files" tabindex="-1">heredoc and temporary files <a class="header-anchor" href="#heredoc-and-temporary-files" aria-hidden="true">ðŸ”—</a></h3>
<p>Here documents create temporary files, but these files are deleted after opening and are not accessible to any other process.</p>
<pre><code class="language-bash">bash$ bash -c <span class="hljs-string">&#x27;lsof -a -p $$ -d0&#x27;</span> &lt;&lt; <span class="hljs-string">EOF
&gt; EOF</span>
lsof    1213 bozo    0r   REG    3,5    0 30386 /tmp/t1213-0-sh (deleted)
</code></pre>
<h2 id="here-string" tabindex="-1">Here String <a class="header-anchor" href="#here-string" aria-hidden="true">ðŸ”—</a></h2>
<ul>
<li><a href="https://www.tldp.org/LDP/abs/html/x17837.html">https://www.tldp.org/LDP/abs/html/x17837.html</a></li>
<li><a href="https://stackoverflow.com/questions/43235179/how-to-execute-ssh-keygen-without-prompt">https://stackoverflow.com/questions/43235179/how-to-execute-ssh-keygen-without-prompt</a></li>
<li><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Here-Strings">https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Here-Strings</a></li>
</ul>
<pre><code class="language-bash">$ man bash
</code></pre>
<p>Una variante degli here document, il formato Ã¨:</p>
<p><span class="mrb">&lt;&lt;&lt;</span>parola</p>
<p>La parola Ã¨ espansa ed Ã¨ passata al comando come suo standard input.</p>
<p>A here string can be considered as a stripped-down form of a here document.<br>
It consists of nothing more than <code>COMMAND &lt;&lt;&lt; $WORD</code>,<br>
where <code>$WORD</code> is expanded and fed to the <code>stdin</code> of <code>COMMAND</code>.</p>
<p>As a simple example, consider this alternative to the echo-grep construction.</p>
<p>Instead of:</p>
<pre><code class="language-bash"><span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$VAR</span>&quot;</span> | grep -q txt   <span class="hljs-comment"># if [[ $VAR = *txt* ]]</span>
</code></pre>
<p>etc.</p>
<p>Try:</p>
<pre><code class="language-bash"><span class="hljs-keyword">if</span> grep -q <span class="hljs-string">&quot;txt&quot;</span> &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$VAR</span>&quot;</span>
<span class="hljs-keyword">then</span>   <span class="hljs-comment">#         ^^^</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$VAR</span> contains the substring sequence \&quot;txt\&quot;&quot;</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>Or, in combination with <code>read</code>:</p>
<pre><code class="language-bash">String=<span class="hljs-string">&quot;This is a string of words.&quot;</span>
<span class="hljs-built_in">read</span> -r -a Words &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$String</span>&quot;</span>
<span class="hljs-comment">#  The -a option to &quot;read&quot;</span>
<span class="hljs-comment">#+ assigns the resulting values to successive members of an array.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;First word in String is:    <span class="hljs-variable">${Words[0]}</span>&quot;</span>   <span class="hljs-comment"># This</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Second word in String is:   <span class="hljs-variable">${Words[1]}</span>&quot;</span>   <span class="hljs-comment"># is</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Third word in String is:    <span class="hljs-variable">${Words[2]}</span>&quot;</span>   <span class="hljs-comment"># a</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fourth word in String is:   <span class="hljs-variable">${Words[3]}</span>&quot;</span>   <span class="hljs-comment"># string</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fifth word in String is:    <span class="hljs-variable">${Words[4]}</span>&quot;</span>   <span class="hljs-comment"># of</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Sixth word in String is:    <span class="hljs-variable">${Words[5]}</span>&quot;</span>   <span class="hljs-comment"># words.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Seventh word in String is:  <span class="hljs-variable">${Words[6]}</span>&quot;</span>   <span class="hljs-comment"># (null)</span>
                                                 <span class="hljs-comment"># Past end of $String.</span>
</code></pre>
<p>It is, of course, possible to feed the output of a here string into the stdin of a <code>loop</code>.</p>
<pre><code class="language-bash"><span class="hljs-comment"># As Seamus points out . . .</span>

ArrayVar=( element0 element1 element2 {A..D} )

<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> element ; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$element</span>&quot;</span> 1&gt;&amp;2
<span class="hljs-keyword">done</span> &lt;&lt;&lt; $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[*]}</span>)

<span class="hljs-comment"># element0 element1 element2 A B C D</span>
</code></pre>
<h3 id="example-19-13.-prepending-a-line-to-a-file" tabindex="-1">Example 19-13. Prepending a line to a file <a class="header-anchor" href="#example-19-13.-prepending-a-line-to-a-file" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment"># prepend.sh: Add text at beginning of file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Example contributed by Kenny Stauffer,</span>
<span class="hljs-comment">#+ and slightly modified by document author.</span>


E_NOSUCHFILE=85

<span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;File: &quot;</span> file   <span class="hljs-comment"># -p arg to &#x27;read&#x27; displays prompt.</span>
<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">&quot;<span class="hljs-variable">$file</span>&quot;</span> ]
<span class="hljs-keyword">then</span>   <span class="hljs-comment"># Bail out if no such file.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;File <span class="hljs-variable">$file</span> not found.&quot;</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOSUCHFILE</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Title: &quot;</span> title
<span class="hljs-built_in">cat</span> - <span class="hljs-variable">$file</span> &lt;&lt;&lt;<span class="hljs-variable">$title</span> &gt; <span class="hljs-variable">$file</span>.new

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Modified file is <span class="hljs-variable">$file</span>.new&quot;</span>

<span class="hljs-built_in">exit</span>  <span class="hljs-comment"># Ends script execution.</span>

  from <span class="hljs-string">&#x27;man bash&#x27;</span>:
  Here Strings
  	A variant of here documents, the format is:
  
  		&lt;&lt;&lt;<span class="hljs-string">word
  
  	The word</span> is expanded and supplied to the <span class="hljs-built_in">command</span> on its standard input.


  Of course, the following also works:
   sed -e <span class="hljs-string">&#x27;1i\
   Title: &#x27;</span> <span class="hljs-variable">$file</span>
</code></pre>
<h3 id="example-19-14.-parsing-a-mailbox" tabindex="-1">Example 19-14. Parsing a mailbox <a class="header-anchor" href="#example-19-14.-parsing-a-mailbox" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment">#  Script by Francisco Lobo,</span>
<span class="hljs-comment">#+ and slightly modified and commented by ABS Guide author.</span>
<span class="hljs-comment">#  Used in ABS Guide with permission. (Thank you!)</span>

<span class="hljs-comment"># This script will not run under Bash versions -lt 3.0.</span>


E_MISSING_ARG=87
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage: <span class="hljs-variable">$0</span> mailbox-file&quot;</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_MISSING_ARG</span>
<span class="hljs-keyword">fi</span>

mbox_grep()  <span class="hljs-comment"># Parse mailbox file.</span>
{
    <span class="hljs-built_in">declare</span> -i body=0 match=0
    <span class="hljs-built_in">declare</span> -a <span class="hljs-built_in">date</span> sender
    <span class="hljs-built_in">declare</span> mail header value


    <span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r mail
<span class="hljs-comment">#         ^^^^                 Reset $IFS.</span>
<span class="hljs-comment">#  Otherwise &quot;read&quot; will strip leading &amp; trailing space from its input.</span>

   <span class="hljs-keyword">do</span>
       <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$mail</span> =~ ^From  ]]   <span class="hljs-comment"># Match &quot;From&quot; field in message.</span>
       <span class="hljs-keyword">then</span>
          (( body  = <span class="hljs-number">0</span> ))           <span class="hljs-comment"># &quot;Zero out&quot; variables.</span>
          (( match = <span class="hljs-number">0</span> ))
          <span class="hljs-built_in">unset</span> <span class="hljs-built_in">date</span>

       <span class="hljs-keyword">elif</span> (( body ))
       <span class="hljs-keyword">then</span>
            (( match ))
            <span class="hljs-comment">#  echo &quot;$mail&quot;</span>
            <span class="hljs-comment">#  Uncomment above line if you want entire body</span>
            <span class="hljs-comment">#+ of message to display.</span>

   <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$mail</span> ]]; <span class="hljs-keyword">then</span>
      IFS=: <span class="hljs-built_in">read</span> -r header value &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$mail</span>&quot;</span>
      <span class="hljs-comment">#                          ^^^  &quot;here string&quot;</span>

      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$header</span>&quot;</span> <span class="hljs-keyword">in</span>
      [Ff][Rr][Oo][Mm] ) [[ <span class="hljs-variable">$value</span> =~ <span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span> ]] &amp;&amp; (( match++ )) ;;
      <span class="hljs-comment"># Match &quot;From&quot; line.</span>
      [Dd][Aa][Tt][Ee] ) <span class="hljs-built_in">read</span> -r -a <span class="hljs-built_in">date</span> &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$value</span>&quot;</span> ;;
      <span class="hljs-comment">#                                  ^^^</span>
      <span class="hljs-comment"># Match &quot;Date&quot; line.</span>
      [Rr][Ee][Cc][Ee][Ii][Vv][Ee][Dd] ) <span class="hljs-built_in">read</span> -r -a sender &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$value</span>&quot;</span> ;;
      <span class="hljs-comment">#                                                    ^^^</span>
      <span class="hljs-comment"># Match IP Address (may be spoofed).</span>
      <span class="hljs-keyword">esac</span>

       <span class="hljs-keyword">else</span>
          (( body++ ))
          (( match  )) &amp;&amp;
          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;MESSAGE <span class="hljs-variable">${date:+of: <span class="hljs-variable">${date[*]}</span> }</span>&quot;</span>
       <span class="hljs-comment">#    Entire $date array             ^</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;IP address of sender: <span class="hljs-variable">${sender[1]}</span>&quot;</span>
       <span class="hljs-comment">#    Second field of &quot;Received&quot; line    ^</span>

       <span class="hljs-keyword">fi</span>


    <span class="hljs-keyword">done</span> &lt; <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-comment"># Redirect stdout of file into loop.</span>
}


mbox_grep <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>  <span class="hljs-comment"># Send mailbox file to function.</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment"># Exercises:</span>
<span class="hljs-comment"># ---------</span>
<span class="hljs-comment"># 1) Break the single function, above, into multiple functions,</span>
<span class="hljs-comment">#+   for the sake of readability.</span>
<span class="hljs-comment"># 2) Add additional parsing to the script, checking for various keywords.</span>



$ mailbox_grep.sh scam_mail
  MESSAGE of Thu, 5 Jan 2006 08:00:56 -0500 (EST) 
  IP address of sender: 196.3.62.4
</code></pre>
<h2 id="heredoc-concatenati-con-rimozione-dell'ultimo-newline-del-primo-heredoc" tabindex="-1">heredoc concatenati con rimozione dell'ultimo newline del primo heredoc <a class="header-anchor" href="#heredoc-concatenati-con-rimozione-dell'ultimo-newline-del-primo-heredoc" aria-hidden="true">ðŸ”—</a></h2>
<p>Avendo necessitÃ  di creare un heredoc dove solo la variabile <code>$DST</code>
viene sostituita, e non le altre come ad es. <code>$PATH</code>,
spezziamo in due parti l'heredoc,
dopodichÃ¨ utilizzando il comando <code>head</code> eliminiamo <strong>l'ultimo newline del primo heredoc</strong>.</p>
<pre><code class="language-bash">DST=/opt/python
<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF| head -c -1 &gt;&gt; ~/.bashrc
# Python
export PATH=$DST/bin:
EOF</span>
<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span> &gt;&gt; ~/.bashrc
<span class="hljs-variable">$PATH</span>
EOF
</code></pre>
<p>Risultato:</p>
<pre><code># Python
export PATH=/opt/python/bin:$PATH
</code></pre>
</body></html>