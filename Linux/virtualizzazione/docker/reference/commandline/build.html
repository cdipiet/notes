<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="markdown-it" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <meta name="author" content="runner" />
        <meta name="dcterms.date" content="2025-04-08 13:44:52.588" />
        <title>build</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                background-color: #ffffff;
                color: #a0a0a0;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #a0a0a0;
                padding-left: 4px;
            }
            div.sourceCode {
                color: #1f1c1b;
                background-color: #ffffff;
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span {
                color: #1f1c1b;
            } /* Normal */
            code span.al {
                color: #bf0303;
                background-color: #f7e6e6;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #ca60ca;
            } /* Annotation */
            code span.at {
                color: #0057ae;
            } /* Attribute */
            code span.bn {
                color: #b08000;
            } /* BaseN */
            code span.bu {
                color: #644a9b;
                font-weight: bold;
            } /* BuiltIn */
            code span.cf {
                color: #1f1c1b;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #924c9d;
            } /* Char */
            code span.cn {
                color: #aa5500;
            } /* Constant */
            code span.co {
                color: #898887;
            } /* Comment */
            code span.cv {
                color: #0095ff;
            } /* CommentVar */
            code span.do {
                color: #607880;
            } /* Documentation */
            code span.dt {
                color: #0057ae;
            } /* DataType */
            code span.dv {
                color: #b08000;
            } /* DecVal */
            code span.er {
                color: #bf0303;
                text-decoration: underline;
            } /* Error */
            code span.ex {
                color: #0095ff;
                font-weight: bold;
            } /* Extension */
            code span.fl {
                color: #b08000;
            } /* Float */
            code span.fu {
                color: #644a9b;
            } /* Function */
            code span.im {
                color: #ff5500;
            } /* Import */
            code span.in {
                color: #b08000;
            } /* Information */
            code span.kw {
                color: #1f1c1b;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #1f1c1b;
            } /* Operator */
            code span.ot {
                color: #006e28;
            } /* Other */
            code span.pp {
                color: #006e28;
            } /* Preprocessor */
            code span.re {
                color: #0057ae;
                background-color: #e0e9f8;
            } /* RegionMarker */
            code span.sc {
                color: #3daee9;
            } /* SpecialChar */
            code span.ss {
                color: #ff5500;
            } /* SpecialString */
            code span.st {
                color: #bf0303;
            } /* String */
            code span.va {
                color: #0057ae;
            } /* Variable */
            code span.vs {
                color: #bf0303;
            } /* VerbatimString */
            code span.wa {
                color: #bf0303;
            } /* Warning */
        </style>
        <!--
  Firefox non carica font da locale quindi il font puÃ² non essere visibile
  quando di carica la pagina da locale.
  Bisogna impostare about:config
    security.fileuri.strict_origin_policy = false
  -->
        <link rel="stylesheet" href="../../../../../inc/css/katex.min.css" />
        <link rel="stylesheet" href="../../../../../inc/css/fonts/google_fonts.css" />
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="../../../../../inc/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../../../../inc/css/cdp.css" />
        <!--[if lt IE 9]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <![endif]-->
        <meta name="keywords" content="Appunti,Note" />
        <meta name="description" content="Appunti di runner" />
        <link rel="icon" type="image/x-icon" href="../../../../../inc/img/favicon.ico" />
        <link rel="shortcut icon" type="image/x-icon" href="../../../../../inc/img/favicon.ico" />

        <link rel="stylesheet" href="../../../../../inc/js/hljs/styles/default.css" />
        <script src="../../../../../inc/js/hljs/lib/highlight.js"></script>
        <script src="../../../../../inc/js/bootstrap/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> -->
        <script>
            hljs.initHighlightingOnLoad();
        </script>
        <script type="module">
            import mermaid from '../../../../../inc/js/mermaid/dist/mermaid.esm.min.mjs';
            // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script>
    </head>
    <body></body>
</html>
<h1 id="build" tabindex="-1">build <a class="header-anchor" href="#build" aria-hidden="true">ðŸ”—</a></h1>
<p class="code">2025-04-08 13:44:52.588</p>
<nav class="table-of-contents"><ol><li><a href="#title%3A-%22build%22description%3A-%22the-build-command-description-and-usage%22keywords%3A-%22build%2C-docker%2C-image%22">title: &quot;build&quot;description: &quot;The build command description and usage&quot;keywords: &quot;build, docker, image&quot; </a></li><li><a href="#description">Description </a><ol><li><a href="#git-repositories">Git repositories </a></li><li><a href="#tarball-contexts">Tarball contexts </a></li><li><a href="#text-files">Text files </a></li></ol></li><li><a href="#return-code">Return code </a></li><li><a href="#examples">Examples </a><ol><li><a href="#build-with-path">Build with PATH </a></li><li><a href="#build-with-url">Build with URL </a></li><li><a href="#build-with--">Build with - </a></li><li><a href="#use-a-.dockerignore-file">Use a .dockerignore file </a></li><li><a href="#tag-an-image-(-t)">Tag an image (-t) </a></li><li><a href="#specify-a-dockerfile-(-f)">Specify a Dockerfile (-f) </a></li><li><a href="#use-a-custom-parent-cgroup-(--cgroup-parent)">Use a custom parent cgroup (--cgroup-parent) </a></li><li><a href="#set-ulimits-in-container-(--ulimit)">Set ulimits in container (--ulimit) </a></li><li><a href="#set-build-time-variables-(--build-arg)">Set build-time variables (--build-arg) </a></li><li><a href="#optional-security-options-(--security-opt)">Optional security options (--security-opt) </a></li><li><a href="#specify-isolation-technology-for-container-(--isolation)">Specify isolation technology for container (--isolation) </a></li><li><a href="#add-entries-to-container-hosts-file-(--add-host)">Add entries to container hosts file (--add-host) </a></li><li><a href="#specifying-target-build-stage-(--target)">Specifying target build stage (--target) </a></li><li><a href="#custom-build-outputs">Custom build outputs </a></li><li><a href="#specifying-external-cache-sources">Specifying external cache sources </a></li><li><a href="#squash-an-image's-layers-(--squash)-(experimental)">Squash an image&#39;s layers (--squash) (experimental) </a><ol><li><a href="#overview">Overview </a></li><li><a href="#known-limitations">Known limitations </a></li><li><a href="#prerequisites">Prerequisites </a></li><li><a href="#enable-docker-experimental">Enable Docker experimental </a></li><li><a href="#build-an-image-with---squash-argument">Build an image with --squash argument </a></li></ol></li></ol></li></ol></nav><hr>
<h2 id="title%3A-%22build%22description%3A-%22the-build-command-description-and-usage%22keywords%3A-%22build%2C-docker%2C-image%22" tabindex="-1">title: &quot;build&quot;
description: &quot;The build command description and usage&quot;
keywords: &quot;build, docker, image&quot; <a class="header-anchor" href="#title%3A-%22build%22description%3A-%22the-build-command-description-and-usage%22keywords%3A-%22build%2C-docker%2C-image%22" aria-hidden="true">ðŸ”—</a></h2>
<h1 id="build-1" tabindex="-1">build <a class="header-anchor" href="#build-1" aria-hidden="true">ðŸ”—</a></h1>
<pre><code class="language-markdown">Usage:  docker build [OPTIONS] PATH | URL | -

Build an image from a Dockerfile

Options:
<span class="hljs-code">      --add-host value          Add a custom host-to-IP mapping (host:ip) (default [])
      --build-arg value         Set build-time variables (default [])
      --cache-from value        Images to consider as cache sources (default [])
      --cgroup-parent string    Optional parent cgroup for the container
      --compress                Compress the build context using gzip
      --cpu-period int          Limit the CPU CFS (Completely Fair Scheduler) period
      --cpu-quota int           Limit the CPU CFS (Completely Fair Scheduler) quota
  -c, --cpu-shares int          CPU shares (relative weight)
      --cpuset-cpus string      CPUs in which to allow execution (0-3, 0,1)
      --cpuset-mems string      MEMs in which to allow execution (0-3, 0,1)
      --disable-content-trust   Skip image verification (default true)
  -f, --file string             Name of the Dockerfile (Default is &#x27;PATH/Dockerfile&#x27;)
      --force-rm                Always remove intermediate containers
      --help                    Print usage
      --iidfile string          Write the image ID to the file
      --isolation string        Container isolation technology
      --label value             Set metadata for an image (default [])
  -m, --memory string           Memory limit
      --memory-swap string      Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap
      --network string          Set the networking mode for the RUN instructions during build
                                &#x27;bridge&#x27;: use default Docker bridge
                                &#x27;none&#x27;: no networking
                                &#x27;container:&lt;name|id&gt;&#x27;: reuse another container&#x27;s network stack
                                &#x27;host&#x27;: use the Docker host network stack
                                &#x27;&lt;network-name&gt;|&lt;network-id&gt;&#x27;: connect to a user-defined network
      --no-cache                Do not use cache when building the image
  -o, --output                  Output destination (format: type=local,dest=path)
      --pull                    Always attempt to pull a newer version of the image
      --progress                Set type of progress output (only if BuildKit enabled) (auto, plain, tty).
                                Use plain to show container output
  -q, --quiet                   Suppress the build output and print image ID on success
      --rm                      Remove intermediate containers after a successful build (default true)
      --secret                  Secret file to expose to the build (only if BuildKit enabled): id=mysecret,src=/local/secret&quot;
      --security-opt value      Security Options (default [])
      --shm-size bytes          Size of /dev/shm
                                The format is `&lt;number&gt;&lt;unit&gt;`. `number` must be greater than `0`.
                                Unit is optional and can be `b` (bytes), `k` (kilobytes), `m` (megabytes),
                                or `g` (gigabytes). If you omit the unit, the system uses bytes.
      --squash                  Squash newly built layers into a single new layer (**Experimental Only**)
      --ssh                     SSH agent socket or keys to expose to the build (only if BuildKit enabled) (format: default|&lt;id&gt;[=&lt;socket&gt;|&lt;key&gt;[,&lt;key&gt;]])
  -t, --tag value               Name and optionally a tag in the &#x27;name:tag&#x27; format (default [])
      --target string           Set the target build stage to build.
      --ulimit value            Ulimit options (default [])
</span></code></pre>
<h2 id="description" tabindex="-1">Description <a class="header-anchor" href="#description" aria-hidden="true">ðŸ”—</a></h2>
<p>The <code>docker build</code> command builds Docker images from a Dockerfile and a
&quot;context&quot;. A build's context is the set of files located in the specified
<code>PATH</code> or <code>URL</code>. The build process can refer to any of the files in the
context. For example, your build can use a <a href="../builder.md#copy"><em>COPY</em></a>
instruction to reference a file in the context.</p>
<p>The <code>URL</code> parameter can refer to three kinds of resources: Git repositories,
pre-packaged tarball contexts and plain text files.</p>
<h3 id="git-repositories" tabindex="-1">Git repositories <a class="header-anchor" href="#git-repositories" aria-hidden="true">ðŸ”—</a></h3>
<p>When the <code>URL</code> parameter points to the location of a Git repository, the
repository acts as the build context. The system recursively fetches the
repository and its submodules. The commit history is not preserved. A
repository is first pulled into a temporary directory on your local host. After
that succeeds, the directory is sent to the Docker daemon as the context.
Local copy gives you the ability to access private repositories using local
user credentials, VPN's, and so forth.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>If the <code>URL</code> parameter contains a fragment the system will recursively clone
the repository and its submodules using a <code>git clone --recursive</code> command.</p>
</blockquote>
<p>Git URLs accept context configuration in their fragment section, separated by a
colon (<code>:</code>).  The first part represents the reference that Git will check out,
and can be either a branch, a tag, or a remote reference. The second part
represents a subdirectory inside the repository that will be used as a build
context.</p>
<p>For example, run this command to use a directory called <code>docker</code> in the branch
<code>container</code>:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build https://github.com/docker/rootfs.git#container:docker</span>
</code></pre>
<p>The following table represents all the valid suffixes with their build
contexts:</p>
<table class="table"><thead>
<tr>
<th>Build Syntax Suffix</th>
<th>Commit Used</th>
<th>Build Context Used</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>myrepo.git</code></td>
<td><code>refs/heads/master</code></td>
<td><code>/</code></td>
</tr>
<tr>
<td><code>myrepo.git#mytag</code></td>
<td><code>refs/tags/mytag</code></td>
<td><code>/</code></td>
</tr>
<tr>
<td><code>myrepo.git#mybranch</code></td>
<td><code>refs/heads/mybranch</code></td>
<td><code>/</code></td>
</tr>
<tr>
<td><code>myrepo.git#pull/42/head</code></td>
<td><code>refs/pull/42/head</code></td>
<td><code>/</code></td>
</tr>
<tr>
<td><code>myrepo.git#:myfolder</code></td>
<td><code>refs/heads/master</code></td>
<td><code>/myfolder</code></td>
</tr>
<tr>
<td><code>myrepo.git#master:myfolder</code></td>
<td><code>refs/heads/master</code></td>
<td><code>/myfolder</code></td>
</tr>
<tr>
<td><code>myrepo.git#mytag:myfolder</code></td>
<td><code>refs/tags/mytag</code></td>
<td><code>/myfolder</code></td>
</tr>
<tr>
<td><code>myrepo.git#mybranch:myfolder</code></td>
<td><code>refs/heads/mybranch</code></td>
<td><code>/myfolder</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong></p>
<p>You cannot specify the build-context directory (<code>myfolder</code> in the examples above)
when using BuildKit as builder (<code>DOCKER_BUILDKIT=1</code>). Support for this feature
is tracked in <a href="https://github.com/moby/buildkit/issues/1684">buildkit#1684</a>.</p>
</blockquote>
<h3 id="tarball-contexts" tabindex="-1">Tarball contexts <a class="header-anchor" href="#tarball-contexts" aria-hidden="true">ðŸ”—</a></h3>
<p>If you pass an URL to a remote tarball, the URL itself is sent to the daemon:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build http://server/context.tar.gz</span>
</code></pre>
<p>The download operation will be performed on the host the Docker daemon is
running on, which is not necessarily the same host from which the build command
is being issued. The Docker daemon will fetch <code>context.tar.gz</code> and use it as the
build context. Tarball contexts must be tar archives conforming to the standard
<code>tar</code> UNIX format and can be compressed with any one of the 'xz', 'bzip2',
'gzip' or 'identity' (no compression) formats.</p>
<h3 id="text-files" tabindex="-1">Text files <a class="header-anchor" href="#text-files" aria-hidden="true">ðŸ”—</a></h3>
<p>Instead of specifying a context, you can pass a single <code>Dockerfile</code> in the
<code>URL</code> or pipe the file in via <code>STDIN</code>. To pipe a <code>Dockerfile</code> from <code>STDIN</code>:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build - &lt; Dockerfile</span>
</code></pre>
<p>With Powershell on Windows, you can run:</p>
<pre><code class="language-powershell"><span class="hljs-built_in">Get-Content</span> Dockerfile | docker build -
</code></pre>
<p>If you use <code>STDIN</code> or specify a <code>URL</code> pointing to a plain text file, the system
places the contents into a file called <code>Dockerfile</code>, and any <code>-f</code>, <code>--file</code>
option is ignored. In this scenario, there is no context.</p>
<p>By default the <code>docker build</code> command will look for a <code>Dockerfile</code> at the root
of the build context. The <code>-f</code>, <code>--file</code>, option lets you specify the path to
an alternative file to use instead. This is useful in cases where the same set
of files are used for multiple builds. The path must be to a file within the
build context. If a relative path is specified then it is interpreted as
relative to the root of the context.</p>
<p>In most cases, it's best to put each Dockerfile in an empty directory. Then,
add to that directory only the files needed for building the Dockerfile. To
increase the build's performance, you can exclude files and directories by
adding a <code>.dockerignore</code> file to that directory as well. For information on
creating one, see the <a href="../builder.md#dockerignore-file">.dockerignore file</a>.</p>
<p>If the Docker client loses connection to the daemon, the build is canceled.
This happens if you interrupt the Docker client with <code>CTRL-c</code> or if the Docker
client is killed for any reason. If the build initiated a pull which is still
running at the time the build is cancelled, the pull is cancelled as well.</p>
<h2 id="return-code" tabindex="-1">Return code <a class="header-anchor" href="#return-code" aria-hidden="true">ðŸ”—</a></h2>
<p>On a successful build, a return code of success <code>0</code> will be returned.  When the
build fails, a non-zero failure code will be returned.</p>
<p>There should be informational output of the reason for failure output to
<code>STDERR</code>:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t fail .</span>

Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon
Step 1/3 : FROM busybox
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">4986bf8c1536</span>
Step 2/3 : RUN exit 13
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> e26670ec7a0a</span>
INFO[0000] The command [/bin/sh -c exit 13] returned a non-zero code: 13
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> $?</span>
1
</code></pre>
<p>See also:</p>
<p><a href="../builder.html"><em>Dockerfile Reference</em></a>.</p>
<h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-hidden="true">ðŸ”—</a></h2>
<h3 id="build-with-path" tabindex="-1">Build with PATH <a class="header-anchor" href="#build-with-path" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build .</span>

Uploading context 10240 bytes
Step 1/3 : FROM busybox
Pulling repository busybox
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">e9aa60c60128MB/2.284 MB (100%) endpoint: https://cdn-registry-1.docker.io/v1/</span>
Step 2/3 : RUN ls -lh /
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> 9c9e81692ae9</span>
total 24
drwxr-xr-x    2 root     root        4.0K Mar 12  2013 bin
drwxr-xr-x    5 root     root        4.0K Oct 19 00:19 dev
drwxr-xr-x    2 root     root        4.0K Oct 19 00:19 etc
drwxr-xr-x    2 root     root        4.0K Nov 15 23:34 lib
lrwxrwxrwx    1 root     root           3 Mar 12  2013 lib64 -&gt; lib
dr-xr-xr-x  116 root     root           0 Nov 15 23:34 proc
lrwxrwxrwx    1 root     root           3 Mar 12  2013 sbin -&gt; bin
dr-xr-xr-x   13 root     root           0 Nov 15 23:34 sys
drwxr-xr-x    2 root     root        4.0K Mar 12  2013 tmp
drwxr-xr-x    2 root     root        4.0K Nov 15 23:34 usr
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">b35f4035db3f</span>
Step 3/3 : CMD echo Hello world
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> 02071fceb21b</span>
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">f52f38b7823e</span>
Successfully built f52f38b7823e
Removing intermediate container 9c9e81692ae9
Removing intermediate container 02071fceb21b
</code></pre>
<p>This example specifies that the <code>PATH</code> is <code>.</code>, and so all the files in the
local directory get <code>tar</code>d and sent to the Docker daemon. The <code>PATH</code> specifies
where to find the files for the &quot;context&quot; of the build on the Docker daemon.
Remember that the daemon could be running on a remote machine and that no
parsing of the Dockerfile happens at the client side (where you're running
<code>docker build</code>). That means that <em>all</em> the files at <code>PATH</code> get sent, not just
the ones listed to <a href="../builder.md#add"><em>ADD</em></a> in the Dockerfile.</p>
<p>The transfer of context from the local machine to the Docker daemon is what the
<code>docker</code> client means when you see the &quot;Sending build context&quot; message.</p>
<p>If you wish to keep the intermediate containers after the build is complete,
you must use <code>--rm=false</code>. This does not affect the build cache.</p>
<h3 id="build-with-url" tabindex="-1">Build with URL <a class="header-anchor" href="#build-with-url" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build github.com/creack/docker-firefox</span>
</code></pre>
<p>This will clone the GitHub repository and use the cloned repository as context.
The Dockerfile at the root of the repository is used as Dockerfile. You can
specify an arbitrary Git repository by using the <code>git://</code> or <code>git@</code> scheme.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f ctx/Dockerfile http://server/ctx.tar.gz</span>

Downloading context: http://server/ctx.tar.gz [===================&gt;]    240 B/240 B
Step 1/3 : FROM busybox
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">8c2e06607696</span>
Step 2/3 : ADD ctx/container.cfg /
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">e7829950cee3</span>
Removing intermediate container b35224abf821
Step 3/3 : CMD /bin/ls
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> fbc63d321d73</span>
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">3286931702ad</span>
Removing intermediate container fbc63d321d73
Successfully built 377c409b35e4
</code></pre>
<p>This sends the URL <code>http://server/ctx.tar.gz</code> to the Docker daemon, which
downloads and extracts the referenced tarball. The <code>-f ctx/Dockerfile</code>
parameter specifies a path inside <code>ctx.tar.gz</code> to the <code>Dockerfile</code> that is used
to build the image. Any <code>ADD</code> commands in that <code>Dockerfile</code> that refers to local
paths must be relative to the root of the contents inside <code>ctx.tar.gz</code>. In the
example above, the tarball contains a directory <code>ctx/</code>, so the <code>ADD ctx/container.cfg /</code> operation works as expected.</p>
<h3 id="build-with--" tabindex="-1">Build with - <a class="header-anchor" href="#build-with--" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build - &lt; Dockerfile</span>
</code></pre>
<p>This will read a Dockerfile from <code>STDIN</code> without context. Due to the lack of a
context, no contents of any local directory will be sent to the Docker daemon.
Since there is no context, a Dockerfile <code>ADD</code> only works if it refers to a
remote URL.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build - &lt; context.tar.gz</span>
</code></pre>
<p>This will build an image for a compressed context read from <code>STDIN</code>.  Supported
formats are: bzip2, gzip and xz.</p>
<h3 id="use-a-.dockerignore-file" tabindex="-1">Use a .dockerignore file <a class="header-anchor" href="#use-a-.dockerignore-file" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build .</span>

Uploading context 18.829 MB
Uploading context
Step 1/2 : FROM busybox
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">769b9341d937</span>
Step 2/2 : CMD echo Hello world
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span>
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">99cc1ad10469</span>
Successfully built 99cc1ad10469
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;.git&quot;</span> &gt; .dockerignore</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build .</span>
Uploading context  6.76 MB
Uploading context
Step 1/2 : FROM busybox
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">769b9341d937</span>
Step 2/2 : CMD echo Hello world
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span>
<span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">99cc1ad10469</span>
Successfully built 99cc1ad10469
</code></pre>
<p>This example shows the use of the <code>.dockerignore</code> file to exclude the <code>.git</code>
directory from the context. Its effect can be seen in the changed size of the
uploaded context. The builder reference contains detailed information on
<a href="../builder.md#dockerignore-file">creating a .dockerignore file</a>.</p>
<p>When using the <a href="../builder.md#buildkit">BuildKit backend</a>, <code>docker build</code> searches
for a <code>.dockerignore</code> file relative to the Dockerfile name. For example, running
<code>docker build -f myapp.Dockerfile .</code> will first look for an ignore file named
<code>myapp.Dockerfile.dockerignore</code>. If such a file is not found, the <code>.dockerignore</code>
file is used if present. Using a Dockerfile based <code>.dockerignore</code> is useful if a
project contains multiple Dockerfiles that expect to ignore different sets of
files.</p>
<h3 id="tag-an-image-(-t)" tabindex="-1">Tag an image (-t) <a class="header-anchor" href="#tag-an-image-(-t)" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t vieux/apache:2.0 .</span>
</code></pre>
<p>This will build like the previous example, but it will then tag the resulting
image. The repository name will be <code>vieux/apache</code> and the tag will be <code>2.0</code>.
<a href="tag.html">Read more about valid tags</a>.</p>
<p>You can apply multiple tags to an image. For example, you can apply the <code>latest</code>
tag to a newly built image and add another tag that references a specific
version.
For example, to tag an image both as <code>whenry/fedora-jboss:latest</code> and
<code>whenry/fedora-jboss:v2.1</code>, use the following:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t whenry/fedora-jboss:latest -t whenry/fedora-jboss:v2.1 .</span>
</code></pre>
<h3 id="specify-a-dockerfile-(-f)" tabindex="-1">Specify a Dockerfile (-f) <a class="header-anchor" href="#specify-a-dockerfile-(-f)" aria-hidden="true">ðŸ”—</a></h3>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f Dockerfile.debug .</span>
</code></pre>
<p>This will use a file called <code>Dockerfile.debug</code> for the build instructions
instead of <code>Dockerfile</code>.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl example.com/remote/Dockerfile | docker build -f - .</span>
</code></pre>
<p>The above command will use the current directory as the build context and read
a Dockerfile from stdin.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f dockerfiles/Dockerfile.debug -t myapp_debug .</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f dockerfiles/Dockerfile.prod  -t myapp_prod .</span>
</code></pre>
<p>The above commands will build the current build context (as specified by the
<code>.</code>) twice, once using a debug version of a <code>Dockerfile</code> and once using a
production version.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /home/me/myapp/some/dir/really/deep</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f /home/me/myapp/dockerfiles/debug /home/me/myapp</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -f ../../../../dockerfiles/debug /home/me/myapp</span>
</code></pre>
<p>These two <code>docker build</code> commands do the exact same thing. They both use the
contents of the <code>debug</code> file instead of looking for a <code>Dockerfile</code> and will use
<code>/home/me/myapp</code> as the root of the build context. Note that <code>debug</code> is in the
directory structure of the build context, regardless of how you refer to it on
the command line.</p>
<blockquote>
<p><strong>Note</strong></p>
<p><code>docker build</code> returns a <code>no such file or directory</code> error if the
file or directory does not exist in the uploaded context. This may
happen if there is no context, or if you specify a file that is
elsewhere on the Host system. The context is limited to the current
directory (and its children) for security reasons, and to ensure
repeatable builds on remote Docker hosts. This is also the reason why
<code>ADD ../file</code> does not work.</p>
</blockquote>
<h3 id="use-a-custom-parent-cgroup-(--cgroup-parent)" tabindex="-1">Use a custom parent cgroup (--cgroup-parent) <a class="header-anchor" href="#use-a-custom-parent-cgroup-(--cgroup-parent)" aria-hidden="true">ðŸ”—</a></h3>
<p>When <code>docker build</code> is run with the <code>--cgroup-parent</code> option the containers
used in the build will be run with the <a href="../run.md#specify-custom-cgroups">corresponding <code>docker run</code> flag</a>.</p>
<h3 id="set-ulimits-in-container-(--ulimit)" tabindex="-1">Set ulimits in container (--ulimit) <a class="header-anchor" href="#set-ulimits-in-container-(--ulimit)" aria-hidden="true">ðŸ”—</a></h3>
<p>Using the <code>--ulimit</code> option with <code>docker build</code> will cause each build step's
container to be started using those <a href="run.md#set-ulimits-in-container---ulimit"><code>--ulimit</code> flag values</a>.</p>
<h3 id="set-build-time-variables-(--build-arg)" tabindex="-1">Set build-time variables (--build-arg) <a class="header-anchor" href="#set-build-time-variables-(--build-arg)" aria-hidden="true">ðŸ”—</a></h3>
<p>You can use <code>ENV</code> instructions in a Dockerfile to define variable
values. These values persist in the built image. However, often
persistence is not what you want. Users want to specify variables differently
depending on which host they build an image on.</p>
<p>A good example is <code>http_proxy</code> or source versions for pulling intermediate
files. The <code>ARG</code> instruction lets Dockerfile authors define values that users
can set at build-time using the  <code>--build-arg</code> flag:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --build-arg HTTP_PROXY=http://10.20.30.2:1234 --build-arg FTP_PROXY=http://40.50.60.5:4567 .</span>
</code></pre>
<p>This flag allows you to pass the build-time variables that are
accessed like regular environment variables in the <code>RUN</code> instruction of the
Dockerfile. Also, these values don't persist in the intermediate or final images
like <code>ENV</code> values do.   You must add <code>--build-arg</code> for each build argument.</p>
<p>Using this flag will not alter the output you see when the <code>ARG</code> lines from the
Dockerfile are echoed during the build process.</p>
<p>For detailed information on using <code>ARG</code> and <code>ENV</code> instructions, see the
<a href="../builder.html">Dockerfile reference</a>.</p>
<p>You may also use the <code>--build-arg</code> flag without a value, in which case the value
from the local environment will be propagated into the Docker container being
built:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> HTTP_PROXY=http://10.20.30.2:1234</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --build-arg HTTP_PROXY .</span>
</code></pre>
<p>This is similar to how <code>docker run -e</code> works. Refer to the <a href="https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file"><code>docker run</code> documentation</a>
for more information.</p>
<h3 id="optional-security-options-(--security-opt)" tabindex="-1">Optional security options (--security-opt) <a class="header-anchor" href="#optional-security-options-(--security-opt)" aria-hidden="true">ðŸ”—</a></h3>
<p>This flag is only supported on a daemon running on Windows, and only supports
the <code>credentialspec</code> option. The <code>credentialspec</code> must be in the format
<code>file://spec.txt</code> or <code>registry://keyname</code>.</p>
<h3 id="specify-isolation-technology-for-container-(--isolation)" tabindex="-1">Specify isolation technology for container (--isolation) <a class="header-anchor" href="#specify-isolation-technology-for-container-(--isolation)" aria-hidden="true">ðŸ”—</a></h3>
<p>This option is useful in situations where you are running Docker containers on
Windows. The <code>--isolation=&lt;value&gt;</code> option sets a container's isolation
technology. On Linux, the only supported is the <code>default</code> option which uses
Linux namespaces. On Microsoft Windows, you can specify these values:</p>
<table class="table"><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>default</code></td>
<td>Use the value specified by the Docker daemon's <code>--exec-opt</code> . If the <code>daemon</code> does not specify an isolation technology, Microsoft Windows uses <code>process</code> as its default value.</td>
</tr>
<tr>
<td><code>process</code></td>
<td>Namespace isolation only.</td>
</tr>
<tr>
<td><code>hyperv</code></td>
<td>Hyper-V hypervisor partition-based isolation.</td>
</tr>
</tbody>
</table>
<p>Specifying the <code>--isolation</code> flag without a value is the same as setting <code>--isolation=&quot;default&quot;</code>.</p>
<h3 id="add-entries-to-container-hosts-file-(--add-host)" tabindex="-1">Add entries to container hosts file (--add-host) <a class="header-anchor" href="#add-entries-to-container-hosts-file-(--add-host)" aria-hidden="true">ðŸ”—</a></h3>
<p>You can add other hosts into a container's <code>/etc/hosts</code> file by using one or
more <code>--add-host</code> flags. This example adds a static address for a host named
<code>docker</code>:</p>
<pre><code>$ docker build --add-host=docker:10.180.0.1 .
</code></pre>
<h3 id="specifying-target-build-stage-(--target)" tabindex="-1">Specifying target build stage (--target) <a class="header-anchor" href="#specifying-target-build-stage-(--target)" aria-hidden="true">ðŸ”—</a></h3>
<p>When building a Dockerfile with multiple build stages, <code>--target</code> can be used to
specify an intermediate build stage by name as a final stage for the resulting
image. Commands after the target stage will be skipped.</p>
<pre><code class="language-dockerfile"><span class="hljs-keyword">FROM</span> debian AS build-<span class="hljs-keyword">env</span>
...

<span class="hljs-keyword">FROM</span> alpine AS production-<span class="hljs-keyword">env</span>
...
</code></pre>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t mybuildimage --target build-env .</span>
</code></pre>
<h3 id="custom-build-outputs" tabindex="-1">Custom build outputs <a class="header-anchor" href="#custom-build-outputs" aria-hidden="true">ðŸ”—</a></h3>
<p>By default, a local container image is created from the build result. The
<code>--output</code> (or <code>-o</code>) flag allows you to override this behavior, and a specify a
custom exporter. For example, custom exporters allow you to export the build
artifacts as files on the local filesystem instead of a Docker image, which can
be useful for generating local binaries, code generation etc.</p>
<p>The value for <code>--output</code> is a CSV-formatted string defining the exporter type
and options. Currently, <code>local</code> and <code>tar</code> exporters are supported. The <code>local</code>
exporter writes the resulting build files to a directory on the client side. The
<code>tar</code> exporter is similar but writes the files as a single tarball (<code>.tar</code>).</p>
<p>If no type is specified, the value defaults to the output directory of the local
exporter. Use a hyphen (<code>-</code>) to write the output tarball to standard output
(<code>STDOUT</code>).</p>
<p>The following example builds an image using the current directory (<code>.</code>) as build
context, and exports the files to a directory named <code>out</code> in the current directory.
If the directory does not exist, Docker creates the directory automatically:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -o out .</span>
</code></pre>
<p>The example above uses the short-hand syntax, omitting the <code>type</code> options, and
thus uses the default (<code>local</code>) exporter. The example below shows the equivalent
using the long-hand CSV syntax, specifying both <code>type</code> and <code>dest</code> (destination
path):</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --output <span class="hljs-built_in">type</span>=<span class="hljs-built_in">local</span>,dest=out .</span>
</code></pre>
<p>Use the <code>tar</code> type to export the files as a <code>.tar</code> archive:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --output <span class="hljs-built_in">type</span>=tar,dest=out.tar .</span>
</code></pre>
<p>The example below shows the equivalent when using the short-hand syntax. In this
case, <code>-</code> is specified as destination, which automatically selects the <code>tar</code> type,
and writes the output tarball to standard output, which is then redirected to
the <code>out.tar</code> file:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -o - . &gt; out.tar</span>
</code></pre>
<p>The <code>--output</code> option exports all files from the target stage. A common pattern
for exporting only specific files is to do multi-stage builds and to copy the
desired files to a new scratch stage with <a href="../builder.md#copy"><code>COPY --from</code></a>.</p>
<p>The example <code>Dockerfile</code> below uses a separate stage to collect the
build-artifacts for exporting:</p>
<pre><code class="language-dockerfile"><span class="hljs-keyword">FROM</span> golang AS build-stage
<span class="hljs-keyword">RUN</span><span class="language-bash"> go get -u github.com/LK4D4/vndr</span>

<span class="hljs-keyword">FROM</span> scratch AS export-stage
<span class="hljs-keyword">COPY</span><span class="language-bash"> --from=build-stage /go/bin/vndr /</span>
</code></pre>
<p>When building the Dockerfile with the <code>-o</code> option, only the files from the final
stage are exported to the <code>out</code> directory, in this case, the <code>vndr</code> binary:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -o out .</span>

[+] Building 2.3s (7/7) FINISHED
 =&gt; [internal] load build definition from Dockerfile                                                                          0.1s
 =&gt; =&gt; transferring dockerfile: 176B                                                                                          0.0s
 =&gt; [internal] load .dockerignore                                                                                             0.0s
 =&gt; =&gt; transferring context: 2B                                                                                               0.0s
 =&gt; [internal] load metadata for docker.io/library/golang:latest                                                              1.6s
 =&gt; [build-stage 1/2] FROM docker.io/library/golang@sha256:2df96417dca0561bf1027742dcc5b446a18957cd28eba6aa79269f23f1846d3f   0.0s
 =&gt; =&gt; resolve docker.io/library/golang@sha256:2df96417dca0561bf1027742dcc5b446a18957cd28eba6aa79269f23f1846d3f               0.0s
 =&gt; CACHED [build-stage 2/2] RUN go get -u github.com/LK4D4/vndr                                                              0.0s
 =&gt; [export-stage 1/1] COPY --from=build-stage /go/bin/vndr /                                                                 0.2s
 =&gt; exporting to client                                                                                                       0.4s
 =&gt; =&gt; copying files 10.30MB                                                                                                  0.3s
<span class="hljs-meta prompt_">
$ </span><span class="language-bash"><span class="hljs-built_in">ls</span> ./out</span>
vndr
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>This feature requires the BuildKit backend. You can either
<a href="../builder.md#buildkit">enable BuildKit</a> or use the <a href="https://github.com/docker/buildx">buildx</a>
plugin which provides more output type options.</p>
</blockquote>
<h3 id="specifying-external-cache-sources" tabindex="-1">Specifying external cache sources <a class="header-anchor" href="#specifying-external-cache-sources" aria-hidden="true">ðŸ”—</a></h3>
<p>In addition to local build cache, the builder can reuse the cache generated from
previous builds with the <code>--cache-from</code> flag pointing to an image in the registry.</p>
<p>To use an image as a cache source, cache metadata needs to be written into the
image on creation. This can be done by setting <code>--build-arg BUILDKIT_INLINE_CACHE=1</code>
when building the image. After that, the built image can be used as a cache source
for subsequent builds.</p>
<p>Upon importing the cache, the builder will only pull the JSON metadata from the
registry and determine possible cache hits based on that information. If there
is a cache hit, the matched layers are pulled into the local environment.</p>
<p>In addition to images, the cache can also be pulled from special cache manifests
generated by <a href="https://github.com/docker/buildx"><code>buildx</code></a> or the BuildKit CLI
(<code>buildctl</code>). These manifests (when built with the <code>type=registry</code> and <code>mode=max</code>
options) allow pulling layer data for intermediate stages in multi-stage builds.</p>
<p>The following example builds an image with inline-cache metadata and pushes it
to a registry, then uses the image as a cache source on another machine:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t myname/myapp --build-arg BUILDKIT_INLINE_CACHE=1 .</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">docker push myname/myapp</span>
</code></pre>
<p>After pushing the image, the image is used as cache source on another machine.
BuildKit automatically pulls the image from the registry if needed.</p>
<p>On another machine:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --cache-from myname/myapp .</span>
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>This feature requires the BuildKit backend. You can either
<a href="../builder.md#buildkit">enable BuildKit</a> or use the <a href="https://github.com/docker/buildx">buildx</a>
plugin. The previous builder has limited support for reusing cache from
pre-pulled images.</p>
</blockquote>
<h3 id="squash-an-image's-layers-(--squash)-(experimental)" tabindex="-1">Squash an image's layers (--squash) (experimental) <a class="header-anchor" href="#squash-an-image's-layers-(--squash)-(experimental)" aria-hidden="true">ðŸ”—</a></h3>
<h4 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-hidden="true">ðŸ”—</a></h4>
<p>Once the image is built, squash the new layers into a new image with a single
new layer. Squashing does not destroy any existing image, rather it creates a new
image with the content of the squashed layers. This effectively makes it look
like all <code>Dockerfile</code> commands were created with a single layer. The build
cache is preserved with this method.</p>
<p>The <code>--squash</code> option is an experimental feature, and should not be considered
stable.</p>
<p>Squashing layers can be beneficial if your Dockerfile produces multiple layers
modifying the same files, for example, files that are created in one step, and
removed in another step. For other use-cases, squashing images may actually have
a negative impact on performance; when pulling an image consisting of multiple
layers, layers can be pulled in parallel, and allows sharing layers between
images (saving space).</p>
<p>For most use cases, multi-stage builds are a better alternative, as they give more
fine-grained control over your build, and can take advantage of future
optimizations in the builder. Refer to the <a href="https://docs.docker.com/develop/develop-images/multistage-build/">use multi-stage builds</a>
section in the userguide for more information.</p>
<h4 id="known-limitations" tabindex="-1">Known limitations <a class="header-anchor" href="#known-limitations" aria-hidden="true">ðŸ”—</a></h4>
<p>The <code>--squash</code> option has a number of known limitations:</p>
<ul>
<li>When squashing layers, the resulting image cannot take advantage of layer
sharing with other images, and may use significantly more space. Sharing the
base image is still supported.</li>
<li>When using this option you may see significantly more space used due to
storing two copies of the image, one for the build cache with all the cache
layers intact, and one for the squashed version.</li>
<li>While squashing layers may produce smaller images, it may have a negative
impact on performance, as a single layer takes longer to extract, and
downloading a single layer cannot be parallelized.</li>
<li>When attempting to squash an image that does not make changes to the
filesystem (for example, the Dockerfile only contains <code>ENV</code> instructions),
the squash step will fail (see <a href="https://github.com/moby/moby/issues/33823">issue #33823</a>).</li>
</ul>
<h4 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-hidden="true">ðŸ”—</a></h4>
<p>The example on this page is using experimental mode in Docker 19.03.</p>
<p>Experimental mode can be enabled by using the <code>--experimental</code> flag when starting
the Docker daemon or setting <code>experimental: true</code> in the <code>daemon.json</code> configuration
file.</p>
<p>By default, experimental mode is disabled. To see the current configuration of
the docker daemon, use the <code>docker version</code> command and check the <code>Experimental</code>
line in the <code>Engine</code> section:</p>
<pre><code class="language-console">Client: Docker Engine - Community
 Version:           19.03.8
 API version:       1.40
 Go version:        go1.12.17
 Git commit:        afacb8b
 Built:             Wed Mar 11 01:21:11 2020
 OS/Arch:           darwin/amd64
 Experimental:      false

Server: Docker Engine - Community
 Engine:
  Version:          19.03.8
  API version:      1.40 (minimum version 1.12)
  Go version:       go1.12.17
  Git commit:       afacb8b
  Built:            Wed Mar 11 01:29:16 2020
  OS/Arch:          linux/amd64
  Experimental:     true
 [...]
</code></pre>
<p>To enable experimental mode, users need to restart the docker daemon with the
experimental flag enabled.</p>
<h4 id="enable-docker-experimental" tabindex="-1">Enable Docker experimental <a class="header-anchor" href="#enable-docker-experimental" aria-hidden="true">ðŸ”—</a></h4>
<p>To enable experimental features, you need to start the Docker daemon with
<code>--experimental</code> flag. You can also enable the daemon flag via
<code>/etc/docker/daemon.json</code>, for example:</p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;experimental&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>Then make sure the experimental flag is enabled:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker version -f <span class="hljs-string">&#x27;{{.Server.Experimental}}&#x27;</span></span>
true
</code></pre>
<h4 id="build-an-image-with---squash-argument" tabindex="-1">Build an image with <code>--squash</code> argument <a class="header-anchor" href="#build-an-image-with---squash-argument" aria-hidden="true">ðŸ”—</a></h4>
<p>The following is an example of docker build with <code>--squash</code> argument</p>
<pre><code class="language-dockerfile"><span class="hljs-keyword">FROM</span> busybox
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> hello &gt; /hello</span>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> world &gt;&gt; /hello</span>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">touch</span> remove_me /remove_me</span>
<span class="hljs-keyword">ENV</span> HELLO=world
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">rm</span> /remove_me</span>
</code></pre>
<p>An image named <code>test</code> is built with <code>--squash</code> argument.</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build --squash -t <span class="hljs-built_in">test</span> .</span>

&lt;...&gt;
</code></pre>
<p>If everything is right, the history looks like this:</p>
<pre><code class="language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker <span class="hljs-built_in">history</span> <span class="hljs-built_in">test</span></span>

IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
4e10cb5b4cac        3 seconds ago                                                       12 B                merge sha256:88a7b0112a41826885df0e7072698006ee8f621c6ab99fca7fe9151d7b599702 to sha256:47bcc53f74dc94b1920f0b34f6036096526296767650f223433fe65c35f149eb
&lt;missing&gt;           5 minutes ago       /bin/sh -c rm /remove_me                        0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c #(nop) ENV HELLO=world               0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c touch remove_me /remove_me           0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c echo world &gt;&gt; /hello                 0 B
&lt;missing&gt;           6 minutes ago       /bin/sh -c echo hello &gt; /hello                  0 B
&lt;missing&gt;           7 weeks ago         /bin/sh -c #(nop) CMD [&quot;sh&quot;]                    0 B
&lt;missing&gt;           7 weeks ago         /bin/sh -c #(nop) ADD file:47ca6e777c36a4cfff   1.113 MB
</code></pre>
<p>We could find that a layer's name is <code>&lt;missing&gt;</code>, and there is a new layer with
COMMENT <code>merge</code>.</p>
<p>Test the image, check for <code>/remove_me</code> being gone, make sure <code>hello\nworld</code> is
in <code>/hello</code>, make sure the <code>HELLO</code> environment variable's value is <code>world</code>.</p>
</body></html>